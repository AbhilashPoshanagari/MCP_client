var Mp=Object.create;var In=Object.defineProperty,Dp=Object.defineProperties,Up=Object.getOwnPropertyDescriptor,Zp=Object.getOwnPropertyDescriptors,Fp=Object.getOwnPropertyNames,$n=Object.getOwnPropertySymbols,Yo=Object.getPrototypeOf,Ts=Object.prototype.hasOwnProperty,Xo=Object.prototype.propertyIsEnumerable,Gp=Reflect.get;var cr=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Bp=r=>{throw TypeError(r)};var Ko=(r,e,t)=>e in r?In(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,l=(r,e)=>{for(var t in e||={})Ts.call(e,t)&&Ko(r,t,e[t]);if($n)for(var t of $n(e))Xo.call(e,t)&&Ko(r,t,e[t]);return r},g=(r,e)=>Dp(r,Zp(e));var ae=(r,e)=>{var t={};for(var n in r)Ts.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&$n)for(var n of $n(r))e.indexOf(n)<0&&Xo.call(r,n)&&(t[n]=r[n]);return t};var z=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ve=(r,e)=>{for(var t in e)In(r,t,{get:e[t],enumerable:!0})},qp=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Fp(e))!Ts.call(r,i)&&i!==t&&In(r,i,{get:()=>e[i],enumerable:!(n=Up(e,i))||n.enumerable});return r};var pt=(r,e,t)=>(t=r!=null?Mp(Yo(r)):{},qp(e||!r||!r.__esModule?In(t,"default",{value:r,enumerable:!0}):t,r));var Os=(r,e,t)=>Gp(Yo(r),t,e);var p=(r,e,t)=>new Promise((n,i)=>{var s=u=>{try{o(t.next(u))}catch(c){i(c)}},a=u=>{try{o(t.throw(u))}catch(c){i(c)}},o=u=>u.done?n(u.value):Promise.resolve(u.value).then(s,a);o((t=t.apply(r,e)).next())}),x=function(r,e){this[0]=r,this[1]=e},V=(r,e,t)=>{var n=(a,o,u,c)=>{try{var d=t[a](o),f=(o=d.value)instanceof x,m=d.done;Promise.resolve(f?o[0]:o).then(h=>f?n(a==="return"?a:"next",o[1]?{done:h.done,value:h.value}:h,u,c):u({value:h,done:m})).catch(h=>n("throw",h,u,c))}catch(h){c(h)}},i=a=>s[a]=o=>new Promise((u,c)=>n(a,o,u,c)),s={};return t=t.apply(r,e),s[cr("asyncIterator")]=()=>s,i("next"),i("throw"),i("return"),s},xe=r=>{var e=r[cr("asyncIterator")],t=!1,n,i={};return e==null?(e=r[cr("iterator")](),n=s=>i[s]=a=>e[s](a)):(e=e.call(r),n=s=>i[s]=a=>{if(t){if(t=!1,s==="throw")throw a;return a}return t=!0,{done:!1,value:new x(new Promise(o=>{var u=e[s](a);u instanceof Object||Bp("Object expected"),o(u)}),1)}}),i[cr("iterator")]=()=>i,n("next"),"throw"in e?n("throw"):i.throw=s=>{throw s},"return"in e&&n("return"),i},X=(r,e,t)=>(e=r[cr("asyncIterator")])?e.call(r):(r=r[cr("iterator")](),e={},t=(n,i)=>(i=r[n])&&(e[n]=s=>new Promise((a,o,u)=>(s=i.call(r,s),u=s.done,Promise.resolve(s.value).then(c=>a({value:c,done:u}),o)))),t("next"),t("return"),e);var eu=z((Bv,Qo)=>{"use strict";Qo.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var ou=z((qv,$s)=>{"use strict";var Vp=/[\p{Lu}]/u,Hp=/[\p{Ll}]/u,tu=/^[\p{Lu}](?![\p{Lu}])/gu,iu=/([\p{Alpha}\p{N}_]|$)/u,su=/[_.\- ]+/,Jp=new RegExp("^"+su.source),ru=new RegExp(su.source+iu.source,"gu"),nu=new RegExp("\\d+"+iu.source,"gu"),Wp=(r,e,t)=>{let n=!1,i=!1,s=!1;for(let a=0;a<r.length;a++){let o=r[a];n&&Vp.test(o)?(r=r.slice(0,a)+"-"+r.slice(a),n=!1,s=i,i=!0,a++):i&&s&&Hp.test(o)?(r=r.slice(0,a-1)+"-"+r.slice(a-1),s=i,i=!1,n=!0):(n=e(o)===o&&t(o)!==o,s=i,i=t(o)===o&&e(o)!==o)}return r},Kp=(r,e)=>(tu.lastIndex=0,r.replace(tu,t=>e(t))),Yp=(r,e)=>(ru.lastIndex=0,nu.lastIndex=0,r.replace(ru,(t,n)=>e(n)).replace(nu,t=>e(t))),au=(r,e)=>{if(!(typeof r=="string"||Array.isArray(r)))throw new TypeError("Expected the input to be `string | string[]`");if(e=l({pascalCase:!1,preserveConsecutiveUppercase:!1},e),Array.isArray(r)?r=r.map(s=>s.trim()).filter(s=>s.length).join("-"):r=r.trim(),r.length===0)return"";let t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),n=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return r.length===1?e.pascalCase?n(r):t(r):(r!==t(r)&&(r=Wp(r,t,n)),r=r.replace(Jp,""),e.preserveConsecutiveUppercase?r=Kp(r,t):r=t(r),e.pascalCase&&(r=n(r.charAt(0))+r.slice(1)),Yp(r,n))};$s.exports=au;$s.exports.default=au});var Lu=z((UE,ju)=>{"use strict";function Xe(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}ju.exports=Xe;Xe.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Xe.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Xe.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};Xe.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Xe.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};Xe.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};Xe.prototype.start=Xe.prototype.try;Xe.prototype.errors=function(){return this._errors};Xe.prototype.attempts=function(){return this._attempts};Xe.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,a=(r[s]||0)+1;r[s]=a,a>=t&&(e=i,t=a)}return e}});var zu=z(Wt=>{"use strict";var gm=Lu();Wt.operation=function(r){var e=Wt.timeouts(r);return new gm(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};Wt.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<e.retries;i++)n.push(this.createTimeout(i,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(i,e)),n.sort(function(s,a){return s-a}),n};Wt.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};Wt.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var i=0;i<t.length;i++){var s=t[i],a=r[s];r[s]=(function(u){var c=Wt.operation(e),d=Array.prototype.slice.call(arguments,1),f=d.pop();d.push(function(m){c.retry(m)||(m&&(arguments[0]=c.mainError()),f.apply(this,arguments))}),c.attempt(function(){u.apply(r,d)})}).bind(r,a),r[s].options=e}}});var Du=z((FE,Mu)=>{"use strict";Mu.exports=zu()});var Kn=z((Zu,Wn)=>{"use strict";var _m=Du(),ym=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Jn=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},bm=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r},wm=r=>ym.includes(r),Uu=(r,e)=>new Promise((t,n)=>{e=l({onFailedAttempt:()=>{},retries:10},e);let i=_m.operation(e);i.attempt(s=>p(null,null,function*(){try{t(yield r(s))}catch(a){if(!(a instanceof Error)){n(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Jn)i.stop(),n(a.originalError);else if(a instanceof TypeError&&!wm(a.message))i.stop(),n(a);else{bm(a,s,e);try{yield e.onFailedAttempt(a)}catch(o){n(o);return}i.retry(a)||n(i.mainError())}}}))});Wn.exports=Uu;Wn.exports.default=Uu;Wn.exports.AbortError=Jn});var Cc=z((iS,va)=>{"use strict";var rg=Object.prototype.hasOwnProperty,Ne="~";function Xr(){}Object.create&&(Xr.prototype=Object.create(null),new Xr().__proto__||(Ne=!1));function ng(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function Nc(r,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new ng(t,n||r,i),a=Ne?Ne+e:e;return r._events[a]?r._events[a].fn?r._events[a]=[r._events[a],s]:r._events[a].push(s):(r._events[a]=s,r._eventsCount++),r}function pi(r,e){--r._eventsCount===0?r._events=new Xr:delete r._events[e]}function Ae(){this._events=new Xr,this._eventsCount=0}Ae.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)rg.call(t,n)&&e.push(Ne?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Ae.prototype.listeners=function(e){var t=Ne?Ne+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,a=new Array(s);i<s;i++)a[i]=n[i].fn;return a};Ae.prototype.listenerCount=function(e){var t=Ne?Ne+e:e,n=this._events[t];return n?n.fn?1:n.length:0};Ae.prototype.emit=function(e,t,n,i,s,a){var o=Ne?Ne+e:e;if(!this._events[o])return!1;var u=this._events[o],c=arguments.length,d,f;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,s),!0;case 6:return u.fn.call(u.context,t,n,i,s,a),!0}for(f=1,d=new Array(c-1);f<c;f++)d[f-1]=arguments[f];u.fn.apply(u.context,d)}else{var m=u.length,h;for(f=0;f<m;f++)switch(u[f].once&&this.removeListener(e,u[f].fn,void 0,!0),c){case 1:u[f].fn.call(u[f].context);break;case 2:u[f].fn.call(u[f].context,t);break;case 3:u[f].fn.call(u[f].context,t,n);break;case 4:u[f].fn.call(u[f].context,t,n,i);break;default:if(!d)for(h=1,d=new Array(c-1);h<c;h++)d[h-1]=arguments[h];u[f].fn.apply(u[f].context,d)}}return!0};Ae.prototype.on=function(e,t,n){return Nc(this,e,t,n,!1)};Ae.prototype.once=function(e,t,n){return Nc(this,e,t,n,!0)};Ae.prototype.removeListener=function(e,t,n,i){var s=Ne?Ne+e:e;if(!this._events[s])return this;if(!t)return pi(this,s),this;var a=this._events[s];if(a.fn)a.fn===t&&(!i||a.once)&&(!n||a.context===n)&&pi(this,s);else{for(var o=0,u=[],c=a.length;o<c;o++)(a[o].fn!==t||i&&!a[o].once||n&&a[o].context!==n)&&u.push(a[o]);u.length?this._events[s]=u.length===1?u[0]:u:pi(this,s)}return this};Ae.prototype.removeAllListeners=function(e){var t;return e?(t=Ne?Ne+e:e,this._events[t]&&pi(this,t)):(this._events=new Xr,this._eventsCount=0),this};Ae.prototype.off=Ae.prototype.removeListener;Ae.prototype.addListener=Ae.prototype.on;Ae.prefixed=Ne;Ae.EventEmitter=Ae;typeof va<"u"&&(va.exports=Ae)});var Lc=z((sS,jc)=>{"use strict";jc.exports=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))});var Mc=z((aS,mi)=>{"use strict";var ig=Lc(),hi=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},zc=(r,e,t)=>new Promise((n,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(r);return}let s=setTimeout(()=>{if(typeof t=="function"){try{n(t())}catch(u){i(u)}return}let a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new hi(a);typeof r.cancel=="function"&&r.cancel(),i(o)},e);ig(r.then(n,i),()=>{clearTimeout(s)})});mi.exports=zc;mi.exports.default=zc;mi.exports.TimeoutError=hi});var Dc=z(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});function sg(r,e,t){let n=0,i=r.length;for(;i>0;){let s=i/2|0,a=n+s;t(r[a],e)<=0?(n=++a,i-=s+1):i=s}return n}xa.default=sg});var Uc=z(Sa=>{"use strict";Object.defineProperty(Sa,"__esModule",{value:!0});var ag=Dc(),Ea=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let n={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(n);return}let i=ag.default(this._queue,n,(s,a)=>a.priority-s.priority);this._queue.splice(i,0,n)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};Sa.default=Ea});var _i=z(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});var og=Cc(),Zc=Mc(),ug=Uc(),gi=()=>{},cg=new Zc.TimeoutError,Ta=class extends og{constructor(e){var t,n,i,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=gi,this._resolveIdle=gi,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:ug.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=gi,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=gi,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}add(n){return p(this,arguments,function*(e,t={}){return new Promise((i,s)=>{let a=()=>p(this,null,function*(){this._pendingCount++,this._intervalCount++;try{let o=this._timeout===void 0&&t.timeout===void 0?e():Zc.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(cg)});i(yield o)}catch(o){s(o)}this._next()});this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})})}addAll(e,t){return p(this,null,function*(){return Promise.all(e.map(n=>p(this,null,function*(){return this.add(n,t)})))})}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}onEmpty(){return p(this,null,function*(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})})}onIdle(){return p(this,null,function*(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Oa.default=Ta});var en=z((yS,Bc)=>{"use strict";var pg="2.0.0",hg=Number.MAX_SAFE_INTEGER||9007199254740991,mg=16,gg=250,_g=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Bc.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:mg,MAX_SAFE_BUILD_LENGTH:gg,MAX_SAFE_INTEGER:hg,RELEASE_TYPES:_g,SEMVER_SPEC_VERSION:pg,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var tn=z((bS,qc)=>{"use strict";var yg=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};qc.exports=yg});var vr=z((yt,Vc)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Aa,MAX_SAFE_BUILD_LENGTH:bg,MAX_LENGTH:wg}=en(),vg=tn();yt=Vc.exports={};var xg=yt.re=[],Eg=yt.safeRe=[],A=yt.src=[],Sg=yt.safeSrc=[],P=yt.t={},Tg=0,Pa="[a-zA-Z0-9-]",Og=[["\\s",1],["\\d",wg],[Pa,bg]],$g=r=>{for(let[e,t]of Og)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},J=(r,e,t)=>{let n=$g(e),i=Tg++;vg(r,i,e),P[r]=i,A[i]=e,Sg[i]=n,xg[i]=new RegExp(e,t?"g":void 0),Eg[i]=new RegExp(n,t?"g":void 0)};J("NUMERICIDENTIFIER","0|[1-9]\\d*");J("NUMERICIDENTIFIERLOOSE","\\d+");J("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Pa}*`);J("MAINVERSION",`(${A[P.NUMERICIDENTIFIER]})\\.(${A[P.NUMERICIDENTIFIER]})\\.(${A[P.NUMERICIDENTIFIER]})`);J("MAINVERSIONLOOSE",`(${A[P.NUMERICIDENTIFIERLOOSE]})\\.(${A[P.NUMERICIDENTIFIERLOOSE]})\\.(${A[P.NUMERICIDENTIFIERLOOSE]})`);J("PRERELEASEIDENTIFIER",`(?:${A[P.NUMERICIDENTIFIER]}|${A[P.NONNUMERICIDENTIFIER]})`);J("PRERELEASEIDENTIFIERLOOSE",`(?:${A[P.NUMERICIDENTIFIERLOOSE]}|${A[P.NONNUMERICIDENTIFIER]})`);J("PRERELEASE",`(?:-(${A[P.PRERELEASEIDENTIFIER]}(?:\\.${A[P.PRERELEASEIDENTIFIER]})*))`);J("PRERELEASELOOSE",`(?:-?(${A[P.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${A[P.PRERELEASEIDENTIFIERLOOSE]})*))`);J("BUILDIDENTIFIER",`${Pa}+`);J("BUILD",`(?:\\+(${A[P.BUILDIDENTIFIER]}(?:\\.${A[P.BUILDIDENTIFIER]})*))`);J("FULLPLAIN",`v?${A[P.MAINVERSION]}${A[P.PRERELEASE]}?${A[P.BUILD]}?`);J("FULL",`^${A[P.FULLPLAIN]}$`);J("LOOSEPLAIN",`[v=\\s]*${A[P.MAINVERSIONLOOSE]}${A[P.PRERELEASELOOSE]}?${A[P.BUILD]}?`);J("LOOSE",`^${A[P.LOOSEPLAIN]}$`);J("GTLT","((?:<|>)?=?)");J("XRANGEIDENTIFIERLOOSE",`${A[P.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);J("XRANGEIDENTIFIER",`${A[P.NUMERICIDENTIFIER]}|x|X|\\*`);J("XRANGEPLAIN",`[v=\\s]*(${A[P.XRANGEIDENTIFIER]})(?:\\.(${A[P.XRANGEIDENTIFIER]})(?:\\.(${A[P.XRANGEIDENTIFIER]})(?:${A[P.PRERELEASE]})?${A[P.BUILD]}?)?)?`);J("XRANGEPLAINLOOSE",`[v=\\s]*(${A[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${A[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${A[P.XRANGEIDENTIFIERLOOSE]})(?:${A[P.PRERELEASELOOSE]})?${A[P.BUILD]}?)?)?`);J("XRANGE",`^${A[P.GTLT]}\\s*${A[P.XRANGEPLAIN]}$`);J("XRANGELOOSE",`^${A[P.GTLT]}\\s*${A[P.XRANGEPLAINLOOSE]}$`);J("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Aa}})(?:\\.(\\d{1,${Aa}}))?(?:\\.(\\d{1,${Aa}}))?`);J("COERCE",`${A[P.COERCEPLAIN]}(?:$|[^\\d])`);J("COERCEFULL",A[P.COERCEPLAIN]+`(?:${A[P.PRERELEASE]})?(?:${A[P.BUILD]})?(?:$|[^\\d])`);J("COERCERTL",A[P.COERCE],!0);J("COERCERTLFULL",A[P.COERCEFULL],!0);J("LONETILDE","(?:~>?)");J("TILDETRIM",`(\\s*)${A[P.LONETILDE]}\\s+`,!0);yt.tildeTrimReplace="$1~";J("TILDE",`^${A[P.LONETILDE]}${A[P.XRANGEPLAIN]}$`);J("TILDELOOSE",`^${A[P.LONETILDE]}${A[P.XRANGEPLAINLOOSE]}$`);J("LONECARET","(?:\\^)");J("CARETTRIM",`(\\s*)${A[P.LONECARET]}\\s+`,!0);yt.caretTrimReplace="$1^";J("CARET",`^${A[P.LONECARET]}${A[P.XRANGEPLAIN]}$`);J("CARETLOOSE",`^${A[P.LONECARET]}${A[P.XRANGEPLAINLOOSE]}$`);J("COMPARATORLOOSE",`^${A[P.GTLT]}\\s*(${A[P.LOOSEPLAIN]})$|^$`);J("COMPARATOR",`^${A[P.GTLT]}\\s*(${A[P.FULLPLAIN]})$|^$`);J("COMPARATORTRIM",`(\\s*)${A[P.GTLT]}\\s*(${A[P.LOOSEPLAIN]}|${A[P.XRANGEPLAIN]})`,!0);yt.comparatorTrimReplace="$1$2$3";J("HYPHENRANGE",`^\\s*(${A[P.XRANGEPLAIN]})\\s+-\\s+(${A[P.XRANGEPLAIN]})\\s*$`);J("HYPHENRANGELOOSE",`^\\s*(${A[P.XRANGEPLAINLOOSE]})\\s+-\\s+(${A[P.XRANGEPLAINLOOSE]})\\s*$`);J("STAR","(<|>)?=?\\s*\\*");J("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");J("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var wi=z((wS,Hc)=>{"use strict";var Ig=Object.freeze({loose:!0}),Ag=Object.freeze({}),Pg=r=>r?typeof r!="object"?Ig:r:Ag;Hc.exports=Pg});var ka=z((vS,Kc)=>{"use strict";var Jc=/^[0-9]+$/,Wc=(r,e)=>{let t=Jc.test(r),n=Jc.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},kg=(r,e)=>Wc(e,r);Kc.exports={compareIdentifiers:Wc,rcompareIdentifiers:kg}});var Pe=z((xS,el)=>{"use strict";var vi=tn(),{MAX_LENGTH:Yc,MAX_SAFE_INTEGER:xi}=en(),{safeRe:Xc,safeSrc:Qc,t:Ei}=vr(),Rg=wi(),{compareIdentifiers:xr}=ka(),Ra=class r{constructor(e,t){if(t=Rg(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Yc)throw new TypeError(`version is longer than ${Yc} characters`);vi("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?Xc[Ei.LOOSE]:Xc[Ei.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>xi||this.major<0)throw new TypeError("Invalid major version");if(this.minor>xi||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>xi||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<xi)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(vi("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),xr(this.major,e.major)||xr(this.minor,e.minor)||xr(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],i=e.prerelease[t];if(vi("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return xr(n,i)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],i=e.build[t];if(vi("build compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return xr(n,i)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let i=new RegExp(`^${this.options.loose?Qc[Ei.PRERELEASELOOSE]:Qc[Ei.PRERELEASE]}$`),s=`-${t}`.match(i);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];n===!1&&(s=[t]),xr(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};el.exports=Ra});var er=z((ES,rl)=>{"use strict";var tl=Pe(),Ng=(r,e,t=!1)=>{if(r instanceof tl)return r;try{return new tl(r,e)}catch(n){if(!t)return null;throw n}};rl.exports=Ng});var il=z((SS,nl)=>{"use strict";var Cg=er(),jg=(r,e)=>{let t=Cg(r,e);return t?t.version:null};nl.exports=jg});var al=z((TS,sl)=>{"use strict";var Lg=er(),zg=(r,e)=>{let t=Lg(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};sl.exports=zg});var cl=z((OS,ul)=>{"use strict";var ol=Pe(),Mg=(r,e,t,n,i)=>{typeof t=="string"&&(i=n,n=t,t=void 0);try{return new ol(r instanceof ol?r.version:r,t).inc(e,n,i).version}catch{return null}};ul.exports=Mg});var fl=z(($S,dl)=>{"use strict";var ll=er(),Dg=(r,e)=>{let t=ll(r,null,!0),n=ll(e,null,!0),i=t.compare(n);if(i===0)return null;let s=i>0,a=s?t:n,o=s?n:t,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}let d=u?"pre":"";return t.major!==n.major?d+"major":t.minor!==n.minor?d+"minor":t.patch!==n.patch?d+"patch":"prerelease"};dl.exports=Dg});var hl=z((IS,pl)=>{"use strict";var Ug=Pe(),Zg=(r,e)=>new Ug(r,e).major;pl.exports=Zg});var gl=z((AS,ml)=>{"use strict";var Fg=Pe(),Gg=(r,e)=>new Fg(r,e).minor;ml.exports=Gg});var yl=z((PS,_l)=>{"use strict";var Bg=Pe(),qg=(r,e)=>new Bg(r,e).patch;_l.exports=qg});var wl=z((kS,bl)=>{"use strict";var Vg=er(),Hg=(r,e)=>{let t=Vg(r,e);return t&&t.prerelease.length?t.prerelease:null};bl.exports=Hg});var Qe=z((RS,xl)=>{"use strict";var vl=Pe(),Jg=(r,e,t)=>new vl(r,t).compare(new vl(e,t));xl.exports=Jg});var Sl=z((NS,El)=>{"use strict";var Wg=Qe(),Kg=(r,e,t)=>Wg(e,r,t);El.exports=Kg});var Ol=z((CS,Tl)=>{"use strict";var Yg=Qe(),Xg=(r,e)=>Yg(r,e,!0);Tl.exports=Xg});var Si=z((jS,Il)=>{"use strict";var $l=Pe(),Qg=(r,e,t)=>{let n=new $l(r,t),i=new $l(e,t);return n.compare(i)||n.compareBuild(i)};Il.exports=Qg});var Pl=z((LS,Al)=>{"use strict";var e_=Si(),t_=(r,e)=>r.sort((t,n)=>e_(t,n,e));Al.exports=t_});var Rl=z((zS,kl)=>{"use strict";var r_=Si(),n_=(r,e)=>r.sort((t,n)=>r_(n,t,e));kl.exports=n_});var rn=z((MS,Nl)=>{"use strict";var i_=Qe(),s_=(r,e,t)=>i_(r,e,t)>0;Nl.exports=s_});var Ti=z((DS,Cl)=>{"use strict";var a_=Qe(),o_=(r,e,t)=>a_(r,e,t)<0;Cl.exports=o_});var Na=z((US,jl)=>{"use strict";var u_=Qe(),c_=(r,e,t)=>u_(r,e,t)===0;jl.exports=c_});var Ca=z((ZS,Ll)=>{"use strict";var l_=Qe(),d_=(r,e,t)=>l_(r,e,t)!==0;Ll.exports=d_});var Oi=z((FS,zl)=>{"use strict";var f_=Qe(),p_=(r,e,t)=>f_(r,e,t)>=0;zl.exports=p_});var $i=z((GS,Ml)=>{"use strict";var h_=Qe(),m_=(r,e,t)=>h_(r,e,t)<=0;Ml.exports=m_});var ja=z((BS,Dl)=>{"use strict";var g_=Na(),__=Ca(),y_=rn(),b_=Oi(),w_=Ti(),v_=$i(),x_=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return g_(r,t,n);case"!=":return __(r,t,n);case">":return y_(r,t,n);case">=":return b_(r,t,n);case"<":return w_(r,t,n);case"<=":return v_(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};Dl.exports=x_});var Zl=z((qS,Ul)=>{"use strict";var E_=Pe(),S_=er(),{safeRe:Ii,t:Ai}=vr(),T_=(r,e)=>{if(r instanceof E_)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?Ii[Ai.COERCEFULL]:Ii[Ai.COERCE]);else{let u=e.includePrerelease?Ii[Ai.COERCERTLFULL]:Ii[Ai.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let n=t[2],i=t[3]||"0",s=t[4]||"0",a=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return S_(`${n}.${i}.${s}${a}${o}`,e)};Ul.exports=T_});var Gl=z((VS,Fl)=>{"use strict";var La=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};Fl.exports=La});var et=z((HS,Hl)=>{"use strict";var O_=/\s+/g,za=class r{constructor(e,t){if(t=I_(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Ma)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(O_," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!ql(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&j_(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&N_)|(this.options.loose&&C_))+":"+e,i=Bl.get(n);if(i)return i;let s=this.options.loose,a=s?Fe[Ce.HYPHENRANGELOOSE]:Fe[Ce.HYPHENRANGE];e=e.replace(a,q_(this.options.includePrerelease)),se("hyphen replace",e),e=e.replace(Fe[Ce.COMPARATORTRIM],P_),se("comparator trim",e),e=e.replace(Fe[Ce.TILDETRIM],k_),se("tilde trim",e),e=e.replace(Fe[Ce.CARETTRIM],R_),se("caret trim",e);let o=e.split(" ").map(f=>L_(f,this.options)).join(" ").split(/\s+/).map(f=>B_(f,this.options));s&&(o=o.filter(f=>(se("loose invalid filter",f,this.options),!!f.match(Fe[Ce.COMPARATORLOOSE])))),se("range list",o);let u=new Map,c=o.map(f=>new Ma(f,this.options));for(let f of c){if(ql(f))return[f];u.set(f.value,f)}u.size>1&&u.has("")&&u.delete("");let d=[...u.values()];return Bl.set(n,d),d}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>Vl(n,t)&&e.set.some(i=>Vl(i,t)&&n.every(s=>i.every(a=>s.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new A_(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(V_(this.set[t],e,this.options))return!0;return!1}};Hl.exports=za;var $_=Gl(),Bl=new $_,I_=wi(),Ma=nn(),se=tn(),A_=Pe(),{safeRe:Fe,t:Ce,comparatorTrimReplace:P_,tildeTrimReplace:k_,caretTrimReplace:R_}=vr(),{FLAG_INCLUDE_PRERELEASE:N_,FLAG_LOOSE:C_}=en(),ql=r=>r.value==="<0.0.0-0",j_=r=>r.value==="",Vl=(r,e)=>{let t=!0,n=r.slice(),i=n.pop();for(;t&&n.length;)t=n.every(s=>i.intersects(s,e)),i=n.pop();return t},L_=(r,e)=>(se("comp",r,e),r=D_(r,e),se("caret",r),r=z_(r,e),se("tildes",r),r=Z_(r,e),se("xrange",r),r=G_(r,e),se("stars",r),r),je=r=>!r||r.toLowerCase()==="x"||r==="*",z_=(r,e)=>r.trim().split(/\s+/).map(t=>M_(t,e)).join(" "),M_=(r,e)=>{let t=e.loose?Fe[Ce.TILDELOOSE]:Fe[Ce.TILDE];return r.replace(t,(n,i,s,a,o)=>{se("tilde",r,n,i,s,a,o);let u;return je(i)?u="":je(s)?u=`>=${i}.0.0 <${+i+1}.0.0-0`:je(a)?u=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:o?(se("replaceTilde pr",o),u=`>=${i}.${s}.${a}-${o} <${i}.${+s+1}.0-0`):u=`>=${i}.${s}.${a} <${i}.${+s+1}.0-0`,se("tilde return",u),u})},D_=(r,e)=>r.trim().split(/\s+/).map(t=>U_(t,e)).join(" "),U_=(r,e)=>{se("caret",r,e);let t=e.loose?Fe[Ce.CARETLOOSE]:Fe[Ce.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(i,s,a,o,u)=>{se("caret",r,i,s,a,o,u);let c;return je(s)?c="":je(a)?c=`>=${s}.0.0${n} <${+s+1}.0.0-0`:je(o)?s==="0"?c=`>=${s}.${a}.0${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.0${n} <${+s+1}.0.0-0`:u?(se("replaceCaret pr",u),s==="0"?a==="0"?c=`>=${s}.${a}.${o}-${u} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}-${u} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o}-${u} <${+s+1}.0.0-0`):(se("no pr"),s==="0"?a==="0"?c=`>=${s}.${a}.${o}${n} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o} <${+s+1}.0.0-0`),se("caret return",c),c})},Z_=(r,e)=>(se("replaceXRanges",r,e),r.split(/\s+/).map(t=>F_(t,e)).join(" ")),F_=(r,e)=>{r=r.trim();let t=e.loose?Fe[Ce.XRANGELOOSE]:Fe[Ce.XRANGE];return r.replace(t,(n,i,s,a,o,u)=>{se("xRange",r,n,i,s,a,o,u);let c=je(s),d=c||je(a),f=d||je(o),m=f;return i==="="&&m&&(i=""),u=e.includePrerelease?"-0":"",c?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&m?(d&&(a=0),o=0,i===">"?(i=">=",d?(s=+s+1,a=0,o=0):(a=+a+1,o=0)):i==="<="&&(i="<",d?s=+s+1:a=+a+1),i==="<"&&(u="-0"),n=`${i+s}.${a}.${o}${u}`):d?n=`>=${s}.0.0${u} <${+s+1}.0.0-0`:f&&(n=`>=${s}.${a}.0${u} <${s}.${+a+1}.0-0`),se("xRange return",n),n})},G_=(r,e)=>(se("replaceStars",r,e),r.trim().replace(Fe[Ce.STAR],"")),B_=(r,e)=>(se("replaceGTE0",r,e),r.trim().replace(Fe[e.includePrerelease?Ce.GTE0PRE:Ce.GTE0],"")),q_=r=>(e,t,n,i,s,a,o,u,c,d,f,m)=>(je(n)?t="":je(i)?t=`>=${n}.0.0${r?"-0":""}`:je(s)?t=`>=${n}.${i}.0${r?"-0":""}`:a?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,je(c)?u="":je(d)?u=`<${+c+1}.0.0-0`:je(f)?u=`<${c}.${+d+1}.0-0`:m?u=`<=${c}.${d}.${f}-${m}`:r?u=`<${c}.${d}.${+f+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),V_=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(se(r[n].semver),r[n].semver!==Ma.ANY&&r[n].semver.prerelease.length>0){let i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var nn=z((JS,Ql)=>{"use strict";var sn=Symbol("SemVer ANY"),Za=class r{static get ANY(){return sn}constructor(e,t){if(t=Jl(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Ua("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===sn?this.value="":this.value=this.operator+this.semver.version,Ua("comp",this)}parse(e){let t=this.options.loose?Wl[Kl.COMPARATORLOOSE]:Wl[Kl.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Yl(n[2],this.options.loose):this.semver=sn}toString(){return this.value}test(e){if(Ua("Comparator.test",e,this.options.loose),this.semver===sn||e===sn)return!0;if(typeof e=="string")try{e=new Yl(e,this.options)}catch{return!1}return Da(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Xl(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new Xl(this.value,t).test(e.semver):(t=Jl(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Da(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Da(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Ql.exports=Za;var Jl=wi(),{safeRe:Wl,t:Kl}=vr(),Da=ja(),Ua=tn(),Yl=Pe(),Xl=et()});var an=z((WS,ed)=>{"use strict";var H_=et(),J_=(r,e,t)=>{try{e=new H_(e,t)}catch{return!1}return e.test(r)};ed.exports=J_});var rd=z((KS,td)=>{"use strict";var W_=et(),K_=(r,e)=>new W_(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));td.exports=K_});var id=z((YS,nd)=>{"use strict";var Y_=Pe(),X_=et(),Q_=(r,e,t)=>{let n=null,i=null,s=null;try{s=new X_(e,t)}catch{return null}return r.forEach(a=>{s.test(a)&&(!n||i.compare(a)===-1)&&(n=a,i=new Y_(n,t))}),n};nd.exports=Q_});var ad=z((XS,sd)=>{"use strict";var ey=Pe(),ty=et(),ry=(r,e,t)=>{let n=null,i=null,s=null;try{s=new ty(e,t)}catch{return null}return r.forEach(a=>{s.test(a)&&(!n||i.compare(a)===1)&&(n=a,i=new ey(n,t))}),n};sd.exports=ry});var cd=z((QS,ud)=>{"use strict";var Fa=Pe(),ny=et(),od=rn(),iy=(r,e)=>{r=new ny(r,e);let t=new Fa("0.0.0");if(r.test(t)||(t=new Fa("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){let i=r.set[n],s=null;i.forEach(a=>{let o=new Fa(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!s||od(o,s))&&(s=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),s&&(!t||od(t,s))&&(t=s)}return t&&r.test(t)?t:null};ud.exports=iy});var dd=z((eT,ld)=>{"use strict";var sy=et(),ay=(r,e)=>{try{return new sy(r,e).range||"*"}catch{return null}};ld.exports=ay});var Pi=z((tT,md)=>{"use strict";var oy=Pe(),hd=nn(),{ANY:uy}=hd,cy=et(),ly=an(),fd=rn(),pd=Ti(),dy=$i(),fy=Oi(),py=(r,e,t,n)=>{r=new oy(r,n),e=new cy(e,n);let i,s,a,o,u;switch(t){case">":i=fd,s=dy,a=pd,o=">",u=">=";break;case"<":i=pd,s=fy,a=fd,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ly(r,e,n))return!1;for(let c=0;c<e.set.length;++c){let d=e.set[c],f=null,m=null;if(d.forEach(h=>{h.semver===uy&&(h=new hd(">=0.0.0")),f=f||h,m=m||h,i(h.semver,f.semver,n)?f=h:a(h.semver,m.semver,n)&&(m=h)}),f.operator===o||f.operator===u||(!m.operator||m.operator===o)&&s(r,m.semver))return!1;if(m.operator===u&&a(r,m.semver))return!1}return!0};md.exports=py});var _d=z((rT,gd)=>{"use strict";var hy=Pi(),my=(r,e,t)=>hy(r,e,">",t);gd.exports=my});var bd=z((nT,yd)=>{"use strict";var gy=Pi(),_y=(r,e,t)=>gy(r,e,"<",t);yd.exports=_y});var xd=z((iT,vd)=>{"use strict";var wd=et(),yy=(r,e,t)=>(r=new wd(r,t),e=new wd(e,t),r.intersects(e,t));vd.exports=yy});var Sd=z((sT,Ed)=>{"use strict";var by=an(),wy=Qe();Ed.exports=(r,e,t)=>{let n=[],i=null,s=null,a=r.sort((d,f)=>wy(d,f,t));for(let d of a)by(d,e,t)?(s=d,i||(i=d)):(s&&n.push([i,s]),s=null,i=null);i&&n.push([i,null]);let o=[];for(let[d,f]of n)d===f?o.push(d):!f&&d===a[0]?o.push("*"):f?d===a[0]?o.push(`<=${f}`):o.push(`${d} - ${f}`):o.push(`>=${d}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var Pd=z((aT,Ad)=>{"use strict";var Td=et(),Ba=nn(),{ANY:Ga}=Ba,on=an(),qa=Qe(),vy=(r,e,t={})=>{if(r===e)return!0;r=new Td(r,t),e=new Td(e,t);let n=!1;e:for(let i of r.set){for(let s of e.set){let a=Ey(i,s,t);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},xy=[new Ba(">=0.0.0-0")],Od=[new Ba(">=0.0.0")],Ey=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Ga){if(e.length===1&&e[0].semver===Ga)return!0;t.includePrerelease?r=xy:r=Od}if(e.length===1&&e[0].semver===Ga){if(t.includePrerelease)return!0;e=Od}let n=new Set,i,s;for(let h of r)h.operator===">"||h.operator===">="?i=$d(i,h,t):h.operator==="<"||h.operator==="<="?s=Id(s,h,t):n.add(h.semver);if(n.size>1)return null;let a;if(i&&s){if(a=qa(i.semver,s.semver,t),a>0)return null;if(a===0&&(i.operator!==">="||s.operator!=="<="))return null}for(let h of n){if(i&&!on(h,String(i),t)||s&&!on(h,String(s),t))return null;for(let _ of e)if(!on(h,String(_),t))return!1;return!0}let o,u,c,d,f=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1,m=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(let h of e){if(d=d||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",i){if(m&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===m.major&&h.semver.minor===m.minor&&h.semver.patch===m.patch&&(m=!1),h.operator===">"||h.operator===">="){if(o=$d(i,h,t),o===h&&o!==i)return!1}else if(i.operator===">="&&!on(i.semver,String(h),t))return!1}if(s){if(f&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1),h.operator==="<"||h.operator==="<="){if(u=Id(s,h,t),u===h&&u!==s)return!1}else if(s.operator==="<="&&!on(s.semver,String(h),t))return!1}if(!h.operator&&(s||i)&&a!==0)return!1}return!(i&&c&&!s&&a!==0||s&&d&&!i&&a!==0||m||f)},$d=(r,e,t)=>{if(!r)return e;let n=qa(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},Id=(r,e,t)=>{if(!r)return e;let n=qa(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};Ad.exports=vy});var Cd=z((oT,Nd)=>{"use strict";var Va=vr(),kd=en(),Sy=Pe(),Rd=ka(),Ty=er(),Oy=il(),$y=al(),Iy=cl(),Ay=fl(),Py=hl(),ky=gl(),Ry=yl(),Ny=wl(),Cy=Qe(),jy=Sl(),Ly=Ol(),zy=Si(),My=Pl(),Dy=Rl(),Uy=rn(),Zy=Ti(),Fy=Na(),Gy=Ca(),By=Oi(),qy=$i(),Vy=ja(),Hy=Zl(),Jy=nn(),Wy=et(),Ky=an(),Yy=rd(),Xy=id(),Qy=ad(),eb=cd(),tb=dd(),rb=Pi(),nb=_d(),ib=bd(),sb=xd(),ab=Sd(),ob=Pd();Nd.exports={parse:Ty,valid:Oy,clean:$y,inc:Iy,diff:Ay,major:Py,minor:ky,patch:Ry,prerelease:Ny,compare:Cy,rcompare:jy,compareLoose:Ly,compareBuild:zy,sort:My,rsort:Dy,gt:Uy,lt:Zy,eq:Fy,neq:Gy,gte:By,lte:qy,cmp:Vy,coerce:Hy,Comparator:Jy,Range:Wy,satisfies:Ky,toComparators:Yy,maxSatisfying:Xy,minSatisfying:Qy,minVersion:eb,validRange:tb,outside:rb,gtr:nb,ltr:ib,intersects:sb,simplifyRange:ab,subset:ob,SemVer:Sy,re:Va.re,src:Va.src,tokens:Va.t,SEMVER_SPEC_VERSION:kd.SEMVER_SPEC_VERSION,RELEASE_TYPES:kd.RELEASE_TYPES,compareIdentifiers:Rd.compareIdentifiers,rcompareIdentifiers:Rd.rcompareIdentifiers}});var tf=z((WT,ef)=>{"use strict";var Xd=(r=0)=>e=>`\x1B[${38+r};5;${e}m`,Qd=(r=0)=>(e,t,n)=>`\x1B[${38+r};2;${e};${t};${n}m`;function Nb(){let r=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,n]of Object.entries(e)){for(let[i,s]of Object.entries(n))e[i]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},n[i]=e[i],r.set(s[0],s[1]);Object.defineProperty(e,t,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:r,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=Xd(),e.color.ansi16m=Qd(),e.bgColor.ansi256=Xd(10),e.bgColor.ansi16m=Qd(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,n,i)=>t===n&&n===i?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5),enumerable:!1},hexToRgb:{value:t=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!n)return[0,0,0];let{colorString:i}=n.groups;i.length===3&&(i=i.split("").map(a=>a+a).join(""));let s=Number.parseInt(i,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(ef,"exports",{enumerable:!0,get:Nb})});var sh={};ve(sh,{BasePromptValue:()=>fr,ChatPromptValue:()=>ks,ImagePromptValue:()=>Rs,StringPromptValue:()=>Fr});var Qp={};ve(Qp,{Serializable:()=>We,get_lc_unique_name:()=>An});var uu=pt(eu(),1),cu=pt(ou(),1);function lu(r,e){return e?.[r]||(0,uu.default)(r)}function Hv(r,e){return e?.[r]||(0,cu.default)(r)}function du(r,e,t){let n={};for(let i in r)Object.hasOwn(r,i)&&(n[e(i,t)]=r[i]);return n}function fu(r){return Array.isArray(r)?[...r]:l({},r)}function Xp(r,e){let t=fu(r);for(let[n,i]of Object.entries(e)){let[s,...a]=n.split(".").reverse(),o=t;for(let u of a.reverse()){if(o[u]===void 0)break;o[u]=fu(o[u]),o=o[u]}o[s]!==void 0&&(o[s]={lc:1,type:"secret",id:[i]})}return t}function An(r){let e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var We=class r{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,An(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>this.lc_serializable_keys?.includes(n))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof r||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},n=Object.keys(this.lc_kwargs).reduce((i,s)=>(i[s]=s in this?this[s]:this.lc_kwargs[s],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(n,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(i=>{let s=this,a=n,[o,...u]=i.split(".").reverse();for(let c of u.reverse()){if(!(c in s)||s[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof s[c]=="object"&&s[c]!=null?a[c]={}:Array.isArray(s[c])&&(a[c]=[])),s=s[c],a=a[c]}o in s&&s[o]!==void 0&&(a[o]=a[o]||s[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:du(Object.keys(t).length?Xp(n,t):n,lu,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function Rt(r){return typeof r=="object"&&r!==null&&"type"in r&&typeof r.type=="string"&&"source_type"in r&&(r.source_type==="url"||r.source_type==="base64"||r.source_type==="text"||r.source_type==="id")}function Yv(r){return Rt(r)&&r.source_type==="url"&&"url"in r&&typeof r.url=="string"}function Xv(r){return Rt(r)&&r.source_type==="base64"&&"data"in r&&typeof r.data=="string"}function Qv(r){return Rt(r)&&r.source_type==="text"&&"text"in r&&typeof r.text=="string"}function ex(r){return Rt(r)&&r.source_type==="id"&&"id"in r&&typeof r.id=="string"}function tx(r){if(Rt(r)){if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url}};if(r.source_type==="base64"){if(!r.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${r.mime_type};base64,${r.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function rx(r){let e=r.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${r}" - does not match type/subtype format.`);let t=e[0].trim(),n=e[1].trim();if(t===""||n==="")throw new Error(`Invalid mime type: "${r}" - type or subtype is empty.`);let i={};for(let s of r.split(";").slice(1)){let a=s.split("=");if(a.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${r}".`);let o=a[0].trim(),u=a[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${r}".`);i[o]=u}return{type:t,subtype:n,parameters:i}}function nx({dataUrl:r,asTypedArray:e=!1}){let t=r.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/),n;if(t){n=t[1].toLowerCase();let i=e?Uint8Array.from(atob(t[2]),s=>s.charCodeAt(0)):t[2];return{mime_type:n,data:i}}}function ix(r,e){if(r.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(r)}if(r.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(r)}if(r.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(r)}if(r.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(r)}throw new Error(`Unable to convert content block type '${r.type}' to provider-specific format: not recognized.`)}function Ke(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:Array.isArray(e)&&e.some(t=>Rt(t))?[{type:"text",source_type:"text",text:r},...e]:[{type:"text",text:r},...e]:Array.isArray(e)?Dr(r,e)??[...r,...e]:e===""?r:Array.isArray(r)&&r.some(t=>Rt(t))?[...r,{type:"file",source_type:"text",text:e}]:[...r,{type:"text",text:e}]}function pu(r,e){return r==="error"||e==="error"?"error":"success"}function eh(r,e){function t(n,i){if(typeof n!="object"||n===null||n===void 0)return n;if(i>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(a=>t(a,i+1));let s={};for(let a of Object.keys(n))s[a]=t(n[a],i+1);return s}return JSON.stringify(t(r,0),null,2)}var ke=class extends We{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=eh(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};function ux(r){return Array.isArray(r)&&r.every(e=>typeof e.index=="number")}function fe(r,e){let t=l({},r);for(let[n,i]of Object.entries(e))if(t[n]==null)t[n]=i;else{if(i==null)continue;if(typeof t[n]!=typeof i||Array.isArray(t[n])!==Array.isArray(i))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=i}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=fe(t[n],i);else if(Array.isArray(t[n]))t[n]=Dr(t[n],i);else{if(t[n]===i)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function Dr(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{let t=[...r];for(let n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){let i=t.findIndex(s=>s.index===n.index);i!==-1?t[i]=fe(t[i],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function hu(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return Dr(r,e);if(typeof r=="object"&&typeof e=="object")return fe(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}var Ze=class extends ke{};function mu(r){return typeof r.role=="string"}function Is(r){return typeof r?._getType=="function"}function cx(r){return Is(r)&&typeof r.concat=="function"}var Tt=class extends ke{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}},Pn=class r extends Ze{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new r({content:Ke(this.content,e.content),additional_kwargs:fe(this.additional_kwargs,e.additional_kwargs),response_metadata:fe(this.response_metadata,e.response_metadata),id:this.id??e.id})}};function px(r){return r.getType()==="human"}function hx(r){return r.getType()==="human"}function kn(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Nn(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}function _x(r){return!!(r&&typeof r=="object"&&"toolCall"in r&&r.toolCall!=null&&typeof r.toolCall=="object"&&"id"in r.toolCall&&typeof r.toolCall.id=="string")}var Rn=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}};function bx(r,e=As){r=r.trim();let t=r.indexOf("```");if(t===-1)return e(r);let n=r.substring(t+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));let i=n.indexOf("```"),s=n;return i!==-1&&(s=n.substring(0,i)),e(s.trim())}function As(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="",t=[],n=!1,i=!1;for(let s of r){if(n)s==='"'&&!i?n=!1:s===`
`&&!i?s="\\n":s==="\\"?i=!i:i=!1;else if(s==='"')n=!0,i=!1;else if(s==="{")t.push("}");else if(s==="[")t.push("]");else if(s==="}"||s==="]")if(t&&t[t.length-1]===s)t.pop();else return null;e+=s}n&&(e+='"');for(let s=t.length-1;s>=0;s-=1)e+=t[s];try{return JSON.parse(e)}catch{return null}}function xx(r){return r!=null&&typeof r=="object"&&"lc_direct_tool_output"in r&&r.lc_direct_tool_output===!0}var Ur=class extends ke{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return g(l({},super._printableFields),{tool_call_id:this.tool_call_id,artifact:this.artifact})}},gu=class r extends Ze{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new r({content:Ke(this.content,e.content),additional_kwargs:fe(this.additional_kwargs,e.additional_kwargs),response_metadata:fe(this.response_metadata,e.response_metadata),artifact:hu(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:pu(this.status,e.status)})}get _printableFields(){return g(l({},super._printableFields),{tool_call_id:this.tool_call_id,artifact:this.artifact})}};function _u(r){let e=[],t=[];for(let n of r)if(n.function){let i=n.function.name;try{let s=JSON.parse(n.function.arguments),a={name:i||"",args:s||{},id:n.id};e.push(a)}catch{t.push({name:i,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}function Ex(r){return r._getType()==="tool"}function Sx(r){return r._getType()==="tool"}var lr=class extends ke{get lc_aliases(){return g(l({},super.lc_aliases),{tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"})}constructor(e,t){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;let i=n.additional_kwargs?.tool_calls,s=n.tool_calls;i!=null&&i.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&s===void 0){let[a,o]=_u(i);n.tool_calls=a??[],n.invalid_tool_calls=o??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return g(l({},super._printableFields),{tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata})}};function Px(r){return r._getType()==="ai"}function kx(r){return r._getType()==="ai"}var Nt=class r extends Ze{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t=g(l({},e),{tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0});else{let n=e.tool_call_chunks.reduce((a,o)=>(o.id&&(a[o.id]=a[o.id]??[],a[o.id].push(o)),a),{}),i=[],s=[];for(let[a,o]of Object.entries(n)){let u={},c=o[0]?.name??"",d=o.map(m=>m.args||"").join(""),f=d.length?d:"{}";try{if(u=As(f),u===null||typeof u!="object"||Array.isArray(u))throw new Error("Malformed tool call chunk args.");i.push({name:c,args:u,id:a,type:"tool_call"})}catch{s.push({name:c,args:f,id:a,error:"Malformed args.",type:"invalid_tool_call"})}}t=g(l({},e),{tool_calls:i,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0})}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return g(l({},super.lc_aliases),{tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"})}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return g(l({},super._printableFields),{tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata})}concat(e){let t={content:Ke(this.content,e.content),additional_kwargs:fe(this.additional_kwargs,e.additional_kwargs),response_metadata:fe(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let n=Dr(this.tool_call_chunks,e.tool_call_chunks);n!==void 0&&n.length>0&&(t.tool_call_chunks=n)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let n=l(l(l({},(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)}),(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)}),(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}),i=l(l({},(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)}),(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}),s=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},o=l(l({input_tokens:s.input_tokens+a.input_tokens,output_tokens:s.output_tokens+a.output_tokens,total_tokens:s.total_tokens+a.total_tokens},Object.keys(n).length>0&&{input_token_details:n}),Object.keys(i).length>0&&{output_token_details:i});t.usage_metadata=o}return new r(t)}};var Zr=class r extends ke{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return r}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return g(l({},super._printableFields),{role:this.role})}},Cn=class r extends Ze{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new r({content:Ke(this.content,e.content),additional_kwargs:fe(this.additional_kwargs,e.additional_kwargs),response_metadata:fe(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return g(l({},super._printableFields),{role:this.role})}};function jx(r){return r._getType()==="generic"}function Lx(r){return r._getType()==="generic"}var jn=class extends ke{static lc_name(){return"FunctionMessage"}constructor(e,t){typeof e=="string"&&(e={content:e,name:t}),super(e)}_getType(){return"function"}},Ln=class r extends Ze{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new r({content:Ke(this.content,e.content),additional_kwargs:fe(this.additional_kwargs,e.additional_kwargs),response_metadata:fe(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function Ux(r){return r._getType()==="function"}function Zx(r){return r._getType()==="function"}var dr=class extends ke{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}},zn=class r extends Ze{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new r({content:Ke(this.content,e.content),additional_kwargs:fe(this.additional_kwargs,e.additional_kwargs),response_metadata:fe(this.response_metadata,e.response_metadata),id:this.id??e.id})}};function Bx(r){return r._getType()==="system"}function qx(r){return r._getType()==="system"}function th(r){return Nn(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function rh(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function Ps(r){let e,t;if(rh(r)){let s=r.id.at(-1);s==="HumanMessage"||s==="HumanMessageChunk"?e="user":s==="AIMessage"||s==="AIMessageChunk"?e="assistant":s==="SystemMessage"||s==="SystemMessageChunk"?e="system":s==="FunctionMessage"||s==="FunctionMessageChunk"?e="function":s==="ToolMessage"||s==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{let n=r,{type:s}=n,a=ae(n,["type"]);e=s,t=a}if(e==="human"||e==="user")return new Tt(t);if(e==="ai"||e==="assistant"){let i=t,{tool_calls:s}=i,a=ae(i,["tool_calls"]);if(!Array.isArray(s))return new lr(t);let o=s.map(th);return new lr(g(l({},a),{tool_calls:o}))}else{if(e==="system")return new dr(t);if(e==="developer")return new dr(g(l({},t),{additional_kwargs:g(l({},t.additional_kwargs),{__openai_role__:"developer"})}));if(e==="tool"&&"tool_call_id"in t)return new Ur(g(l({},t),{content:t.content,tool_call_id:t.tool_call_id,name:t.name}));throw kn(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function rE(r){if(typeof r=="string")return new Tt(r);if(Is(r))return r;if(Array.isArray(r)){let[t,n]=r;return Ps({type:t,content:n})}else if(mu(r)){let e=r,{role:t}=e,n=ae(e,["role"]);return Ps(g(l({},n),{type:t}))}else return Ps(r)}function Mn(r,e="Human",t="AI"){let n=[];for(let i of r){let s;if(i._getType()==="human")s=e;else if(i._getType()==="ai")s=t;else if(i._getType()==="system")s="System";else if(i._getType()==="function")s="Function";else if(i._getType()==="tool")s="Tool";else if(i._getType()==="generic")s=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);let a=i.name?`${i.name}, `:"",o=typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2);n.push(`${s}: ${a}${o}`)}return n.join(`
`)}function nh(r){if(r.data!==void 0)return r;{let e=r;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function ih(r){let e=nh(r);switch(e.type){case"human":return new Tt(e.data);case"ai":return new lr(e.data);case"system":return new dr(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new jn(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new Ur(e.data);case"generic":{if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new Zr(e.data)}default:throw new Error(`Got unexpected type: ${e.type}`)}}function nE(r){return r.map(ih)}function iE(r){return r.map(e=>e.toDict())}function sE(r){let e=r._getType();if(e==="human")return new Pn(l({},r));if(e==="ai"){let t=l({},r);return"tool_calls"in t&&(t=g(l({},t),{tool_call_chunks:t.tool_calls?.map(n=>g(l({},n),{type:"tool_call_chunk",index:void 0,args:JSON.stringify(n.args)}))})),new Nt(l({},t))}else{if(e==="system")return new zn(l({},r));if(e==="function")return new Ln(l({},r));if(Zr.isInstance(r))return new Cn(l({},r));throw new Error("Unknown message type.")}}var fr=class extends We{},Fr=class extends fr{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Tt(this.value)]}},ks=class extends fr{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return Mn(this.messages)}toChatMessages(){return this.messages}},Rs=class extends fr{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new Tt({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}};var Lt={};ve(Lt,{BRAND:()=>kh,DIRTY:()=>Ht,EMPTY_PATH:()=>ch,INVALID:()=>D,NEVER:()=>mm,OK:()=>$e,ParseStatus:()=>Ee,Schema:()=>Y,ZodAny:()=>Zn,ZodArray:()=>qr,ZodBigInt:()=>Ls,ZodBoolean:()=>zs,ZodBranded:()=>Vr,ZodCatch:()=>Hs,ZodDate:()=>Ms,ZodDefault:()=>Vs,ZodDiscriminatedUnion:()=>Fn,ZodEffects:()=>yr,ZodEnum:()=>Vn,ZodError:()=>mt,ZodFirstPartyTypeKind:()=>S,ZodFunction:()=>Bn,ZodIntersection:()=>Fs,ZodIssueCode:()=>E,ZodLazy:()=>Gs,ZodLiteral:()=>Bs,ZodMap:()=>$u,ZodNaN:()=>Pu,ZodNativeEnum:()=>qs,ZodNever:()=>Jt,ZodNull:()=>Us,ZodNullable:()=>br,ZodNumber:()=>js,ZodObject:()=>gr,ZodOptional:()=>jt,ZodParsedType:()=>I,ZodPipeline:()=>Hr,ZodPromise:()=>Hn,ZodReadonly:()=>Js,ZodRecord:()=>Gn,ZodSchema:()=>Y,ZodSet:()=>Iu,ZodString:()=>qn,ZodSymbol:()=>Tu,ZodTransformer:()=>yr,ZodTuple:()=>_r,ZodType:()=>Y,ZodUndefined:()=>Ds,ZodUnion:()=>Zs,ZodUnknown:()=>Br,ZodVoid:()=>Ou,addIssueToContext:()=>O,any:()=>Uh,array:()=>Bh,bigint:()=>jh,boolean:()=>Cu,coerce:()=>hm,custom:()=>ku,date:()=>Lh,datetimeRegex:()=>Su,defaultErrorMap:()=>Ot,discriminatedUnion:()=>Jh,effect:()=>am,enum:()=>nm,function:()=>em,getErrorMap:()=>pr,getParsedType:()=>ht,instanceof:()=>Nh,intersection:()=>Wh,isAborted:()=>Dn,isAsync:()=>hr,isDirty:()=>Un,isValid:()=>Ct,late:()=>Rh,lazy:()=>tm,literal:()=>rm,makeIssue:()=>Gr,map:()=>Xh,nan:()=>Ch,nativeEnum:()=>im,never:()=>Fh,null:()=>Dh,nullable:()=>um,number:()=>Nu,object:()=>qh,objectUtil:()=>yu,oboolean:()=>pm,onumber:()=>fm,optional:()=>om,ostring:()=>dm,pipeline:()=>lm,preprocess:()=>cm,promise:()=>sm,quotelessJson:()=>ah,record:()=>Yh,set:()=>Qh,setErrorMap:()=>uh,strictObject:()=>Vh,string:()=>Ru,symbol:()=>zh,transformer:()=>am,tuple:()=>Kh,undefined:()=>Mh,union:()=>Hh,unknown:()=>Zh,util:()=>te,void:()=>Gh});var te;(function(r){r.assertEqual=i=>{};function e(i){}r.assertIs=e;function t(i){throw new Error}r.assertNever=t,r.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},r.getValidEnumValues=i=>{let s=r.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return r.objectValues(a)},r.objectValues=i=>r.objectKeys(i).map(function(s){return i[s]}),r.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},r.find=(i,s)=>{for(let a of i)if(s(a))return a},r.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}r.joinValues=n,r.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(te||(te={}));var yu=function(r){return r.mergeShapes=(e,t)=>l(l({},e),t),r}(yu||{}),I=te.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ht=r=>{switch(typeof r){case"undefined":return I.undefined;case"string":return I.string;case"number":return Number.isNaN(r)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":return Array.isArray(r)?I.array:r===null?I.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?I.promise:typeof Map<"u"&&r instanceof Map?I.map:typeof Set<"u"&&r instanceof Set?I.set:typeof Date<"u"&&r instanceof Date?I.date:I.object;default:return I.unknown}};var E=te.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),ah=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),mt=(()=>{class r extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){let n=t||function(a){return a.message},i={_errors:[]},s=a=>{for(let o of a.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)i._errors.push(n(o));else{let u=i,c=0;for(;c<o.path.length;){let d=o.path[c];c===o.path.length-1?(u[d]=u[d]||{_errors:[]},u[d]._errors.push(n(o))):u[d]=u[d]||{_errors:[]},u=u[d],c++}}};return s(this),i}static assert(t){if(!(t instanceof r))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,te.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){let n={},i=[];for(let s of this.issues)if(s.path.length>0){let a=s.path[0];n[a]=n[a]||[],n[a].push(t(s))}else i.push(t(s));return{formErrors:i,fieldErrors:n}}get formErrors(){return this.flatten()}}return r.create=e=>new r(e),r})();var oh=(r,e)=>{let t;switch(r.code){case E.invalid_type:r.received===I.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case E.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,te.jsonStringifyReplacer)}`;break;case E.unrecognized_keys:t=`Unrecognized key(s) in object: ${te.joinValues(r.keys,", ")}`;break;case E.invalid_union:t="Invalid input";break;case E.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${te.joinValues(r.options)}`;break;case E.invalid_enum_value:t=`Invalid enum value. Expected ${te.joinValues(r.options)}, received '${r.received}'`;break;case E.invalid_arguments:t="Invalid function arguments";break;case E.invalid_return_type:t="Invalid function return type";break;case E.invalid_date:t="Invalid date";break;case E.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:te.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case E.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case E.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case E.custom:t="Invalid input";break;case E.invalid_intersection_types:t="Intersection results could not be merged";break;case E.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case E.not_finite:t="Number must be finite";break;default:t=e.defaultError,te.assertNever(r)}return{message:t}},Ot=oh;var bu=Ot;function uh(r){bu=r}function pr(){return bu}var Gr=r=>{let{data:e,path:t,errorMaps:n,issueData:i}=r,s=[...t,...i.path||[]],a=g(l({},i),{path:s});if(i.message!==void 0)return g(l({},i),{path:s,message:i.message});let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return g(l({},i),{path:s,message:o})},ch=[];function O(r,e){let t=pr(),n=Gr({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Ot?void 0:Ot].filter(i=>!!i)});r.common.issues.push(n)}var Ee=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let i of t){if(i.status==="aborted")return D;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static mergeObjectAsync(e,t){return p(this,null,function*(){let n=[];for(let i of t){let s=yield i.key,a=yield i.value;n.push({key:s,value:a})}return r.mergeObjectSync(e,n)})}static mergeObjectSync(e,t){let n={};for(let i of t){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return D;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},D=Object.freeze({status:"aborted"}),Ht=r=>({status:"dirty",value:r}),$e=r=>({status:"valid",value:r}),Dn=r=>r.status==="aborted",Un=r=>r.status==="dirty",Ct=r=>r.status==="valid",hr=r=>typeof Promise<"u"&&r instanceof Promise;var C=function(r){return r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message,r}(C||{});var Ye=class{constructor(e,t,n,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},wu=(r,e)=>{if(Ct(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new mt(r.common.issues);return this._error=t,this._error}}};function W(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:i}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{let{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??n??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:i}}var Y=class{get description(){return this._def.description}_getType(e){return ht(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ee,ctx:{common:e.parent.common,data:e.data,parsedType:ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(hr(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ht(e)},i=this._parseSync({data:e,path:n.path,parent:n});return wu(n,i)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ht(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return Ct(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(n=>Ct(n)?{value:n.value}:{issues:t.common.issues})}parseAsync(e,t){return p(this,null,function*(){let n=yield this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error})}safeParseAsync(e,t){return p(this,null,function*(){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ht(e)},i=this._parse({data:e,path:n.path,parent:n}),s=yield hr(i)?i:Promise.resolve(i);return wu(n,s)})}refine(e,t){let n=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue(l({code:E.custom},n(i)));return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof t=="function"?t(n,i):t),!1))}_refinement(e){return new yr({schema:this,typeName:S.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return jt.create(this,this._def)}nullable(){return br.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return qr.create(this)}promise(){return Hn.create(this,this._def)}or(e){return Zs.create([this,e],this._def)}and(e){return Fs.create(this,e,this._def)}transform(e){return new yr(g(l({},W(this._def)),{schema:this,typeName:S.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){let t=typeof e=="function"?e:()=>e;return new Vs(g(l({},W(this._def)),{innerType:this,defaultValue:t,typeName:S.ZodDefault}))}brand(){return new Vr(l({typeName:S.ZodBranded,type:this},W(this._def)))}catch(e){let t=typeof e=="function"?e:()=>e;return new Hs(g(l({},W(this._def)),{innerType:this,catchValue:t,typeName:S.ZodCatch}))}describe(e){let t=this.constructor;return new t(g(l({},this._def),{description:e}))}pipe(e){return Hr.create(this,e)}readonly(){return Js.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},lh=/^c[^\s-]{8,}$/i,dh=/^[0-9a-z]+$/,fh=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ph=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,hh=/^[a-z0-9_-]{21}$/i,mh=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,gh=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_h=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,yh="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ns,bh=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wh=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,vh=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,xh=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Eh=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Sh=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xu="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Th=new RegExp(`^${xu}$`);function Eu(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Oh(r){return new RegExp(`^${Eu(r)}$`)}function Su(r){let e=`${xu}T${Eu(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function $h(r,e){return!!((e==="v4"||!e)&&bh.test(r)||(e==="v6"||!e)&&vh.test(r))}function Ih(r,e){if(!mh.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||"typ"in i&&i?.typ!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function Ah(r,e){return!!((e==="v4"||!e)&&wh.test(r)||(e==="v6"||!e)&&xh.test(r))}var qn=(()=>{class r extends Y{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==I.string){let a=this._getOrReturnCtx(t);return O(a,{code:E.invalid_type,expected:I.string,received:a.parsedType}),D}let i=new Ee,s;for(let a of this._def.checks)if(a.kind==="min")t.data.length<a.value&&(s=this._getOrReturnCtx(t,s),O(s,{code:E.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),i.dirty());else if(a.kind==="max")t.data.length>a.value&&(s=this._getOrReturnCtx(t,s),O(s,{code:E.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),i.dirty());else if(a.kind==="length"){let o=t.data.length>a.value,u=t.data.length<a.value;(o||u)&&(s=this._getOrReturnCtx(t,s),o?O(s,{code:E.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):u&&O(s,{code:E.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),i.dirty())}else if(a.kind==="email")_h.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"email",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="emoji")Ns||(Ns=new RegExp(yh,"u")),Ns.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"emoji",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="uuid")ph.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"uuid",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="nanoid")hh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"nanoid",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="cuid")lh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"cuid",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="cuid2")dh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"cuid2",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="ulid")fh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"ulid",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="url")try{new URL(t.data)}catch{s=this._getOrReturnCtx(t,s),O(s,{validation:"url",code:E.invalid_string,message:a.message}),i.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"regex",code:E.invalid_string,message:a.message}),i.dirty())):a.kind==="trim"?t.data=t.data.trim():a.kind==="includes"?t.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),i.dirty()):a.kind==="toLowerCase"?t.data=t.data.toLowerCase():a.kind==="toUpperCase"?t.data=t.data.toUpperCase():a.kind==="startsWith"?t.data.startsWith(a.value)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:{startsWith:a.value},message:a.message}),i.dirty()):a.kind==="endsWith"?t.data.endsWith(a.value)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:{endsWith:a.value},message:a.message}),i.dirty()):a.kind==="datetime"?Su(a).test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:"datetime",message:a.message}),i.dirty()):a.kind==="date"?Th.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:"date",message:a.message}),i.dirty()):a.kind==="time"?Oh(a).test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:"time",message:a.message}),i.dirty()):a.kind==="duration"?gh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"duration",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="ip"?$h(t.data,a.version)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"ip",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="jwt"?Ih(t.data,a.alg)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"jwt",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="cidr"?Ah(t.data,a.version)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"cidr",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="base64"?Eh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"base64",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="base64url"?Sh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"base64url",code:E.invalid_string,message:a.message}),i.dirty()):te.assertNever(a);return{status:i.value,value:t.data}}_regex(t,n,i){return this.refinement(s=>t.test(s),l({validation:n,code:E.invalid_string},C.errToObj(i)))}_addCheck(t){return new r(g(l({},this._def),{checks:[...this._def.checks,t]}))}email(t){return this._addCheck(l({kind:"email"},C.errToObj(t)))}url(t){return this._addCheck(l({kind:"url"},C.errToObj(t)))}emoji(t){return this._addCheck(l({kind:"emoji"},C.errToObj(t)))}uuid(t){return this._addCheck(l({kind:"uuid"},C.errToObj(t)))}nanoid(t){return this._addCheck(l({kind:"nanoid"},C.errToObj(t)))}cuid(t){return this._addCheck(l({kind:"cuid"},C.errToObj(t)))}cuid2(t){return this._addCheck(l({kind:"cuid2"},C.errToObj(t)))}ulid(t){return this._addCheck(l({kind:"ulid"},C.errToObj(t)))}base64(t){return this._addCheck(l({kind:"base64"},C.errToObj(t)))}base64url(t){return this._addCheck(l({kind:"base64url"},C.errToObj(t)))}jwt(t){return this._addCheck(l({kind:"jwt"},C.errToObj(t)))}ip(t){return this._addCheck(l({kind:"ip"},C.errToObj(t)))}cidr(t){return this._addCheck(l({kind:"cidr"},C.errToObj(t)))}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck(l({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:t?.offset??!1,local:t?.local??!1},C.errToObj(t?.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(l({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision},C.errToObj(t?.message)))}duration(t){return this._addCheck(l({kind:"duration"},C.errToObj(t)))}regex(t,n){return this._addCheck(l({kind:"regex",regex:t},C.errToObj(n)))}includes(t,n){return this._addCheck(l({kind:"includes",value:t,position:n?.position},C.errToObj(n?.message)))}startsWith(t,n){return this._addCheck(l({kind:"startsWith",value:t},C.errToObj(n)))}endsWith(t,n){return this._addCheck(l({kind:"endsWith",value:t},C.errToObj(n)))}min(t,n){return this._addCheck(l({kind:"min",value:t},C.errToObj(n)))}max(t,n){return this._addCheck(l({kind:"max",value:t},C.errToObj(n)))}length(t,n){return this._addCheck(l({kind:"length",value:t},C.errToObj(n)))}nonempty(t){return this.min(1,C.errToObj(t))}trim(){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}return r.create=e=>new r(l({checks:[],typeName:S.ZodString,coerce:e?.coerce??!1},W(e))),r})();function Ph(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=t>n?t:n,s=Number.parseInt(r.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}var js=(()=>{class r extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==I.number){let a=this._getOrReturnCtx(t);return O(a,{code:E.invalid_type,expected:I.number,received:a.parsedType}),D}let i,s=new Ee;for(let a of this._def.checks)a.kind==="int"?te.isInteger(t.data)||(i=this._getOrReturnCtx(t,i),O(i,{code:E.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?Ph(t.data,a.value)!==0&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(t.data)||(i=this._getOrReturnCtx(t,i),O(i,{code:E.not_finite,message:a.message}),s.dirty()):te.assertNever(a);return{status:s.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,C.toString(n))}gt(t,n){return this.setLimit("min",t,!1,C.toString(n))}lte(t,n){return this.setLimit("max",t,!0,C.toString(n))}lt(t,n){return this.setLimit("max",t,!1,C.toString(n))}setLimit(t,n,i,s){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:t,value:n,inclusive:i,message:C.toString(s)}]}))}_addCheck(t){return new r(g(l({},this._def),{checks:[...this._def.checks,t]}))}int(t){return this._addCheck({kind:"int",message:C.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:C.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:C.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:C.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:C.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:C.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:C.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:C.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:C.toString(t)})}get minValue(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&te.isInteger(t.value))}get isFinite(){let t=null,n=null;for(let i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(n===null||i.value>n)&&(n=i.value):i.kind==="max"&&(t===null||i.value<t)&&(t=i.value)}return Number.isFinite(n)&&Number.isFinite(t)}}return r.create=e=>new r(l({checks:[],typeName:S.ZodNumber,coerce:e?.coerce||!1},W(e))),r})(),Ls=(()=>{class r extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==I.bigint)return this._getInvalidInput(t);let i,s=new Ee;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?t.data%a.value!==BigInt(0)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):te.assertNever(a);return{status:s.value,value:t.data}}_getInvalidInput(t){let n=this._getOrReturnCtx(t);return O(n,{code:E.invalid_type,expected:I.bigint,received:n.parsedType}),D}gte(t,n){return this.setLimit("min",t,!0,C.toString(n))}gt(t,n){return this.setLimit("min",t,!1,C.toString(n))}lte(t,n){return this.setLimit("max",t,!0,C.toString(n))}lt(t,n){return this.setLimit("max",t,!1,C.toString(n))}setLimit(t,n,i,s){return new r(g(l({},this._def),{checks:[...this._def.checks,{kind:t,value:n,inclusive:i,message:C.toString(s)}]}))}_addCheck(t){return new r(g(l({},this._def),{checks:[...this._def.checks,t]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:C.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:C.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:C.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:C.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:C.toString(n)})}get minValue(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}return r.create=e=>new r(l({checks:[],typeName:S.ZodBigInt,coerce:e?.coerce??!1},W(e))),r})(),zs=(()=>{class r extends Y{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==I.boolean){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.boolean,received:i.parsedType}),D}return $e(t.data)}}return r.create=e=>new r(l({typeName:S.ZodBoolean,coerce:e?.coerce||!1},W(e))),r})(),Ms=(()=>{class r extends Y{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==I.date){let a=this._getOrReturnCtx(t);return O(a,{code:E.invalid_type,expected:I.date,received:a.parsedType}),D}if(Number.isNaN(t.data.getTime())){let a=this._getOrReturnCtx(t);return O(a,{code:E.invalid_date}),D}let i=new Ee,s;for(let a of this._def.checks)a.kind==="min"?t.data.getTime()<a.value&&(s=this._getOrReturnCtx(t,s),O(s,{code:E.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),i.dirty()):a.kind==="max"?t.data.getTime()>a.value&&(s=this._getOrReturnCtx(t,s),O(s,{code:E.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),i.dirty()):te.assertNever(a);return{status:i.value,value:new Date(t.data.getTime())}}_addCheck(t){return new r(g(l({},this._def),{checks:[...this._def.checks,t]}))}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:C.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:C.toString(n)})}get minDate(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}return r.create=e=>new r(l({checks:[],coerce:e?.coerce||!1,typeName:S.ZodDate},W(e))),r})(),Tu=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.symbol){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.symbol,received:i.parsedType}),D}return $e(t.data)}}return r.create=e=>new r(l({typeName:S.ZodSymbol},W(e))),r})(),Ds=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.undefined){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.undefined,received:i.parsedType}),D}return $e(t.data)}}return r.create=e=>new r(l({typeName:S.ZodUndefined},W(e))),r})(),Us=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.null){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.null,received:i.parsedType}),D}return $e(t.data)}}return r.create=e=>new r(l({typeName:S.ZodNull},W(e))),r})(),Zn=(()=>{class r extends Y{constructor(){super(...arguments),this._any=!0}_parse(t){return $e(t.data)}}return r.create=e=>new r(l({typeName:S.ZodAny},W(e))),r})(),Br=(()=>{class r extends Y{constructor(){super(...arguments),this._unknown=!0}_parse(t){return $e(t.data)}}return r.create=e=>new r(l({typeName:S.ZodUnknown},W(e))),r})(),Jt=(()=>{class r extends Y{_parse(t){let n=this._getOrReturnCtx(t);return O(n,{code:E.invalid_type,expected:I.never,received:n.parsedType}),D}}return r.create=e=>new r(l({typeName:S.ZodNever},W(e))),r})(),Ou=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.undefined){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.void,received:i.parsedType}),D}return $e(t.data)}}return r.create=e=>new r(l({typeName:S.ZodVoid},W(e))),r})(),qr=(()=>{class r extends Y{_parse(t){let{ctx:n,status:i}=this._processInputParams(t),s=this._def;if(n.parsedType!==I.array)return O(n,{code:E.invalid_type,expected:I.array,received:n.parsedType}),D;if(s.exactLength!==null){let o=n.data.length>s.exactLength.value,u=n.data.length<s.exactLength.value;(o||u)&&(O(n,{code:o?E.too_big:E.too_small,minimum:u?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),i.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(O(n,{code:E.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),i.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(O(n,{code:E.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),i.dirty()),n.common.async)return Promise.all([...n.data].map((o,u)=>s.type._parseAsync(new Ye(n,o,n.path,u)))).then(o=>Ee.mergeArray(i,o));let a=[...n.data].map((o,u)=>s.type._parseSync(new Ye(n,o,n.path,u)));return Ee.mergeArray(i,a)}get element(){return this._def.type}min(t,n){return new r(g(l({},this._def),{minLength:{value:t,message:C.toString(n)}}))}max(t,n){return new r(g(l({},this._def),{maxLength:{value:t,message:C.toString(n)}}))}length(t,n){return new r(g(l({},this._def),{exactLength:{value:t,message:C.toString(n)}}))}nonempty(t){return this.min(1,t)}}return r.create=(e,t)=>new r(l({type:e,minLength:null,maxLength:null,exactLength:null,typeName:S.ZodArray},W(t))),r})();function mr(r){if(r instanceof gr){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=jt.create(mr(n))}return new gr(g(l({},r._def),{shape:()=>e}))}else return r instanceof qr?new qr(g(l({},r._def),{type:mr(r.element)})):r instanceof jt?jt.create(mr(r.unwrap())):r instanceof br?br.create(mr(r.unwrap())):r instanceof _r?_r.create(r.items.map(e=>mr(e))):r}var gr=(()=>{class r extends Y{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),n=te.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==I.object){let d=this._getOrReturnCtx(t);return O(d,{code:E.invalid_type,expected:I.object,received:d.parsedType}),D}let{status:i,ctx:s}=this._processInputParams(t),{shape:a,keys:o}=this._getCached(),u=[];if(!(this._def.catchall instanceof Jt&&this._def.unknownKeys==="strip"))for(let d in s.data)o.includes(d)||u.push(d);let c=[];for(let d of o){let f=a[d],m=s.data[d];c.push({key:{status:"valid",value:d},value:f._parse(new Ye(s,m,s.path,d)),alwaysSet:d in s.data})}if(this._def.catchall instanceof Jt){let d=this._def.unknownKeys;if(d==="passthrough")for(let f of u)c.push({key:{status:"valid",value:f},value:{status:"valid",value:s.data[f]}});else if(d==="strict")u.length>0&&(O(s,{code:E.unrecognized_keys,keys:u}),i.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let f of u){let m=s.data[f];c.push({key:{status:"valid",value:f},value:d._parse(new Ye(s,m,s.path,f)),alwaysSet:f in s.data})}}return s.common.async?Promise.resolve().then(()=>p(this,null,function*(){let d=[];for(let f of c){let m=yield f.key,h=yield f.value;d.push({key:m,value:h,alwaysSet:f.alwaysSet})}return d})).then(d=>Ee.mergeObjectSync(i,d)):Ee.mergeObjectSync(i,c)}get shape(){return this._def.shape()}strict(t){return C.errToObj,new r(l(g(l({},this._def),{unknownKeys:"strict"}),t!==void 0?{errorMap:(n,i)=>{let s=this._def.errorMap?.(n,i).message??i.defaultError;return n.code==="unrecognized_keys"?{message:C.errToObj(t).message??s}:{message:s}}}:{}))}strip(){return new r(g(l({},this._def),{unknownKeys:"strip"}))}passthrough(){return new r(g(l({},this._def),{unknownKeys:"passthrough"}))}extend(t){return new r(g(l({},this._def),{shape:()=>l(l({},this._def.shape()),t)}))}merge(t){return new r({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>l(l({},this._def.shape()),t._def.shape()),typeName:S.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new r(g(l({},this._def),{catchall:t}))}pick(t){let n={};for(let i of te.objectKeys(t))t[i]&&this.shape[i]&&(n[i]=this.shape[i]);return new r(g(l({},this._def),{shape:()=>n}))}omit(t){let n={};for(let i of te.objectKeys(this.shape))t[i]||(n[i]=this.shape[i]);return new r(g(l({},this._def),{shape:()=>n}))}deepPartial(){return mr(this)}partial(t){let n={};for(let i of te.objectKeys(this.shape)){let s=this.shape[i];t&&!t[i]?n[i]=s:n[i]=s.optional()}return new r(g(l({},this._def),{shape:()=>n}))}required(t){let n={};for(let i of te.objectKeys(this.shape))if(t&&!t[i])n[i]=this.shape[i];else{let a=this.shape[i];for(;a instanceof jt;)a=a._def.innerType;n[i]=a}return new r(g(l({},this._def),{shape:()=>n}))}keyof(){return Au(te.objectKeys(this.shape))}}return r.create=(e,t)=>new r(l({shape:()=>e,unknownKeys:"strip",catchall:Jt.create(),typeName:S.ZodObject},W(t))),r.strictCreate=(e,t)=>new r(l({shape:()=>e,unknownKeys:"strict",catchall:Jt.create(),typeName:S.ZodObject},W(t))),r.lazycreate=(e,t)=>new r(l({shape:e,unknownKeys:"strip",catchall:Jt.create(),typeName:S.ZodObject},W(t))),r})(),Zs=(()=>{class r extends Y{_parse(t){let{ctx:n}=this._processInputParams(t),i=this._def.options;function s(a){for(let u of a)if(u.result.status==="valid")return u.result;for(let u of a)if(u.result.status==="dirty")return n.common.issues.push(...u.ctx.common.issues),u.result;let o=a.map(u=>new mt(u.ctx.common.issues));return O(n,{code:E.invalid_union,unionErrors:o}),D}if(n.common.async)return Promise.all(i.map(a=>p(this,null,function*(){let o=g(l({},n),{common:g(l({},n.common),{issues:[]}),parent:null});return{result:yield a._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}}))).then(s);{let a,o=[];for(let c of i){let d=g(l({},n),{common:g(l({},n.common),{issues:[]}),parent:null}),f=c._parseSync({data:n.data,path:n.path,parent:d});if(f.status==="valid")return f;f.status==="dirty"&&!a&&(a={result:f,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;let u=o.map(c=>new mt(c));return O(n,{code:E.invalid_union,unionErrors:u}),D}}get options(){return this._def.options}}return r.create=(e,t)=>new r(l({options:e,typeName:S.ZodUnion},W(t))),r})(),$t=r=>r instanceof Gs?$t(r.schema):r instanceof yr?$t(r.innerType()):r instanceof Bs?[r.value]:r instanceof Vn?r.options:r instanceof qs?te.objectValues(r.enum):r instanceof Vs?$t(r._def.innerType):r instanceof Ds?[void 0]:r instanceof Us?[null]:r instanceof jt?[void 0,...$t(r.unwrap())]:r instanceof br?[null,...$t(r.unwrap())]:r instanceof Vr||r instanceof Js?$t(r.unwrap()):r instanceof Hs?$t(r._def.innerType):[],Fn=class r extends Y{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.object)return O(t,{code:E.invalid_type,expected:I.object,received:t.parsedType}),D;let n=this.discriminator,i=t.data[n],s=this.optionsMap.get(i);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(O(t,{code:E.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),D)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let i=new Map;for(let s of t){let a=$t(s.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,s)}}return new r(l({typeName:S.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i},W(n)))}};function Cs(r,e){let t=ht(r),n=ht(e);if(r===e)return{valid:!0,data:r};if(t===I.object&&n===I.object){let i=te.objectKeys(e),s=te.objectKeys(r).filter(o=>i.indexOf(o)!==-1),a=l(l({},r),e);for(let o of s){let u=Cs(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===I.array&&n===I.array){if(r.length!==e.length)return{valid:!1};let i=[];for(let s=0;s<r.length;s++){let a=r[s],o=e[s],u=Cs(a,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return t===I.date&&n===I.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Fs=(()=>{class r extends Y{_parse(t){let{status:n,ctx:i}=this._processInputParams(t),s=(a,o)=>{if(Dn(a)||Dn(o))return D;let u=Cs(a.value,o.value);return u.valid?((Un(a)||Un(o))&&n.dirty(),{status:n.value,value:u.data}):(O(i,{code:E.invalid_intersection_types}),D)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([a,o])=>s(a,o)):s(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}return r.create=(e,t,n)=>new r(l({left:e,right:t,typeName:S.ZodIntersection},W(n))),r})(),_r=(()=>{class r extends Y{_parse(t){let{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==I.array)return O(i,{code:E.invalid_type,expected:I.array,received:i.parsedType}),D;if(i.data.length<this._def.items.length)return O(i,{code:E.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),D;!this._def.rest&&i.data.length>this._def.items.length&&(O(i,{code:E.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let a=[...i.data].map((o,u)=>{let c=this._def.items[u]||this._def.rest;return c?c._parse(new Ye(i,o,i.path,u)):null}).filter(o=>!!o);return i.common.async?Promise.all(a).then(o=>Ee.mergeArray(n,o)):Ee.mergeArray(n,a)}get items(){return this._def.items}rest(t){return new r(g(l({},this._def),{rest:t}))}}return r.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new r(l({items:e,typeName:S.ZodTuple,rest:null},W(t)))},r})(),Gn=class r extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.object)return O(n,{code:E.invalid_type,expected:I.object,received:n.parsedType}),D;let i=[],s=this._def.keyType,a=this._def.valueType;for(let o in n.data)i.push({key:s._parse(new Ye(n,o,n.path,o)),value:a._parse(new Ye(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Ee.mergeObjectAsync(t,i):Ee.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof Y?new r(l({keyType:e,valueType:t,typeName:S.ZodRecord},W(n))):new r(l({keyType:qn.create(),valueType:e,typeName:S.ZodRecord},W(t)))}},$u=(()=>{class r extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==I.map)return O(i,{code:E.invalid_type,expected:I.map,received:i.parsedType}),D;let s=this._def.keyType,a=this._def.valueType,o=[...i.data.entries()].map(([u,c],d)=>({key:s._parse(new Ye(i,u,i.path,[d,"key"])),value:a._parse(new Ye(i,c,i.path,[d,"value"]))}));if(i.common.async){let u=new Map;return Promise.resolve().then(()=>p(this,null,function*(){for(let c of o){let d=yield c.key,f=yield c.value;if(d.status==="aborted"||f.status==="aborted")return D;(d.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(d.value,f.value)}return{status:n.value,value:u}}))}else{let u=new Map;for(let c of o){let d=c.key,f=c.value;if(d.status==="aborted"||f.status==="aborted")return D;(d.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(d.value,f.value)}return{status:n.value,value:u}}}}return r.create=(e,t,n)=>new r(l({valueType:t,keyType:e,typeName:S.ZodMap},W(n))),r})(),Iu=(()=>{class r extends Y{_parse(t){let{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==I.set)return O(i,{code:E.invalid_type,expected:I.set,received:i.parsedType}),D;let s=this._def;s.minSize!==null&&i.data.size<s.minSize.value&&(O(i,{code:E.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&i.data.size>s.maxSize.value&&(O(i,{code:E.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());let a=this._def.valueType;function o(c){let d=new Set;for(let f of c){if(f.status==="aborted")return D;f.status==="dirty"&&n.dirty(),d.add(f.value)}return{status:n.value,value:d}}let u=[...i.data.values()].map((c,d)=>a._parse(new Ye(i,c,i.path,d)));return i.common.async?Promise.all(u).then(c=>o(c)):o(u)}min(t,n){return new r(g(l({},this._def),{minSize:{value:t,message:C.toString(n)}}))}max(t,n){return new r(g(l({},this._def),{maxSize:{value:t,message:C.toString(n)}}))}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}return r.create=(e,t)=>new r(l({valueType:e,minSize:null,maxSize:null,typeName:S.ZodSet},W(t))),r})(),Bn=class r extends Y{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.function)return O(t,{code:E.invalid_type,expected:I.function,received:t.parsedType}),D;function n(o,u){return Gr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,pr(),Ot].filter(c=>!!c),issueData:{code:E.invalid_arguments,argumentsError:u}})}function i(o,u){return Gr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,pr(),Ot].filter(c=>!!c),issueData:{code:E.invalid_return_type,returnTypeError:u}})}let s={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Hn){let o=this;return $e(function(...u){return p(this,null,function*(){let c=new mt([]),d=yield o._def.args.parseAsync(u,s).catch(h=>{throw c.addIssue(n(u,h)),c}),f=yield Reflect.apply(a,this,d);return yield o._def.returns._def.type.parseAsync(f,s).catch(h=>{throw c.addIssue(i(f,h)),c})})})}else{let o=this;return $e(function(...u){let c=o._def.args.safeParse(u,s);if(!c.success)throw new mt([n(u,c.error)]);let d=Reflect.apply(a,this,c.data),f=o._def.returns.safeParse(d,s);if(!f.success)throw new mt([i(d,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r(g(l({},this._def),{args:_r.create(e).rest(Br.create())}))}returns(e){return new r(g(l({},this._def),{returns:e}))}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r(l({args:e||_r.create([]).rest(Br.create()),returns:t||Br.create(),typeName:S.ZodFunction},W(n)))}},Gs=(()=>{class r extends Y{get schema(){return this._def.getter()}_parse(t){let{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}return r.create=(e,t)=>new r(l({getter:e,typeName:S.ZodLazy},W(t))),r})(),Bs=(()=>{class r extends Y{_parse(t){if(t.data!==this._def.value){let n=this._getOrReturnCtx(t);return O(n,{received:n.data,code:E.invalid_literal,expected:this._def.value}),D}return{status:"valid",value:t.data}}get value(){return this._def.value}}return r.create=(e,t)=>new r(l({value:e,typeName:S.ZodLiteral},W(t))),r})();function Au(r,e){return new Vn(l({values:r,typeName:S.ZodEnum},W(e)))}var Vn=(()=>{class r extends Y{_parse(t){if(typeof t.data!="string"){let n=this._getOrReturnCtx(t),i=this._def.values;return O(n,{expected:te.joinValues(i),received:n.parsedType,code:E.invalid_type}),D}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){let n=this._getOrReturnCtx(t),i=this._def.values;return O(n,{received:n.data,code:E.invalid_enum_value,options:i}),D}return $e(t.data)}get options(){return this._def.values}get enum(){let t={};for(let n of this._def.values)t[n]=n;return t}get Values(){let t={};for(let n of this._def.values)t[n]=n;return t}get Enum(){let t={};for(let n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return r.create(t,l(l({},this._def),n))}exclude(t,n=this._def){return r.create(this.options.filter(i=>!t.includes(i)),l(l({},this._def),n))}}return r.create=Au,r})(),qs=(()=>{class r extends Y{_parse(t){let n=te.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(t);if(i.parsedType!==I.string&&i.parsedType!==I.number){let s=te.objectValues(n);return O(i,{expected:te.joinValues(s),received:i.parsedType,code:E.invalid_type}),D}if(this._cache||(this._cache=new Set(te.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let s=te.objectValues(n);return O(i,{received:i.data,code:E.invalid_enum_value,options:s}),D}return $e(t.data)}get enum(){return this._def.values}}return r.create=(e,t)=>new r(l({values:e,typeName:S.ZodNativeEnum},W(t))),r})(),Hn=(()=>{class r extends Y{unwrap(){return this._def.type}_parse(t){let{ctx:n}=this._processInputParams(t);if(n.parsedType!==I.promise&&n.common.async===!1)return O(n,{code:E.invalid_type,expected:I.promise,received:n.parsedType}),D;let i=n.parsedType===I.promise?n.data:Promise.resolve(n.data);return $e(i.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}return r.create=(e,t)=>new r(l({type:e,typeName:S.ZodPromise},W(t))),r})(),yr=(()=>{class r extends Y{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===S.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:n,ctx:i}=this._processInputParams(t),s=this._def.effect||null,a={addIssue:o=>{O(i,o),o.fatal?n.abort():n.dirty()},get path(){return i.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){let o=s.transform(i.data,a);if(i.common.async)return Promise.resolve(o).then(u=>p(this,null,function*(){if(n.value==="aborted")return D;let c=yield this._def.schema._parseAsync({data:u,path:i.path,parent:i});return c.status==="aborted"?D:c.status==="dirty"?Ht(c.value):n.value==="dirty"?Ht(c.value):c}));{if(n.value==="aborted")return D;let u=this._def.schema._parseSync({data:o,path:i.path,parent:i});return u.status==="aborted"?D:u.status==="dirty"?Ht(u.value):n.value==="dirty"?Ht(u.value):u}}if(s.type==="refinement"){let o=u=>{let c=s.refinement(u,a);if(i.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(i.common.async===!1){let u=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return u.status==="aborted"?D:(u.status==="dirty"&&n.dirty(),o(u.value),{status:n.value,value:u.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(u=>u.status==="aborted"?D:(u.status==="dirty"&&n.dirty(),o(u.value).then(()=>({status:n.value,value:u.value}))))}if(s.type==="transform")if(i.common.async===!1){let o=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Ct(o))return D;let u=s.transform(o.value,a);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:u}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(o=>Ct(o)?Promise.resolve(s.transform(o.value,a)).then(u=>({status:n.value,value:u})):D);te.assertNever(s)}}return r.create=(e,t,n)=>new r(l({schema:e,typeName:S.ZodEffects,effect:t},W(n))),r.createWithPreprocess=(e,t,n)=>new r(l({schema:t,effect:{type:"preprocess",transform:e},typeName:S.ZodEffects},W(n))),r})();var jt=(()=>{class r extends Y{_parse(t){return this._getType(t)===I.undefined?$e(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodOptional},W(t))),r})(),br=(()=>{class r extends Y{_parse(t){return this._getType(t)===I.null?$e(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodNullable},W(t))),r})(),Vs=(()=>{class r extends Y{_parse(t){let{ctx:n}=this._processInputParams(t),i=n.data;return n.parsedType===I.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default},W(t))),r})(),Hs=(()=>{class r extends Y{_parse(t){let{ctx:n}=this._processInputParams(t),i=g(l({},n),{common:g(l({},n.common),{issues:[]})}),s=this._def.innerType._parse({data:i.data,path:i.path,parent:l({},i)});return hr(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new mt(i.common.issues)},input:i.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new mt(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch},W(t))),r})(),Pu=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.nan){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.nan,received:i.parsedType}),D}return{status:"valid",value:t.data}}}return r.create=e=>new r(l({typeName:S.ZodNaN},W(e))),r})(),kh=Symbol("zod_brand"),Vr=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},Hr=class r extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return p(this,null,function*(){let s=yield this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?D:s.status==="dirty"?(t.dirty(),Ht(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})});{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?D:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:S.ZodPipeline})}},Js=(()=>{class r extends Y{_parse(t){let n=this._def.innerType._parse(t),i=s=>(Ct(s)&&(s.value=Object.freeze(s.value)),s);return hr(n)?n.then(s=>i(s)):i(n)}unwrap(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodReadonly},W(t))),r})();function vu(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function ku(r,e={},t){return r?Zn.create().superRefine((n,i)=>{let s=r(n);if(s instanceof Promise)return s.then(a=>{if(!a){let o=vu(e,n),u=o.fatal??t??!0;i.addIssue(g(l({code:"custom"},o),{fatal:u}))}});if(!s){let a=vu(e,n),o=a.fatal??t??!0;i.addIssue(g(l({code:"custom"},a),{fatal:o}))}}):Zn.create()}var Rh={object:gr.lazycreate},S=function(r){return r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly",r}(S||{});var Nh=(r,e={message:`Input not instance of ${r.name}`})=>ku(t=>t instanceof r,e),Ru=qn.create,Nu=js.create,Ch=Pu.create,jh=Ls.create,Cu=zs.create,Lh=Ms.create,zh=Tu.create,Mh=Ds.create,Dh=Us.create,Uh=Zn.create,Zh=Br.create,Fh=Jt.create,Gh=Ou.create,Bh=qr.create,qh=gr.create,Vh=gr.strictCreate,Hh=Zs.create,Jh=Fn.create,Wh=Fs.create,Kh=_r.create,Yh=Gn.create,Xh=$u.create,Qh=Iu.create,em=Bn.create,tm=Gs.create,rm=Bs.create,nm=Vn.create,im=qs.create,sm=Hn.create,am=yr.create,om=jt.create,um=br.create,cm=yr.createWithPreprocess,lm=Hr.create,dm=()=>Ru().optional(),fm=()=>Nu().optional(),pm=()=>Cu().optional(),hm={string:r=>qn.create(g(l({},r),{coerce:!0})),number:r=>js.create(g(l({},r),{coerce:!0})),boolean:r=>zs.create(g(l({},r),{coerce:!0})),bigint:r=>Ls.create(g(l({},r),{coerce:!0})),date:r=>Ms.create(g(l({},r),{coerce:!0}))};var mm=D;var Co=pt(Kn(),1);var Fu=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function vm(r){return typeof r=="string"&&Fu.test(r)}var zt=vm;function xm(r){if(!zt(r))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Yn=xm;var Se=[];for(Xn=0;Xn<256;++Xn)Se.push((Xn+256).toString(16).slice(1));var Xn;function gt(r,e=0){return(Se[r[e+0]]+Se[r[e+1]]+Se[r[e+2]]+Se[r[e+3]]+"-"+Se[r[e+4]]+Se[r[e+5]]+"-"+Se[r[e+6]]+Se[r[e+7]]+"-"+Se[r[e+8]]+Se[r[e+9]]+"-"+Se[r[e+10]]+Se[r[e+11]]+Se[r[e+12]]+Se[r[e+13]]+Se[r[e+14]]+Se[r[e+15]]).toLowerCase()}var Qn,Em=new Uint8Array(16);function Jr(){if(!Qn&&(Qn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Qn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qn(Em)}var Ws,ei,Ks=0,Ys=0;function Sm(r,e,t){var n=e&&t||0,i=e||new Array(16);r=r||{};var s=r.node,a=r.clockseq;if(r._v6||(s||(s=Ws),a==null&&(a=ei)),s==null||a==null){var o=r.random||(r.rng||Jr)();s==null&&(s=[o[0],o[1],o[2],o[3],o[4],o[5]],!Ws&&!r._v6&&(s[0]|=1,Ws=s)),a==null&&(a=(o[6]<<8|o[7])&16383,ei===void 0&&!r._v6&&(ei=a))}var u=r.msecs!==void 0?r.msecs:Date.now(),c=r.nsecs!==void 0?r.nsecs:Ys+1,d=u-Ks+(c-Ys)/1e4;if(d<0&&r.clockseq===void 0&&(a=a+1&16383),(d<0||u>Ks)&&r.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Ks=u,Ys=c,ei=a,u+=122192928e5;var f=((u&268435455)*1e4+c)%4294967296;i[n++]=f>>>24&255,i[n++]=f>>>16&255,i[n++]=f>>>8&255,i[n++]=f&255;var m=u/4294967296*1e4&268435455;i[n++]=m>>>8&255,i[n++]=m&255,i[n++]=m>>>24&15|16,i[n++]=m>>>16&255,i[n++]=a>>>8|128,i[n++]=a&255;for(var h=0;h<6;++h)i[n+h]=s[h];return e||gt(i)}var Gu=Sm;function Xs(r){var e=typeof r=="string"?Yn(r):r,t=Tm(e);return typeof r=="string"?gt(t):t}function Tm(r,e=!1){return Uint8Array.of((r[6]&15)<<4|r[7]>>4&15,(r[7]&15)<<4|(r[4]&240)>>4,(r[4]&15)<<4|(r[5]&240)>>4,(r[5]&15)<<4|(r[0]&240)>>4,(r[0]&15)<<4|(r[1]&240)>>4,(r[1]&15)<<4|(r[2]&240)>>4,96|r[2]&15,r[3],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function Om(r){r=unescape(encodeURIComponent(r));for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var $m="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Im="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Qs(r,e,t){function n(i,s,a,o){var u;if(typeof i=="string"&&(i=Om(i)),typeof s=="string"&&(s=Yn(s)),((u=s)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,a){o=o||0;for(var d=0;d<16;++d)a[o+d]=c[d];return a}return gt(c)}try{n.name=r}catch{}return n.DNS=$m,n.URL=Im,n}var Am=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ea={randomUUID:Am};function Pm(r,e,t){if(ea.randomUUID&&!e&&!r)return ea.randomUUID();r=r||{};var n=r.random||(r.rng||Jr)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return gt(n)}var ce=Pm;function km(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function ta(r,e){return r<<e|r>>>32-e}function Rm(r){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var i=0;i<n.length;++i)r.push(n.charCodeAt(i))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var s=r.length/4+2,a=Math.ceil(s/16),o=new Array(a),u=0;u<a;++u){for(var c=new Uint32Array(16),d=0;d<16;++d)c[d]=r[u*64+d*4]<<24|r[u*64+d*4+1]<<16|r[u*64+d*4+2]<<8|r[u*64+d*4+3];o[u]=c}o[a-1][14]=(r.length-1)*8/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=(r.length-1)*8&4294967295;for(var f=0;f<a;++f){for(var m=new Uint32Array(80),h=0;h<16;++h)m[h]=o[f][h];for(var _=16;_<80;++_)m[_]=ta(m[_-3]^m[_-8]^m[_-14]^m[_-16],1);for(var b=t[0],y=t[1],v=t[2],w=t[3],T=t[4],N=0;N<80;++N){var L=Math.floor(N/20),Z=ta(b,5)+km(L,y,v,w)+T+e[L]+m[N]>>>0;T=w,w=v,v=ta(y,30)>>>0,y=b,b=Z}t[0]=t[0]+b>>>0,t[1]=t[1]+y>>>0,t[2]=t[2]+v>>>0,t[3]=t[3]+w>>>0,t[4]=t[4]+T>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var Bu=Rm;var Nm=Qs("v5",80,Bu),ti=Nm;function qu(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Vu(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?qu(Object(t),!0).forEach(function(n){Cm(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):qu(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Cm(r,e,t){return(e=jm(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function jm(r){var e=Lm(r,"string");return typeof e=="symbol"?e:e+""}function Lm(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Hu(r={},e,t=0){var n=Gu(Vu(Vu({},r),{},{_v6:!0}),new Uint8Array(16));if(n=Xs(n),e){for(var i=0;i<16;i++)e[t+i]=n[i];return e}return gt(n)}var ia=class{getStore(){}run(e,t){return t()}},na=Symbol.for("ls:tracing_async_local_storage"),zm=new ia,sa=class{getInstance(){return globalThis[na]??zm}initializeGlobalInstance(e){globalThis[na]===void 0&&(globalThis[na]=e)}},Mm=new sa;function Ju(r=!1){let e=Mm.getInstance().getStore();if(!r&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}var E0=Symbol.for("langsmith:traceable:root");function ri(r){return typeof r=="function"&&"langsmith:traceable"in r}var Jb={};ve(Jb,{LogStreamCallbackHandler:()=>$r,RunLog:()=>Or,RunLogPatch:()=>it,isLogStreamHandler:()=>lo});var aa={};ve(aa,{JsonPatchError:()=>le,_areEquals:()=>Kr,applyOperation:()=>Yt,applyPatch:()=>Xt,applyReducer:()=>Fm,deepClone:()=>Um,getValueByPointer:()=>oi,validate:()=>Ku,validator:()=>ui});var Dm=Object.prototype.hasOwnProperty;function ii(r,e){return Dm.call(r,e)}function si(r){if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)ii(r,t)&&e.push(t);return e}function Ie(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function ai(r){let e=0,t=r.length,n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function _t(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function Wr(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function ni(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(ni(r[t]))return!0}else if(typeof r=="object"){let t=si(r),n=t.length;for(var e=0;e<n;e++)if(ni(r[t[e]]))return!0}}return!1}function Wu(r,e){let t=[r];for(let n in e){let i=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof i<"u"&&t.push(`${n}: ${i}`)}return t.join(`
`)}var Kt=class extends Error{constructor(e,t,n,i,s){super(Wu(e,{name:t,index:n,operation:i,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=Wu(e,{name:t,index:n,operation:i,tree:s})}};var le=Kt,Um=Ie,wr={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=oi(t,this.path);n&&(n=Ie(n));let i=Yt(t,{op:"remove",path:this.from}).removed;return Yt(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:n}},copy:function(r,e,t){let n=oi(t,this.from);return Yt(t,{op:"add",path:this.path,value:Ie(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:Kr(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}},Zm={add:function(r,e,t){return ai(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:wr.move,copy:wr.copy,test:wr.test,_get:wr._get};function oi(r,e){if(e=="")return r;var t={op:"_get",path:e};return Yt(r,t),t.value}function Yt(r,e,t=!1,n=!0,i=!0,s=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):ui(e,0)),e.path===""){let a={newDocument:r};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=r,a;if(e.op==="move"||e.op==="copy")return a.newDocument=oi(r,e.from),e.op==="move"&&(a.removed=r),a;if(e.op==="test"){if(a.test=Kr(r,e.value),a.test===!1)throw new le("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return a.newDocument=r,a}else{if(e.op==="remove")return a.removed=r,a.newDocument=null,a;if(e.op==="_get")return e.value=r,a;if(t)throw new le("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,r);return a}}else{n||(r=Ie(r));let o=(e.path||"").split("/"),u=r,c=1,d=o.length,f,m,h;for(typeof t=="function"?h=t:h=ui;;){if(m=o[c],m&&m.indexOf("~")!=-1&&(m=Wr(m)),i&&(m=="__proto__"||m=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&f===void 0&&(u[m]===void 0?f=o.slice(0,c).join("/"):c==d-1&&(f=e.path),f!==void 0&&h(e,0,r,f)),c++,Array.isArray(u)){if(m==="-")m=u.length;else{if(t&&!ai(m))throw new le("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,r);ai(m)&&(m=~~m)}if(c>=d){if(t&&e.op==="add"&&m>u.length)throw new le("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,r);let _=Zm[e.op].call(e,u,m,r);if(_.test===!1)throw new le("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return _}}else if(c>=d){let _=wr[e.op].call(e,u,m,r);if(_.test===!1)throw new le("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return _}if(u=u[m],t&&c<d&&(!u||typeof u!="object"))throw new le("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,r)}}}function Xt(r,e,t,n=!0,i=!0){if(t&&!Array.isArray(e))throw new le("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=Ie(r));let s=new Array(e.length);for(let a=0,o=e.length;a<o;a++)s[a]=Yt(r,e[a],t,!0,i,a),r=s[a].newDocument;return s.newDocument=r,s}function Fm(r,e,t){let n=Yt(r,e);if(n.test===!1)throw new le("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function ui(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new le("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(wr[r.op]){if(typeof r.path!="string")throw new le("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new le('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new le("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new le("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&ni(r.value))throw new le("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var i=r.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new le("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new le("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var a={op:"_get",path:r.from,value:void 0},o=Ku([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new le("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new le("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function Ku(r,e,t){try{if(!Array.isArray(r))throw new le("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Xt(Ie(e),Ie(r),t||!0);else{t=t||ui;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(i){if(i instanceof le)return i;throw i}}function Kr(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),i,s,a;if(t&&n){if(s=r.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!Kr(r[i],e[i]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(s=o.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=s;i--!==0;)if(a=o[i],!Kr(r[a],e[a]))return!1;return!0}return r!==r&&e!==e}function Yu(r,e,t,n,i){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=si(e),a=si(r),o=!1,u=!1,c=a.length-1;c>=0;c--){var d=a[c],f=r[d];if(ii(e,d)&&!(e[d]===void 0&&f!==void 0&&Array.isArray(e)===!1)){var m=e[d];typeof f=="object"&&f!=null&&typeof m=="object"&&m!=null&&Array.isArray(f)===Array.isArray(m)?Yu(f,m,t,n+"/"+_t(d),i):f!==m&&(o=!0,i&&t.push({op:"test",path:n+"/"+_t(d),value:Ie(f)}),t.push({op:"replace",path:n+"/"+_t(d),value:Ie(m)}))}else Array.isArray(r)===Array.isArray(e)?(i&&t.push({op:"test",path:n+"/"+_t(d),value:Ie(f)}),t.push({op:"remove",path:n+"/"+_t(d)}),u=!0):(i&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}),o=!0)}if(!(!u&&s.length==a.length))for(var c=0;c<s.length;c++){var d=s[c];!ii(r,d)&&e[d]!==void 0&&t.push({op:"add",path:n+"/"+_t(d),value:Ie(e[d])})}}}function k0(r,e,t=!1){var n=[];return Yu(r,e,n,"",t),n}var C0=g(l({},aa),{JsonPatchError:Kt,deepClone:Ie,escapePathComponent:_t,unescapePathComponent:Wr});var Rb={};ve(Rb,{BaseTracer:()=>Ve,isBaseTracer:()=>tr});var Xu="gen_ai.operation.name",Qu="gen_ai.system",oa="gen_ai.request.model",ec="gen_ai.response.model",ua="gen_ai.usage.input_tokens",ca="gen_ai.usage.output_tokens",la="gen_ai.usage.total_tokens",tc="gen_ai.request.max_tokens",rc="gen_ai.request.temperature",nc="gen_ai.request.top_p",ic="gen_ai.request.frequency_penalty",sc="gen_ai.request.presence_penalty",ac="gen_ai.response.finish_reasons",oc="gen_ai.prompt",uc="gen_ai.completion",cc="gen_ai.request.extra_query",lc="gen_ai.request.extra_body",dc="gen_ai.serialized.name",fc="gen_ai.serialized.signature",pc="gen_ai.serialized.doc",hc="gen_ai.response.id",mc="gen_ai.response.service_tier",gc="gen_ai.response.system_fingerprint",_c="gen_ai.usage.input_token_details",yc="gen_ai.usage.output_token_details",bc="langsmith.trace.session_id",wc="langsmith.trace.session_name",vc="langsmith.span.kind",xc="langsmith.trace.name",Ec="langsmith.metadata",da="langsmith.span.tags";var Sc="langsmith.request.streaming",Tc="langsmith.request.headers";var Bm=(...r)=>fetch(...r),Oc=Symbol.for("ls:fetch_implementation");var $c=()=>{let r=globalThis[Oc];return r?typeof r=="function"&&"Headers"in r&&"Request"in r&&"Response"in r:!1},j=r=>(...e)=>p(null,null,function*(){if(r||ge("DEBUG")==="true"){let[n,i]=e;console.log(`\u2192 ${i?.method||"GET"} ${n}`)}let t=yield(globalThis[Oc]??Bm)(...e);return(r||ge("DEBUG")==="true")&&console.log(`\u2190 ${t.status} ${t.statusText} ${t.url}`),t});var Yr=()=>ge("PROJECT")??Re("LANGCHAIN_SESSION")??"default";var ci="0.3.46";var It,qm=()=>typeof window<"u"&&typeof window.document<"u",Vm=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Hm=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Ic=()=>typeof Deno<"u",Jm=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Ic(),Wm=()=>It||(qm()?It="browser":Jm()?It="node":Vm()?It="webworker":Hm()?It="jsdom":Ic()?It="deno":It="other",It),fa;function li(){if(fa===void 0){let r=Wm(),e=Ym();fa=l({library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:ci},e)}return fa}function Ac(){let r=Km()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[n,i]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof i=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[n]=i);return e}function Km(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function Re(r){try{return typeof process<"u"?process.env?.[r]:void 0}catch{return}}function ge(r){return Re(`LANGSMITH_${r}`)||Re(`LANGCHAIN_${r}`)}var pa;function Ym(){if(pa!==void 0)return pa;let r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of r){let n=Re(t);n!==void 0&&(e[t]=n)}return pa=e,e}var ga=class{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&Re("OTEL_ENABLED")==="true"&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(t.length===1&&typeof t[0]=="function"?n=t[0]:t.length===2&&typeof t[1]=="function"?n=t[1]:t.length===3&&typeof t[2]=="function"&&(n=t[2]),typeof n=="function")return n()}},_a=class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new ga})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},ya=class{active(){return{}}with(e,t){return t()}},ha=Symbol.for("ls:otel_trace"),ma=Symbol.for("ls:otel_context"),Pc=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),Xm=new _a,Qm=new ya,ba=class{getTraceInstance(){return globalThis[ha]??Xm}getContextInstance(){return globalThis[ma]??Qm}initializeGlobalInstances(e){globalThis[ha]===void 0&&(globalThis[ha]=e.trace),globalThis[ma]===void 0&&(globalThis[ma]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[Pc]=e}getDefaultOTLPTracerComponents(){return globalThis[Pc]??void 0}},wa=new ba;function di(){return wa.getTraceInstance()}function kc(){return wa.getContextInstance()}function Rc(){return wa.getDefaultOTLPTracerComponents()}var eg={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function tg(r){return eg[r]||r}var fi=class{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let n of e)try{if(!n.run)continue;if(n.operation==="post"){let i=this.createSpanForRun(n,n.run,t.get(n.id));i&&!n.run.end_time&&this.spans.set(n.id,i)}else this.updateSpanForRun(n,n.run)}catch(i){console.error(`Error processing operation ${n.id}:`,i)}}createSpanForRun(e,t,n){let i=n&&di().getSpan(n);if(i)try{return this.finishSpanSetup(i,t,e)}catch(s){console.error(`Failed to create span for run ${e.id}:`,s);return}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});let i=t.end_time;i&&(n.end(new Date(i)),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let n=t.invocation_params;if(n.model)return n.model;if(n.model_name)return n.model_name}}}setSpanAttributes(e,t,n){if("run_type"in t&&t.run_type){e.setAttribute(vc,t.run_type);let o=tg(t.run_type||"chain");e.setAttribute(Xu,o)}"name"in t&&t.name&&e.setAttribute(xc,t.name),"session_id"in t&&t.session_id&&e.setAttribute(bc,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(wc,t.session_name),this.setGenAiSystem(e,t);let i=this.extractModelName(t);i&&e.setAttribute(oa,i),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(ua,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(ca,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(la,t.total_tokens),this.setInvocationParameters(e,t);let s=t.extra?.metadata||{};for(let[o,u]of Object.entries(s))u!=null&&e.setAttribute(`${Ec}.${o}`,String(u));let a=t.tags;if(a&&Array.isArray(a)?e.setAttribute(da,a.join(", ")):a&&e.setAttribute(da,String(a)),"serialized"in t&&typeof t.serialized=="object"){let o=t.serialized;o.name&&e.setAttribute(dc,String(o.name)),o.signature&&e.setAttribute(fc,String(o.signature)),o.doc&&e.setAttribute(pc,String(o.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain",i=this.extractModelName(t);if(i){let s=i.toLowerCase();s.includes("anthropic")||s.startsWith("claude")?n="anthropic":s.includes("bedrock")?n="aws.bedrock":s.includes("azure")&&s.includes("openai")?n="az.ai.openai":s.includes("azure")&&s.includes("inference")?n="az.ai.inference":s.includes("cohere")?n="cohere":s.includes("deepseek")?n="deepseek":s.includes("gemini")?n="gemini":s.includes("groq")?n="groq":s.includes("watson")||s.includes("ibm")?n="ibm.watsonx.ai":s.includes("mistral")?n="mistral_ai":s.includes("gpt")||s.includes("openai")?n="openai":s.includes("perplexity")||s.includes("sonar")?n="perplexity":s.includes("vertex")?n="vertex_ai":(s.includes("xai")||s.includes("grok"))&&(n="xai")}e.setAttribute(Qu,n)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let n=t.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(tc,n.max_tokens),n.temperature!==void 0&&e.setAttribute(rc,n.temperature),n.top_p!==void 0&&e.setAttribute(nc,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(ic,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(sc,n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let n=t.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(oa,n.model),n.stream!==void 0&&e.setAttribute(Sc,n.stream),n.extra_headers&&e.setAttribute(Tc,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(cc,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(lc,JSON.stringify(n.extra_body))),e.setAttribute(oc,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${t.id}`,n)}if(t.run.outputs)try{let n=t.run.outputs,i=this.getUnifiedRunTokens(n);if(i&&(e.setAttribute(ua,i[0]),e.setAttribute(ca,i[1]),e.setAttribute(la,i[0]+i[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(ec,String(n.model)),n.id&&e.setAttribute(hc,n.id),n.choices&&Array.isArray(n.choices)){let s=n.choices.map(a=>a.finish_reason).filter(a=>a).map(String);s.length>0&&e.setAttribute(ac,s.join(", "))}if(n.service_tier&&e.setAttribute(mc,n.service_tier),n.system_fingerprint&&e.setAttribute(gc,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){let s=n.usage_metadata;s.input_token_details&&e.setAttribute(_c,JSON.stringify(s.input_token_details)),s.output_token_details&&e.setAttribute(yc,JSON.stringify(s.output_token_details))}}e.setAttribute(uc,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${t.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;let n=Object.keys(e);for(let a of n){let o=e[a];if(!(!o||typeof o!="object")&&(t=this.extractUnifiedRunTokens(o.usage_metadata),t||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(t=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),t)))return t}let i=e.generations||[];if(!Array.isArray(i))return null;let s=Array.isArray(i[0])?i.flat():i;for(let a of s)if(typeof a=="object"&&a.message&&typeof a.message=="object"&&a.message.kwargs&&typeof a.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(a.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}};var Fc=pt(Kn(),1),yi=pt(_i(),1);var lg=[400,401,403,404,405,406,407,408],dg=[409],Qr=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,"default"in yi.default?this.queue=new yi.default.default({concurrency:this.maxConcurrency}):this.queue=new yi.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let n=this.onFailedResponseHook;return this.queue.add(()=>(0,Fc.default)(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{onFailedAttempt(s){return p(this,null,function*(){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||s?.code==="ECONNABORTED")throw s;let a=s?.response,o=a?.status;if(o){if(lg.includes(+o))throw s;if(dg.includes(+o))return;n&&(yield n(a))}})},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((i,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>j(this.debug)(...e).then(t=>t.ok?t:Promise.reject(t)))}};function $a(r){return typeof r?._getType=="function"}function Ia(r){let e={type:r._getType(),data:{content:r.content}};return r?.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs=l({},r.additional_kwargs)),e}var fg=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function H(r,e){if(!fg.test(r)){let t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}var Gc={};function bi(r){Gc[r]||(console.warn(r),Gc[r]=!0)}var ub=pt(Cd(),1);function At(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);let[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){let[i,s]=e.split("/",2);if(!i||!s)throw new Error(`Invalid identifier format: ${r}`);return[i,s,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}var Ha=class extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}};function K(r,e,t){return p(this,null,function*(){let n;if(r.ok){t&&(n=yield r.text());return}n=yield r.text();let i=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;if(r.status===409)throw new Ha(i);let s=new Error(i);throw s.status=r.status,s})}var jd="ERR_CONFLICTING_ENDPOINTS",ki=class extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:jd}),this.name="ConflictingEndpointsError"}};function Ld(r){return typeof r=="object"&&r!==null&&r.code===jd}var zd="[...]",cb={result:"[Circular]"},Ni=[],Er=[],lb=new TextEncoder;function db(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Ri(r){return lb.encode(r)}function Md(r){if(r&&typeof r=="object"&&r!==null){if(r instanceof Map)return Object.fromEntries(r);if(r instanceof Set)return Array.from(r);if(r instanceof Date)return r.toISOString();if(r instanceof RegExp)return r.toString();if(r instanceof Error)return{name:r.name,message:r.message}}else if(typeof r=="bigint")return r.toString();return r}function fb(r){return function(e,t){if(r){let n=r.call(this,e,t);if(n!==void 0)return n}return Md(t)}}function Ge(r,e,t,n,i){try{let s=JSON.stringify(r,fb(t),n);return Ri(s)}catch(s){if(!s.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Ri("[Unserializable]");ge("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof i>"u"&&(i=db()),Wa(r,"",0,[],void 0,0,i);let a;try{Er.length===0?a=JSON.stringify(r,t,n):a=JSON.stringify(r,pb(t),n)}catch{return Ri("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Ni.length!==0;){let o=Ni.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return Ri(a)}}function Ja(r,e,t,n){var i=Object.getOwnPropertyDescriptor(n,t);i.get!==void 0?i.configurable?(Object.defineProperty(n,t,{value:r}),Ni.push([n,t,e,i])):Er.push([e,t,r]):(n[t]=r,Ni.push([n,t,e]))}function Wa(r,e,t,n,i,s,a){s+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){Ja(cb,r,e,i);return}if(typeof a.depthLimit<"u"&&s>a.depthLimit){Ja(zd,r,e,i);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){Ja(zd,r,e,i);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Wa(r[o],o,o,n,r,s,a);else{r=Md(r);var u=Object.keys(r);for(o=0;o<u.length;o++){var c=u[o];Wa(r[c],c,o,n,r,s,a)}}n.pop()}}function pb(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Er.length>0)for(var n=0;n<Er.length;n++){var i=Er[n];if(i[1]===e&&i[0]===t){t=i[2],Er.splice(n,1);break}}return r.call(this,e,t)}}function Dd(r){let e=li(),t=Ac(),n=r.extra??{},i=n.metadata;return r.extra=g(l({},n),{runtime:l(l({},e),n?.runtime),metadata:l(l(l({},t),t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{}),i)}),r}var hb=r=>{let e=r?.toString()??ge("TRACING_SAMPLING_RATE");if(e===void 0)return;let t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},mb=r=>{let t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};function gb(r){return p(this,null,function*(){let e=[];try{for(var t=X(r),n,i,s;n=!(i=yield t.next()).done;n=!1){let a=i.value;e.push(a)}}catch{s=[i]}finally{try{n&&(i=t.return)&&(yield i.call(t))}finally{if(s)throw s[0]}}return e})}function Ka(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var _b=r=>p(null,null,function*(){if(r?.status===429){let e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return yield new Promise(t=>setTimeout(t,e)),!0}return!1});function Ud(r){return typeof r=="number"?Number(r.toFixed(4)):r}var Ya=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,n=new Promise(s=>{t=s}),i=Ge(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:n,size:i}),this.sizeBytes+=i,n}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let t=[],n=0;for(;n+(this.peek()?.size??0)<e&&this.items.length>0;){let i=this.items.shift();i&&(t.push(i),n+=i.size,this.sizeBytes-=i.size)}if(t.length===0&&this.items.length>0){let i=this.items.shift();t.push(i),n+=i.size,this.sizeBytes-=i.size}return[t.map(i=>({action:i.action,item:i.payload,otelContext:i.otelContext,apiKey:i.apiKey,apiUrl:i.apiUrl})),()=>t.forEach(i=>i.itemPromiseResolve())]}},yb=20971520,bb=2500,Zd="https://api.smith.langchain.com",Qt=class r{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Ya}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Re("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:Re("LANGSMITH_DEBUG")==="true"});let t=r.getDefaultClientConfig();if(this.tracingSampleRate=hb(e.tracingSamplingRate),this.apiUrl=Ka(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Ka(e.apiKey??t.apiKey),this.webUrl=Ka(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Qr(g(l({},e.callerOptions??{}),{debug:e.debug??this.debug})),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new Qr(g(l({maxRetries:2,maxConcurrency:this.traceBatchConcurrency},e.callerOptions??{}),{onFailedResponseHook:_b,debug:e.debug??this.debug})),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,Re("OTEL_ENABLED")==="true"&&(this.langSmithToOTELTranslator=new fi)}static getDefaultClientConfig(){let e=ge("API_KEY"),t=ge("ENDPOINT")??Zd,n=ge("HIDE_INPUTS")==="true",i=ge("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:mb(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${ci}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}processInputs(e){return p(this,null,function*(){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e})}processOutputs(e){return p(this,null,function*(){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e})}prepareRunCreateOrUpdateInputs(e){return p(this,null,function*(){let t=l({},e);return t.inputs!==void 0&&(t.inputs=yield this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=yield this.processOutputs(t.outputs)),t})}_getResponse(e,t){return p(this,null,function*(){let n=t?.toString()??"",i=`${this.apiUrl}${e}?${n}`,s=yield this.caller.call(j(this.debug),i,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(s,`Failed to fetch ${e}`),s})}_get(e,t){return p(this,null,function*(){return(yield this._getResponse(e,t)).json()})}_getPaginated(i){return V(this,arguments,function*(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));let o=`${this.apiUrl}${e}?${t}`,u=yield new x(this.caller.call(j(this.debug),o,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)));yield new x(K(u,`Failed to fetch ${e}`));let c=n?n(yield new x(u.json())):yield new x(u.json());if(c.length===0||(yield c,c.length<a))break;s+=c.length}})}_getCursorPaginatedList(e,t=null,n="POST",i="runs"){return V(this,null,function*(){let s=t?l({},t):{};for(;;){let a=yield new x(this.caller.call(j(this.debug),`${this.apiUrl}${e}`,g(l({method:n,headers:g(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:JSON.stringify(s)}))),o=yield new x(a.json());if(!o||!o[i])break;yield o[i];let u=o.cursors;if(!u||!u.next)break;s.cursor=u.next}})}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let n=[];for(let i of e)this.filteredPostUuids.has(i.id)?this.filteredPostUuids.delete(i.id):n.push(i);return n}else{let n=[];for(let i of e){let s=i.trace_id??i.id;this.filteredPostUuids.has(s)||(i.id===s?this._shouldSample()?n.push(i):this.filteredPostUuids.add(s):n.push(i))}return n}}_getBatchSizeLimitBytes(){return p(this,null,function*(){let e=yield this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??yb})}_getMultiPartSupport(){return p(this,null,function*(){return(yield this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1})}drainAutoBatchQueue(e){let t=[];for(;this.autoBatchQueue.items.length>0;){let[n,i]=this.autoBatchQueue.pop(e);if(!n.length){i();break}let s=n.reduce((u,c)=>{let d=c.apiUrl??this.apiUrl,f=c.apiKey??this.apiKey,h=c.apiKey===this.apiKey&&c.apiUrl===this.apiUrl?"default":`${d}|${f}`;return u[h]||(u[h]=[]),u[h].push(c),u},{}),a=[];for(let[u,c]of Object.entries(s)){let d=this._processBatch(c,{apiUrl:u==="default"?void 0:u.split("|")[0],apiKey:u==="default"?void 0:u.split("|")[1]});a.push(d)}let o=Promise.all(a).finally(i);t.push(o)}return Promise.all(t)}_processBatch(e,t){return p(this,null,function*(){if(e.length)try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{let n={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)};(yield this._ensureServerInfo())?.batch_ingest_config?.use_multipart_endpoint?yield this.multipartIngestRuns(n,t):yield this.batchIngestRuns(n,t)}}catch(n){console.error("Error exporting batch:",n)}})}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){let t=new Map,n=[];for(let i of e)i.item.id&&i.otelContext&&(t.set(i.item.id,i.otelContext),i.action==="create"?n.push({operation:"post",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}):n.push({operation:"patch",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}processRunOperation(e){return p(this,null,function*(){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Dd(e.item));let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let n=yield this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t})}_getServerInfo(){return p(this,null,function*(){let e=yield this.caller.call(j(this.debug),`${this.apiUrl}/info`,l({method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(bb)},this.fetchOptions));yield K(e,"get server info");let t=yield e.json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t})}_ensureServerInfo(){return p(this,null,function*(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=p(this,null,function*(){if(this._serverInfo===void 0)try{this._serverInfo=yield this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))})}_getSettings(){return p(this,null,function*(){return this.settings||(this.settings=this._get("/settings")),yield this.settings})}flush(){return p(this,null,function*(){let e=yield this._getBatchSizeLimitBytes();yield this.drainAutoBatchQueue(e)})}_cloneCurrentOTELContext(){let e=di(),t=kc();if(this.langSmithToOTELTranslator!==void 0){let n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}createRun(e,t){return p(this,null,function*(){if(!this._filterForSampling([e]).length)return;let n=g(l({},this.headers),{"Content-Type":"application/json"}),i=e.project_name;delete e.project_name;let s=yield this.prepareRunCreateOrUpdateInputs(g(l({session_name:i},e),{start_time:e.start_time??Date.now()}));if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){let u=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:s,otelContext:u,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let a=Dd(s);t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey);let o=yield this.caller.call(j(this.debug),`${t?.apiUrl??this.apiUrl}/runs`,l({method:"POST",headers:n,body:Ge(a,`Creating run with id: ${a.id}`),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(o,"create run",!0)})}batchIngestRuns(i,s){return p(this,arguments,function*({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let a=yield Promise.all(e?.map(d=>this.prepareRunCreateOrUpdateInputs(d))??[]),o=yield Promise.all(t?.map(d=>this.prepareRunCreateOrUpdateInputs(d))??[]);if(a.length>0&&o.length>0){let d=a.reduce((m,h)=>(h.id&&(m[h.id]=h),m),{}),f=[];for(let m of o)m.id!==void 0&&d[m.id]?d[m.id]=l(l({},d[m.id]),m):f.push(m);a=Object.values(d),o=f}let u={post:a,patch:o};if(!u.post.length&&!u.patch.length)return;let c={post:[],patch:[]};for(let d of["post","patch"]){let f=d,m=u[f].reverse(),h=m.pop();for(;h!==void 0;)c[f].push(h),h=m.pop()}if(c.post.length>0||c.patch.length>0){let d=c.post.map(f=>f.id).concat(c.patch.map(f=>f.id)).join(",");yield this._postBatchIngestRuns(Ge(c,`Ingesting runs with ids: ${d}`),n)}})}_postBatchIngestRuns(e,t){return p(this,null,function*(){let n=g(l({},this.headers),{"Content-Type":"application/json",Accept:"application/json"});t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey);let i=yield this.batchIngestCaller.call(j(this.debug),`${t?.apiUrl??this.apiUrl}/runs/batch`,l({method:"POST",headers:n,body:e,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(i,"batch create run",!0)})}multipartIngestRuns(i,s){return p(this,arguments,function*({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let a={},o=[];for(let _ of e??[]){let b=yield this.prepareRunCreateOrUpdateInputs(_);b.id!==void 0&&b.attachments!==void 0&&(a[b.id]=b.attachments),delete b.attachments,o.push(b)}let u=[];for(let _ of t??[])u.push(yield this.prepareRunCreateOrUpdateInputs(_));if(o.find(_=>_.trace_id===void 0||_.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(u.find(_=>_.trace_id===void 0||_.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(o.length>0&&u.length>0){let _=o.reduce((y,v)=>(v.id&&(y[v.id]=v),y),{}),b=[];for(let y of u)y.id!==void 0&&_[y.id]?_[y.id]=l(l({},_[y.id]),y):b.push(y);o=Object.values(_),u=b}if(o.length===0&&u.length===0)return;let f=[],m=[];for(let[_,b]of[["post",o],["patch",u]])for(let y of b){let h=y,{inputs:v,outputs:w,events:T,attachments:N}=h,L=ae(h,["inputs","outputs","events","attachments"]),Z={inputs:v,outputs:w,events:T},Q=Ge(L,`Serializing for multipart ingestion of run with id: ${L.id}`);m.push({name:`${_}.${L.id}`,payload:new Blob([Q],{type:`application/json; length=${Q.length}`})});for(let[ee,ne]of Object.entries(Z)){if(ne===void 0)continue;let me=Ge(ne,`Serializing ${ee} for multipart ingestion of run with id: ${L.id}`);m.push({name:`${_}.${L.id}.${ee}`,payload:new Blob([me],{type:`application/json; length=${me.length}`})})}if(L.id!==void 0){let ee=a[L.id];if(ee){delete a[L.id];for(let[ne,me]of Object.entries(ee)){let ft,we;if(Array.isArray(me)?[ft,we]=me:(ft=me.mimeType,we=me.data),ne.includes(".")){console.warn(`Skipping attachment '${ne}' for run ${L.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}m.push({name:`attachment.${L.id}.${ne}`,payload:new Blob([we],{type:`${ft}; length=${we.byteLength}`})})}}}f.push(`trace=${L.trace_id},id=${L.id}`)}yield this._sendMultipartRequest(m,f.join("; "),n)})}_createNodeFetchBody(e,t){return p(this,null,function*(){let n=[];for(let a of e)n.push(new Blob([`--${t}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),n.push(a.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${t}--\r
`])),yield new Blob(n).arrayBuffer()})}_createMultipartStream(e,t){return p(this,null,function*(){let n=new TextEncoder;return new ReadableStream({start(a){return p(this,null,function*(){let o=u=>p(null,null,function*(){typeof u=="string"?a.enqueue(n.encode(u)):a.enqueue(u)});for(let u of e){yield o(`--${t}\r
`),yield o(`Content-Disposition: form-data; name="${u.name}"\r
`),yield o(`Content-Type: ${u.payload.type}\r
\r
`);let d=u.payload.stream().getReader();try{let f;for(;!(f=yield d.read()).done;)a.enqueue(f.value)}finally{d.releaseLock()}yield o(`\r
`)}yield o(`--${t}--\r
`),a.close()})}})})}_sendMultipartRequest(e,t,n){return p(this,null,function*(){let i="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=$c(),a=()=>this._createNodeFetchBody(e,i),o=()=>this._createMultipartStream(e,i),u=c=>p(this,null,function*(){let d=g(l({},this.headers),{"Content-Type":`multipart/form-data; boundary=${i}`});return n?.apiKey!==void 0&&(d["x-api-key"]=n.apiKey),this.batchIngestCaller.call(j(this.debug),`${n?.apiUrl??this.apiUrl}/runs/multipart`,l({method:"POST",headers:d,body:c,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))});try{let c,d=!1;!s&&!this.multipartStreamingDisabled?(d=!0,c=yield u(yield o())):c=yield u(yield a()),(!this.multipartStreamingDisabled||d)&&c.status===422&&(n?.apiUrl??this.apiUrl)!==Zd&&(console.warn(`Streaming multipart upload to ${n?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,c=yield u(yield a())),yield K(c,"ingest multipart runs",!0)}catch(c){console.warn(`${c.message.trim()}

Context: ${t}`)}})}updateRun(e,t,n){return p(this,null,function*(){H(e),t.inputs&&(t.inputs=yield this.processInputs(t.inputs)),t.outputs&&(t.outputs=yield this.processOutputs(t.outputs));let i=g(l({},t),{id:e});if(!this._filterForSampling([i],!0).length)return;if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){let o=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&i.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){yield this.processRunOperation({action:"update",item:i,otelContext:o,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:i,otelContext:o,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}let s=g(l({},this.headers),{"Content-Type":"application/json"});n?.apiKey!==void 0&&(s["x-api-key"]=n.apiKey);let a=yield this.caller.call(j(this.debug),`${n?.apiUrl??this.apiUrl}/runs/${e}`,l({method:"PATCH",headers:s,body:Ge(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(a,"update run",!0)})}readRun(n){return p(this,arguments,function*(e,{loadChildRuns:t}={loadChildRuns:!1}){H(e);let i=yield this._get(`/runs/${e}`);return t&&(i=yield this._loadChildRuns(i)),i})}getRunUrl(i){return p(this,arguments,function*({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n?.projectName?s=(yield this.readProject({projectName:n?.projectName})).id:n?.projectId?s=n?.projectId:s=(yield this.readProject({projectName:ge("PROJECT")||"default"})).id;let a=yield this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=yield this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")})}_loadChildRuns(e){return p(this,null,function*(){let t=yield gb(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},i={};t.sort((s,a)=>(s?.dotted_order??"").localeCompare(a?.dotted_order??""));for(let s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.dotted_order?.startsWith(e.dotted_order??"")&&s.id!==e.id&&(s.parent_run_id in n||(n[s.parent_run_id]=[]),n[s.parent_run_id].push(s),i[s.id]=s)}e.child_runs=n[e.id]||[];for(let s in n)s!==e.id&&(i[s].child_runs=n[s]);return e})}listRuns(e){return V(this,null,function*(){let{projectId:t,projectName:n,parentRunId:i,traceId:s,referenceExampleId:a,startTime:o,executionOrder:u,isRoot:c,runType:d,error:f,id:m,query:h,filter:_,traceFilter:b,treeFilter:y,limit:v,select:w,order:T}=e,N=[];if(t&&(N=Array.isArray(t)?t:[t]),n){let we=Array.isArray(n)?n:[n],Et=yield new x(Promise.all(we.map(Cr=>this.readProject({projectName:Cr}).then(jr=>jr.id))));N.push(...Et)}let L=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],Z={session:N.length?N:null,run_type:d,reference_example:a,query:h,filter:_,trace_filter:b,tree_filter:y,execution_order:u,parent_run:i,start_time:o?o.toISOString():null,error:f,id:m,limit:v,trace:s,select:w||L,is_root:c,order:T},Q=0;try{for(var ee=X(this._getCursorPaginatedList("/runs/query",Z)),ne,me,ft;ne=!(me=yield new x(ee.next())).done;ne=!1){let we=me.value;if(v){if(Q>=v)break;if(we.length+Q>v){let Et=we.slice(0,v-Q);yield*xe(Et);break}Q+=we.length,yield*xe(we)}else yield*xe(we)}}catch{ft=[me]}finally{try{ne&&(me=ee.return)&&(yield new x(me.call(ee)))}finally{if(ft)throw ft[0]}}})}listGroupRuns(e){return V(this,null,function*(){let{projectId:t,projectName:n,groupBy:i,filter:s,startTime:a,endTime:o,limit:u,offset:c}=e,f={session_id:t||(yield new x(this.readProject({projectName:n}))).id,group_by:i,filter:s,start_time:a?a.toISOString():null,end_time:o?o.toISOString():null,limit:Number(u)||100},m=Number(c)||0,h="/runs/group",_=`${this.apiUrl}${h}`;for(;;){let b=g(l({},f),{offset:m}),y=Object.fromEntries(Object.entries(b).filter(([L,Z])=>Z!==void 0)),v=yield new x(this.caller.call(j(),_,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)));yield new x(K(v,`Failed to fetch ${h}`));let w=yield new x(v.json()),{groups:T,total:N}=w;if(T.length===0)break;for(let L of T)yield L;if(m+=T.length,m>=N)break}})}getRunStats(v){return p(this,arguments,function*({id:e,trace:t,parentRun:n,runType:i,projectNames:s,projectIds:a,referenceExampleIds:o,startTime:u,endTime:c,error:d,query:f,filter:m,traceFilter:h,treeFilter:_,isRoot:b,dataSourceType:y}){let w=a||[];s&&(w=[...a||[],...yield Promise.all(s.map(Q=>this.readProject({projectName:Q}).then(ee=>ee.id)))]);let N=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:i,session:w,reference_example:o,start_time:u,end_time:c,error:d,query:f,filter:m,trace_filter:h,tree_filter:_,is_root:b,data_source_type:y}).filter(([Q,ee])=>ee!==void 0));return yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/runs/stats`,l({method:"POST",headers:this.headers,body:JSON.stringify(N),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}shareRun(n){return p(this,arguments,function*(e,{shareId:t}={}){let i={run_id:e,share_token:t||ce()};H(e);let a=yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/runs/${e}/share`,l({method:"PUT",headers:this.headers,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`})}unshareRun(e){return p(this,null,function*(){H(e);let t=yield this.caller.call(j(this.debug),`${this.apiUrl}/runs/${e}/share`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(t,"unshare run",!0)})}readRunSharedLink(e){return p(this,null,function*(){H(e);let n=yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/runs/${e}/share`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`})}listSharedRuns(n){return p(this,arguments,function*(e,{runIds:t}={}){let i=new URLSearchParams({share_token:e});if(t!==void 0)for(let o of t)i.append("id",o);return H(e),yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/public/${e}/runs${i}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}readDatasetSharedSchema(e,t){return p(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id),H(e);let i=yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${e}/share`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i})}shareDataset(e,t){return p(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id);let n={dataset_id:e};H(e);let s=yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${e}/share`,l({method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s})}unshareDataset(e){return p(this,null,function*(){H(e);let t=yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${e}/share`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(t,"unshare dataset",!0)})}readSharedDataset(e){return p(this,null,function*(){return H(e),yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/public/${e}/datasets`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}listSharedExamples(e,t){return p(this,null,function*(){let n={};t?.exampleIds&&(n.id=t.exampleIds);let i=new URLSearchParams;Object.entries(n).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>i.append(o,c)):i.append(o,u)});let s=yield this.caller.call(j(this.debug),`${this.apiUrl}/public/${e}/examples?${i.toString()}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)),a=yield s.json();if(!s.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${s.status}
Message: ${Array.isArray(a.detail)?a.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${s.status} ${s.statusText}`);return a.map(o=>g(l({},o),{_hostUrl:this.getHostUrl()}))})}createProject(o){return p(this,arguments,function*({projectName:e,description:t=null,metadata:n=null,upsert:i=!1,projectExtra:s=null,referenceDatasetId:a=null}){let u=i?"?upsert=true":"",c=`${this.apiUrl}/sessions${u}`,d=s||{};n&&(d.metadata=n);let f={name:e,extra:d,description:t};a!==null&&(f.reference_dataset_id=a);let m=yield this.caller.call(j(this.debug),c,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(m,"create project"),yield m.json()})}updateProject(o,u){return p(this,arguments,function*(e,{name:t=null,description:n=null,metadata:i=null,projectExtra:s=null,endTime:a=null}){let c=`${this.apiUrl}/sessions/${e}`,d=s;i&&(d=g(l({},d||{}),{metadata:i}));let f={name:t,extra:d,description:n,end_time:a?new Date(a).toISOString():null},m=yield this.caller.call(j(this.debug),c,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(m,"update project"),yield m.json()})}hasProject(n){return p(this,arguments,function*({projectId:e,projectName:t}){let i="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)H(e),i+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let a=yield this.caller.call(j(this.debug),`${this.apiUrl}${i}?${s}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));try{let o=yield a.json();return a.ok?Array.isArray(o)?o.length>0:!0:!1}catch{return!1}})}readProject(i){return p(this,arguments,function*({projectId:e,projectName:t,includeStats:n}){let s="/sessions",a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)H(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&a.append("include_stats",n.toString());let o=yield this._get(s,a),u;if(Array.isArray(o)){if(o.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);u=o[0]}else u=o;return u})}getProjectUrl(n){return p(this,arguments,function*({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let i=yield this.readProject({projectId:e,projectName:t}),s=yield this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${i.id}`})}getDatasetUrl(n){return p(this,arguments,function*({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let i=yield this.readDataset({datasetId:e,datasetName:t}),s=yield this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${i.id}`})}_getTenantId(){return p(this,null,function*(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});try{for(var t=X(this._getPaginated("/sessions",e)),n,i,s;n=!(i=yield t.next()).done;n=!1){let a=i.value;return this._tenantId=a[0].tenant_id,a[0].tenant_id}}catch{s=[i]}finally{try{n&&(i=t.return)&&(yield i.call(t))}finally{if(s)throw s[0]}}throw new Error("No projects found to resolve tenant.")})}listProjects(){return V(this,arguments,function*({projectIds:e,name:t,nameContains:n,referenceDatasetId:i,referenceDatasetName:s,referenceFree:a,metadata:o}={}){let u=new URLSearchParams;if(e!==void 0)for(let h of e)u.append("id",h);if(t!==void 0&&u.append("name",t),n!==void 0&&u.append("name_contains",n),i!==void 0)u.append("reference_dataset",i);else if(s!==void 0){let h=yield new x(this.readDataset({datasetName:s}));u.append("reference_dataset",h.id)}a!==void 0&&u.append("reference_free",a.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));try{for(var c=X(this._getPaginated("/sessions",u)),d,f,m;d=!(f=yield new x(c.next())).done;d=!1){let h=f.value;yield*xe(h)}}catch{m=[f]}finally{try{d&&(f=c.return)&&(yield new x(f.call(c)))}finally{if(m)throw m[0]}}})}deleteProject(n){return p(this,arguments,function*({projectId:e,projectName:t}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?i=(yield this.readProject({projectName:t})).id:i=e,H(i);let s=yield this.caller.call(j(this.debug),`${this.apiUrl}/sessions/${i}`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(s,`delete session ${i} (${t})`,!0)})}uploadCsv(u){return p(this,arguments,function*({csvFile:e,fileName:t,inputKeys:n,outputKeys:i,description:s,dataType:a,name:o}){let c=`${this.apiUrl}/datasets/upload`,d=new FormData;d.append("file",e,t),n.forEach(h=>{d.append("input_keys",h)}),i.forEach(h=>{d.append("output_keys",h)}),s&&d.append("description",s),a&&d.append("data_type",a),o&&d.append("name",o);let f=yield this.caller.call(j(this.debug),c,l({method:"POST",headers:this.headers,body:d,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(f,"upload CSV"),yield f.json()})}createDataset(o){return p(this,arguments,function*(e,{description:t,dataType:n,inputsSchema:i,outputsSchema:s,metadata:a}={}){let u={name:e,description:t,extra:a?{metadata:a}:void 0};n&&(u.data_type=n),i&&(u.inputs_schema_definition=i),s&&(u.outputs_schema_definition=s);let c=yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(c,"create dataset"),yield c.json()})}readDataset(n){return p(this,arguments,function*({datasetId:e,datasetName:t}){let i="/datasets",s=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)H(e),i+=`/${e}`;else if(t)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let a=yield this._get(i,s),o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o})}hasDataset(n){return p(this,arguments,function*({datasetId:e,datasetName:t}){try{return yield this.readDataset({datasetId:e,datasetName:t}),!0}catch(i){if(i instanceof Error&&i.message.toLocaleLowerCase().includes("not found"))return!1;throw i}})}diffDatasetVersions(s){return p(this,arguments,function*({datasetId:e,datasetName:t,fromVersion:n,toVersion:i}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(yield this.readDataset({datasetName:t})).id);let o=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return yield this._get(`/datasets/${a}/versions/diff`,o)})}readDatasetOpenaiFinetuning(n){return p(this,arguments,function*({datasetId:e,datasetName:t}){let i="/datasets";if(e===void 0)if(t!==void 0)e=(yield this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(yield(yield this._getResponse(`${i}/${e}/openai_ft`)).text()).trim().split(`
`).map(u=>JSON.parse(u))})}listDatasets(){return V(this,arguments,function*({limit:e=100,offset:t=0,datasetIds:n,datasetName:i,datasetNameContains:s,metadata:a}={}){let o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(let h of n)u.append("id",h);i!==void 0&&u.append("name",i),s!==void 0&&u.append("name_contains",s),a!==void 0&&u.append("metadata",JSON.stringify(a));try{for(var c=X(this._getPaginated(o,u)),d,f,m;d=!(f=yield new x(c.next())).done;d=!1){let h=f.value;yield*xe(h)}}catch{m=[f]}finally{try{d&&(f=c.return)&&(yield new x(f.call(c)))}finally{if(m)throw m[0]}}})}updateDataset(e){return p(this,null,function*(){let o=e,{datasetId:t,datasetName:n}=o,i=ae(o,["datasetId","datasetName"]);if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let s=t??(yield this.readDataset({datasetName:n})).id;H(s);let a=yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${s}`,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(a,"update dataset"),yield a.json()})}updateDatasetTag(e){return p(this,null,function*(){let{datasetId:t,datasetName:n,asOf:i,tag:s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let a=t??(yield this.readDataset({datasetName:n})).id;H(a);let o=yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${a}/tags`,l({method:"PUT",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify({as_of:typeof i=="string"?i:i.toISOString(),tag:s}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(o,"update dataset tags")})}deleteDataset(n){return p(this,arguments,function*({datasetId:e,datasetName:t}){let i="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(yield this.readDataset({datasetName:t})).id),s!==void 0)H(s),i+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");let a=yield this.caller.call(j(this.debug),this.apiUrl+i,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(a,`delete ${i}`),yield a.json()})}indexDataset(i){return p(this,arguments,function*({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(yield this.readDataset({datasetName:t})).id),H(s);let a={tag:n},o=yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${s}/index`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(o,"index dataset"),yield o.json()})}similarExamples(s,a,o){return p(this,arguments,function*(e,t,n,{filter:i}={}){let u={limit:n,inputs:e};i!==void 0&&(u.filter=i),H(t);let c=yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${t}/search`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(c,"fetch similar examples"),(yield c.json()).examples})}createExample(e,t,n){return p(this,null,function*(){if(Fd(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let i=t?n?.datasetId:e.dataset_id,s=t?n?.datasetName:e.dataset_name;if(i===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(yield this.readDataset({datasetName:s})).id);let a=(t?n?.createdAt:e.created_at)||new Date,o;Fd(e)?o=e:o={inputs:e,outputs:t,created_at:a?.toISOString(),id:n?.exampleId,metadata:n?.metadata,split:n?.split,source_run_id:n?.sourceRunId,use_source_run_io:n?.useSourceRunIO,use_source_run_attachments:n?.useSourceRunAttachments,attachments:n?.attachments};let u=yield this._uploadExamplesMultipart(i,[o]);return yield this.readExample(u.example_ids?.[0]??ce())})}createExamples(e){return p(this,null,function*(){if(Array.isArray(e)){if(e.length===0)return[];let w=e,T=w[0].dataset_id,N=w[0].dataset_name;if(T===void 0&&N===void 0)throw new Error("Must provide either datasetName or datasetId");if(T!==void 0&&N!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");T===void 0&&(T=(yield this.readDataset({datasetName:N})).id);let L=yield this._uploadExamplesMultipart(T,w);return yield Promise.all(L.example_ids.map(Q=>this.readExample(Q)))}let{inputs:t,outputs:n,metadata:i,splits:s,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:u,attachments:c,exampleIds:d,datasetId:f,datasetName:m}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let h=f,_=m;if(h===void 0&&_===void 0)throw new Error("Must provide either datasetName or datasetId");if(h!==void 0&&_!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");h===void 0&&(h=(yield this.readDataset({datasetName:_})).id);let b=t.map((w,T)=>({dataset_id:h,inputs:w,outputs:n?.[T],metadata:i?.[T],split:s?.[T],id:d?.[T],attachments:c?.[T],source_run_id:a?.[T],use_source_run_io:o?.[T],use_source_run_attachments:u?.[T]})),y=yield this._uploadExamplesMultipart(h,b);return yield Promise.all(y.example_ids.map(w=>this.readExample(w)))})}createLLMExample(e,t,n){return p(this,null,function*(){return this.createExample({input:e},{output:t},n)})}createChatExample(e,t,n){return p(this,null,function*(){let i=e.map(a=>$a(a)?Ia(a):a),s=$a(t)?Ia(t):t;return this.createExample({input:i},{output:s},n)})}readExample(e){return p(this,null,function*(){H(e);let t=`/examples/${e}`,o=yield this._get(t),{attachment_urls:i}=o,a=ae(o,["attachment_urls"]);return i&&(a.attachments=Object.entries(i).reduce((u,[c,d])=>(u[c.slice(11)]={presigned_url:d.presigned_url,mime_type:d.mime_type},u),{})),a})}listExamples(){return V(this,arguments,function*({datasetId:e,datasetName:t,exampleIds:n,asOf:i,splits:s,inlineS3Urls:a,metadata:o,limit:u,offset:c,filter:d,includeAttachments:f}={}){let m;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)m=e;else if(t!==void 0)m=(yield new x(this.readDataset({datasetName:t}))).id;else throw new Error("Must provide a datasetName or datasetId");let h=new URLSearchParams({dataset:m}),_=i?typeof i=="string"?i:i?.toISOString():void 0;_&&h.append("as_of",_);let b=a??!0;if(h.append("inline_s3_urls",b.toString()),n!==void 0)for(let Z of n)h.append("id",Z);if(s!==void 0)for(let Z of s)h.append("splits",Z);if(o!==void 0){let Z=JSON.stringify(o);h.append("metadata",Z)}u!==void 0&&h.append("limit",u.toString()),c!==void 0&&h.append("offset",c.toString()),d!==void 0&&h.append("filter",d),f===!0&&["attachment_urls","outputs","metadata"].forEach(Z=>h.append("select",Z));let y=0;try{for(var w=X(this._getPaginated("/examples",h)),T,N,L;T=!(N=yield new x(w.next())).done;T=!1){let Z=N.value;for(let Q of Z){let v=Q,{attachment_urls:ee}=v,me=ae(v,["attachment_urls"]);ee&&(me.attachments=Object.entries(ee).reduce((ft,[we,Et])=>(ft[we.slice(11)]={presigned_url:Et.presigned_url,mime_type:Et.mime_type||void 0},ft),{})),yield me,y++}if(u!==void 0&&y>=u)break}}catch{L=[N]}finally{try{T&&(N=w.return)&&(yield new x(N.call(w)))}finally{if(L)throw L[0]}}})}deleteExample(e){return p(this,null,function*(){H(e);let t=`/examples/${e}`,n=yield this.caller.call(j(this.debug),this.apiUrl+t,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(n,`delete ${t}`),yield n.json()})}updateExample(e,t){return p(this,null,function*(){let n;t?n=e:n=e.id,H(n);let i;t?i=l({id:n},t):i=e;let s;return i.dataset_id!==void 0?s=i.dataset_id:s=(yield this.readExample(n)).dataset_id,this._updateExamplesMultipart(s,[i])})}updateExamples(e){return p(this,null,function*(){let t;return e[0].dataset_id===void 0?t=(yield this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)})}readDatasetVersion(s){return p(this,arguments,function*({datasetId:e,datasetName:t,asOf:n,tag:i}){let a;if(e?a=e:a=(yield this.readDataset({datasetName:t})).id,H(a),n&&i||!n&&!i)throw new Error("Exactly one of asOf and tag must be specified.");let o=new URLSearchParams;n!==void 0&&o.append("as_of",typeof n=="string"?n:n.toISOString()),i!==void 0&&o.append("tag",i);let u=yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${a}/version?${o.toString()}`,l({method:"GET",headers:l({},this.headers),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(u,"read dataset version"),yield u.json()})}listDatasetSplits(i){return p(this,arguments,function*({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(yield this.readDataset({datasetName:t})).id:s=e,H(s);let a=new URLSearchParams,o=n?typeof n=="string"?n:n?.toISOString():void 0;return o&&a.append("as_of",o),yield this._get(`/datasets/${s}/splits`,a)})}updateDatasetSplits(a){return p(this,arguments,function*({datasetId:e,datasetName:t,splitName:n,exampleIds:i,remove:s=!1}){let o;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?o=(yield this.readDataset({datasetName:t})).id:o=e,H(o);let u={split_name:n,examples:i.map(d=>(H(d),d)),remove:s},c=yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${o}/splits`,l({method:"PUT",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(c,"update dataset splits",!0)})}evaluateRun(a,o){return p(this,arguments,function*(e,t,{sourceInfo:n,loadChildRuns:i,referenceExample:s}={loadChildRuns:!1}){bi("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let u;if(typeof e=="string")u=yield this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)u=e;else throw new Error(`Invalid run type: ${typeof e}`);u.reference_example_id!==null&&u.reference_example_id!==void 0&&(s=yield this.readExample(u.reference_example_id));let c=yield t.evaluateRun(u,s),[d,f]=yield this._logEvaluationFeedback(c,u,n);return f[0]})}createFeedback(_,b,y){return p(this,arguments,function*(e,t,{score:n,value:i,correction:s,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:d,feedbackConfig:f,projectId:m,comparativeExperimentId:h}){if(!e&&!m)throw new Error("One of runId or projectId must be provided");if(e&&m)throw new Error("Only one of runId or projectId can be provided");let v={type:u??"api",metadata:o??{}};c!==void 0&&v?.metadata!==void 0&&!v.metadata.__run&&(v.metadata.__run={run_id:c}),v?.metadata!==void 0&&v.metadata.__run?.run_id!==void 0&&H(v.metadata.__run.run_id);let w={id:d??ce(),run_id:e,key:t,score:Ud(n),value:i,correction:s,comment:a,feedback_source:v,comparative_experiment_id:h,feedbackConfig:f,session_id:m},T=`${this.apiUrl}/feedback`,N=yield this.caller.call(j(this.debug),T,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(N,"create feedback",!0),w})}updateFeedback(a,o){return p(this,arguments,function*(e,{score:t,value:n,correction:i,comment:s}){let u={};t!=null&&(u.score=Ud(t)),n!=null&&(u.value=n),i!=null&&(u.correction=i),s!=null&&(u.comment=s),H(e);let c=yield this.caller.call(j(this.debug),`${this.apiUrl}/feedback/${e}`,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(c,"update feedback",!0)})}readFeedback(e){return p(this,null,function*(){H(e);let t=`/feedback/${e}`;return yield this._get(t)})}deleteFeedback(e){return p(this,null,function*(){H(e);let t=`/feedback/${e}`,n=yield this.caller.call(j(this.debug),this.apiUrl+t,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(n,`delete ${t}`),yield n.json()})}listFeedback(){return V(this,arguments,function*({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){let i=new URLSearchParams;if(e&&i.append("run",e.join(",")),t)for(let c of t)i.append("key",c);if(n)for(let c of n)i.append("source",c);try{for(var s=X(this._getPaginated("/feedback",i)),a,o,u;a=!(o=yield new x(s.next())).done;a=!1){let c=o.value;yield*xe(c)}}catch{u=[o]}finally{try{a&&(o=s.return)&&(yield new x(o.call(s)))}finally{if(u)throw u[0]}}})}createPresignedFeedbackToken(s,a){return p(this,arguments,function*(e,t,{expiration:n,feedbackConfig:i}={}){let o={run_id:e,feedback_key:t,feedback_config:i};return n?typeof n=="string"?o.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(o.expires_in=n):o.expires_in={hours:3},yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/feedback/tokens`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}createComparativeExperiment(u){return p(this,arguments,function*({name:e,experimentIds:t,referenceDatasetId:n,createdAt:i,description:s,metadata:a,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(yield this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");let c={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:s,created_at:(i??new Date)?.toISOString(),extra:{}};return a&&(c.extra.metadata=a),yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/datasets/comparative`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}listPresignedFeedbackTokens(e){return V(this,null,function*(){H(e);let t=new URLSearchParams({run_id:e});try{for(var n=X(this._getPaginated("/feedback/tokens",t)),i,s,a;i=!(s=yield new x(n.next())).done;i=!1){let o=s.value;yield*xe(o)}}catch{a=[s]}finally{try{i&&(s=n.return)&&(yield new x(s.call(n)))}finally{if(a)throw a[0]}}})}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}_logEvaluationFeedback(e,t,n){return p(this,null,function*(){let i=this._selectEvalResults(e),s=[];for(let a of i){let o=n||{};a.evaluatorInfo&&(o=l(l({},a.evaluatorInfo),o));let u=null;a.targetRunId?u=a.targetRunId:t&&(u=t.id),s.push(yield this.createFeedback(u,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[i,s]})}logEvaluationFeedback(e,t,n){return p(this,null,function*(){let[i]=yield this._logEvaluationFeedback(e,t,n);return i})}listAnnotationQueues(){return V(this,arguments,function*(e={}){let{queueIds:t,name:n,nameContains:i,limit:s}=e,a=new URLSearchParams;t&&t.forEach((m,h)=>{H(m,`queueIds[${h}]`),a.append("ids",m)}),n&&a.append("name",n),i&&a.append("name_contains",i),a.append("limit",(s!==void 0?Math.min(s,100):100).toString());let o=0;try{for(var u=X(this._getPaginated("/annotation-queues",a)),c,d,f;c=!(d=yield new x(u.next())).done;c=!1){let m=d.value;if(yield*xe(m),o++,s!==void 0&&o>=s)break}}catch{f=[d]}finally{try{c&&(d=u.return)&&(yield new x(d.call(u)))}finally{if(f)throw f[0]}}})}createAnnotationQueue(e){return p(this,null,function*(){let{name:t,description:n,queueId:i,rubricInstructions:s}=e,a={name:t,description:n,id:i||ce(),rubric_instructions:s},o=yield this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([c,d])=>d!==void 0))),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(o,"create annotation queue"),yield o.json()})}readAnnotationQueue(e){return p(this,null,function*(){let t=yield this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${H(e,"queueId")}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(t,"read annotation queue"),yield t.json()})}updateAnnotationQueue(e,t){return p(this,null,function*(){let{name:n,description:i,rubricInstructions:s}=t,a=yield this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${H(e,"queueId")}`,l({method:"PATCH",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify({name:n,description:i,rubric_instructions:s}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(a,"update annotation queue")})}deleteAnnotationQueue(e){return p(this,null,function*(){let t=yield this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${H(e,"queueId")}`,l({method:"DELETE",headers:g(l({},this.headers),{Accept:"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(t,"delete annotation queue")})}addRunsToAnnotationQueue(e,t){return p(this,null,function*(){let n=yield this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${H(e,"queueId")}/runs`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(t.map((i,s)=>H(i,`runIds[${s}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(n,"add runs to annotation queue")})}getRunFromAnnotationQueue(e,t){return p(this,null,function*(){let n=`/annotation-queues/${H(e,"queueId")}/run`,i=yield this.caller.call(j(this.debug),`${this.apiUrl}${n}/${t}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(i,"get run from annotation queue"),yield i.json()})}deleteRunFromAnnotationQueue(e,t){return p(this,null,function*(){let n=yield this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${H(e,"queueId")}/runs/${H(t,"queueRunId")}`,l({method:"DELETE",headers:g(l({},this.headers),{Accept:"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(n,"delete run from annotation queue")})}getSizeFromAnnotationQueue(e){return p(this,null,function*(){let t=yield this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${H(e,"queueId")}/size`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(t,"get size from annotation queue"),yield t.json()})}_currentTenantIsOwner(e){return p(this,null,function*(){let t=yield this._getSettings();return e=="-"||t.tenant_handle===e})}_ownerConflictError(e,t){return p(this,null,function*(){let n=yield this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)})}_getLatestCommitHash(e){return p(this,null,function*(){let t=yield this.caller.call(j(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions)),n=yield t.json();if(!t.ok){let i=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),s=new Error(`Error ${t.status}: ${t.statusText}
${i}`);throw s.statusCode=t.status,s}if(n.commits.length!==0)return n.commits[0].commit_hash})}_likeOrUnlikePrompt(e,t){return p(this,null,function*(){let[n,i,s]=At(e),a=yield this.caller.call(j(this.debug),`${this.apiUrl}/likes/${n}/${i}`,l({method:"POST",body:JSON.stringify({like:t}),headers:g(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(a,`${t?"like":"unlike"} prompt`),yield a.json()})}_getPromptUrl(e){return p(this,null,function*(){let[t,n,i]=At(e);if(yield this._currentTenantIsOwner(t)){let s=yield this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${n}/${i.substring(0,8)}?organizationId=${s.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${s.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`})}promptExists(e){return p(this,null,function*(){return!!(yield this.getPrompt(e))})}likePrompt(e){return p(this,null,function*(){return this._likeOrUnlikePrompt(e,!0)})}unlikePrompt(e){return p(this,null,function*(){return this._likeOrUnlikePrompt(e,!1)})}listCommits(e){return V(this,null,function*(){try{for(var t=X(this._getPaginated(`/commits/${e}/`,new URLSearchParams,o=>o.commits)),n,i,s;n=!(i=yield new x(t.next())).done;n=!1){let a=i.value;yield*xe(a)}}catch{s=[i]}finally{try{n&&(i=t.return)&&(yield new x(i.call(t)))}finally{if(s)throw s[0]}}})}listPrompts(e){return V(this,null,function*(){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);try{for(var n=X(this._getPaginated("/repos",t,u=>u.repos)),i,s,a;i=!(s=yield new x(n.next())).done;i=!1){let o=s.value;yield*xe(o)}}catch{a=[s]}finally{try{i&&(s=n.return)&&(yield new x(s.call(n)))}finally{if(a)throw a[0]}}})}getPrompt(e){return p(this,null,function*(){let[t,n,i]=At(e),s=yield this.caller.call(j(this.debug),`${this.apiUrl}/repos/${t}/${n}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));if(s.status===404)return null;yield K(s,"get prompt");let a=yield s.json();return a.repo?a.repo:null})}createPrompt(e,t){return p(this,null,function*(){let n=yield this._getSettings();if(t?.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,s,a]=At(e);if(!(yield this._currentTenantIsOwner(i)))throw yield this._ownerConflictError("create a prompt",i);let o=g(l(l(l({repo_handle:s},t?.description&&{description:t.description}),t?.readme&&{readme:t.readme}),t?.tags&&{tags:t.tags}),{is_public:!!t?.isPublic}),u=yield this.caller.call(j(this.debug),`${this.apiUrl}/repos/`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(u,"create prompt");let{repo:c}=yield u.json();return c})}createCommit(e,t,n){return p(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[i,s,a]=At(e),o=n?.parentCommitHash==="latest"||!n?.parentCommitHash?yield this._getLatestCommitHash(`${i}/${s}`):n?.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=yield this.caller.call(j(this.debug),`${this.apiUrl}/commits/${i}/${s}`,l({method:"POST",headers:g(l({},this.headers),{"Content-Type":"application/json"}),body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(c,"create commit");let d=yield c.json();return this._getPromptUrl(`${i}/${s}${d.commit_hash?`:${d.commit_hash}`:""}`)})}updateExamplesMultipart(n){return p(this,arguments,function*(e,t=[]){return this._updateExamplesMultipart(e,t)})}_updateExamplesMultipart(n){return p(this,arguments,function*(e,t=[]){if(!(yield this._getMultiPartSupport()))throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let i=new FormData;for(let u of t){let c=u.id,d=l(l({},u.metadata&&{metadata:u.metadata}),u.split&&{split:u.split}),f=Ge(d,`Serializing body for example with id: ${c}`),m=new Blob([f],{type:"application/json"});if(i.append(c,m),u.inputs){let h=Ge(u.inputs,`Serializing inputs for example with id: ${c}`),_=new Blob([h],{type:"application/json"});i.append(`${c}.inputs`,_)}if(u.outputs){let h=Ge(u.outputs,`Serializing outputs whle updating example with id: ${c}`),_=new Blob([h],{type:"application/json"});i.append(`${c}.outputs`,_)}if(u.attachments)for(let[h,_]of Object.entries(u.attachments)){let b,y;Array.isArray(_)?[b,y]=_:(b=_.mimeType,y=_.data);let v=new Blob([y],{type:`${b}; length=${y.byteLength}`});i.append(`${c}.attachment.${h}`,v)}if(u.attachments_operations){let h=Ge(u.attachments_operations,`Serializing attachments while updating example with id: ${c}`),_=new Blob([h],{type:"application/json"});i.append(`${c}.attachments_operations`,_)}}let s=e??t[0]?.dataset_id;return yield(yield this.caller.call(j(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,{method:"PATCH",headers:this.headers,body:i})).json()})}uploadExamplesMultipart(n){return p(this,arguments,function*(e,t=[]){return this._uploadExamplesMultipart(e,t)})}_uploadExamplesMultipart(n){return p(this,arguments,function*(e,t=[]){if(!(yield this._getMultiPartSupport()))throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let i=new FormData;for(let o of t){let u=(o.id??ce()).toString(),c=l(l(l(l(l({created_at:o.created_at},o.metadata&&{metadata:o.metadata}),o.split&&{split:o.split}),o.source_run_id&&{source_run_id:o.source_run_id}),o.use_source_run_io&&{use_source_run_io:o.use_source_run_io}),o.use_source_run_attachments&&{use_source_run_attachments:o.use_source_run_attachments}),d=Ge(c,`Serializing body for uploaded example with id: ${u}`),f=new Blob([d],{type:"application/json"});if(i.append(u,f),o.inputs){let m=Ge(o.inputs,`Serializing inputs for uploaded example with id: ${u}`),h=new Blob([m],{type:"application/json"});i.append(`${u}.inputs`,h)}if(o.outputs){let m=Ge(o.outputs,`Serializing outputs for uploaded example with id: ${u}`),h=new Blob([m],{type:"application/json"});i.append(`${u}.outputs`,h)}if(o.attachments)for(let[m,h]of Object.entries(o.attachments)){let _,b;Array.isArray(h)?[_,b]=h:(_=h.mimeType,b=h.data);let y=new Blob([b],{type:`${_}; length=${b.byteLength}`});i.append(`${u}.attachment.${m}`,y)}}let s=yield this.caller.call(j(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,body:i});return yield K(s,"upload examples"),yield s.json()})}updatePrompt(e,t){return p(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[n,i]=At(e);if(!(yield this._currentTenantIsOwner(n)))throw yield this._ownerConflictError("update a prompt",n);let s={};if(t?.description!==void 0&&(s.description=t.description),t?.readme!==void 0&&(s.readme=t.readme),t?.tags!==void 0&&(s.tags=t.tags),t?.isPublic!==void 0&&(s.is_public=t.isPublic),t?.isArchived!==void 0&&(s.is_archived=t.isArchived),Object.keys(s).length===0)throw new Error("No valid update options provided");let a=yield this.caller.call(j(this.debug),`${this.apiUrl}/repos/${n}/${i}`,l({method:"PATCH",body:JSON.stringify(s),headers:g(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield K(a,"update prompt"),a.json()})}deletePrompt(e){return p(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[t,n,i]=At(e);if(!(yield this._currentTenantIsOwner(t)))throw yield this._ownerConflictError("delete a prompt",t);return yield(yield this.caller.call(j(this.debug),`${this.apiUrl}/repos/${t}/${n}`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions))).json()})}pullPromptCommit(e,t){return p(this,null,function*(){let[n,i,s]=At(e),a=yield this.caller.call(j(this.debug),`${this.apiUrl}/commits/${n}/${i}/${s}${t?.includeModel?"?include_model=true":""}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));yield K(a,"pull prompt commit");let o=yield a.json();return{owner:n,repo:i,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}})}_pullPrompt(e,t){return p(this,null,function*(){let n=yield this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(n.manifest)})}pushPrompt(e,t){return p(this,null,function*(){return(yield this.promptExists(e))?t&&Object.keys(t).some(i=>i!=="object")&&(yield this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic})):yield this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?yield this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):yield this._getPromptUrl(e)})}clonePublicDataset(n){return p(this,arguments,function*(e,t={}){let{sourceApiUrl:i=this.apiUrl,datasetName:s}=t,[a,o]=this.parseTokenOrUrl(e,i),u=new r({apiUrl:a,apiKey:"placeholder"}),c=yield u.readSharedDataset(o),d=s||c.name;try{if(yield this.hasDataset({datasetId:d})){console.log(`Dataset ${d} already exists in your tenant. Skipping.`);return}}catch{}let f=yield u.listSharedExamples(o),m=yield this.createDataset(d,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{yield this.createExamples({inputs:f.map(h=>h.inputs),outputs:f.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:m.id})}catch(h){throw console.error(`An error occurred while creating dataset ${d}. You should delete it manually.`),h}})}parseTokenOrUrl(e,t,n=2,i="dataset"){try{return H(e),[t,e]}catch{}try{let a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=n){let o=a[a.length-n];return[t,o]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}awaitPendingTraceBatches(){return p(this,null,function*(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();yield Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&(yield Rc()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush())})}};function Fd(r){return"dataset_id"in r||"dataset_name"in r}var Gd=r=>r!==void 0?r:!!["TRACING_V2","TRACING"].find(t=>ge(t)==="true");var Ci=Symbol.for("lc:context_variables");function wb(r){return r.replace(/[-:.]/g,"")}function Xa(r,e,t=1){let n=t.toFixed(0).slice(0,3).padStart(3,"0"),i=`${new Date(r).toISOString().slice(0,-1)}${n}Z`;return{dottedOrder:wb(i)+e,microsecondPrecisionDatestring:i}}var ji=class r{constructor(e,t,n,i){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=i}static fromHeader(e){let t=e.split(","),n={},i=[],s,a;for(let o of t){let[u,c]=o.split("="),d=decodeURIComponent(c);u==="langsmith-metadata"?n=JSON.parse(d):u==="langsmith-tags"?i=d.split(","):u==="langsmith-project"?s=d:u==="langsmith-replicas"&&(a=JSON.parse(d))}return new r(n,i,s,a)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}},at=class r{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),qd(e)){Object.assign(this,l({},e));return}let t=r.getDefaultConfig(),o=e,{metadata:n}=o,i=ae(o,["metadata"]),s=i.client??r.getSharedClient(),a=l(l({},n),i?.extra?.metadata);if(i.extra=g(l({},i.extra),{metadata:a}),Object.assign(this,g(l(l({},t),i),{client:s})),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=Tb(this.replicas),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let{dottedOrder:u,microsecondPrecisionDatestring:c}=Xa(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u,this._serialized_start_time=c}}set metadata(e){this.extra=g(l({},this.extra),{metadata:l(l({},this.extra?.metadata),e)})}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:ce(),run_type:"chain",project_name:Yr(),child_runs:[],api_url:Re("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Re("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return r.sharedClient||(r.sharedClient=new Qt),r.sharedClient}createChild(e){let t=this.child_execution_order+1,n=new r(g(l({},e),{parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t}));Ci in this&&(n[Ci]=this[Ci]);let i=Symbol.for("lc:child_config"),s=e.extra?.[i]??this.extra[i];if(xb(s)){let u=l({},s),c=vb(u.callbacks)?u.callbacks.copy?.():void 0;c&&(Object.assign(c,{_parentRunId:n.id}),c.handlers?.find(Vd)?.updateFromRunTree?.(n),u.callbacks=c),n.extra[i]=u}let a=new Set,o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}end(s,a){return p(this,arguments,function*(e,t,n=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,i&&Object.keys(i).length>0&&(this.extra=this.extra?g(l({},this.extra),{metadata:l(l({},this.extra.metadata),i)}):{metadata:i})})}_convertToCreate(e,t,n=!0){let i=e.extra??{};if(i?.runtime?.library===void 0&&(i.runtime||(i.runtime={}),t))for(let[o,u]of Object.entries(t))i.runtime[o]||(i.runtime[o]=u);let s,a;return n?(a=e.parent_run?.id??e.parent_run_id,s=[]):(s=e.child_runs.map(o=>this._convertToCreate(o,t,n)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:s,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,n=!0){let i=this._convertToCreate(this,t,n);if(e===this.project_name)return i;let s=f=>ti(`${f}:${e}`,ti.DNS),a=s(i.id),o=i.trace_id?s(i.trace_id):void 0,u=i.parent_run_id?s(i.parent_run_id):void 0,c;if(i.dotted_order){let f=Eb(i.dotted_order),m=[];for(let _=0;_<f.length-1;_++){let[b,y]=f[_],v=s(y);m.push(b.toISOString().replace(/[-:]/g,"").replace(".","")+v)}let[h]=f[f.length-1];m.push(h.toISOString().replace(/[-:]/g,"").replace(".","")+a),c=m.join(".")}else c=void 0;return g(l({},i),{id:a,trace_id:o,parent_run_id:u,dotted_order:c,session_name:e})}postRun(e=!0){return p(this,null,function*(){try{let t=li();if(this.replicas&&this.replicas.length>0)for(let{projectName:n,apiKey:i,apiUrl:s}of this.replicas){let a=this._remapForProject(n??this.project_name,t,!0);yield this.client.createRun(a,{apiKey:i,apiUrl:s})}else{let n=this._convertToCreate(this,t,e);yield this.client.createRun(n)}if(!e){bi("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let n of this.child_runs)yield n.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}})}patchRun(){return p(this,null,function*(){if(this.replicas&&this.replicas.length>0)for(let{projectName:e,apiKey:t,apiUrl:n,updates:i}of this.replicas){let s=this._remapForProject(e??this.project_name);yield this.client.updateRun(s.id,l({inputs:s.inputs,outputs:s.outputs,error:s.error,parent_run_id:s.parent_run_id,session_name:s.session_name,reference_example_id:s.reference_example_id,end_time:s.end_time,dotted_order:s.dotted_order,trace_id:s.trace_id,events:s.events,tags:s.tags,extra:s.extra,attachments:this.attachments},i),{apiKey:t,apiUrl:n})}else try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};yield this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}})}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push(g(l({},e),{time:e.time??new Date().toISOString()}))}static fromRunnableConfig(e,t){let n=e?.callbacks,i,s,a,o=Gd();if(n){let c=n?.getParentRunId?.()??"",d=n?.handlers?.find(f=>f?.name=="langchain_tracer");i=d?.getRun?.(c),s=d?.projectName,a=d?.client,o=o||!!d}return i?new r({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:a,tracingEnabled:o,project_name:s,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:l(l({},i?.extra?.metadata),e?.metadata)}}).createChild(t):new r(g(l({},t),{client:a,tracingEnabled:o,project_name:s}))}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=n["langsmith-trace"];if(!i||typeof i!="string")return;let s=i.trim(),a=s.split(".").map(c=>{let[d,f]=c.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:f}}),o=a[0].uuid,u=g(l({},t),{name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:o,dotted_order:s});if(n.baggage&&typeof n.baggage=="string"){let c=ji.fromHeader(n.baggage);u.metadata=c.metadata,u.tags=c.tags,u.project_name=c.project_name,u.replicas=c.replicas}return new r(u)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new ji(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[n,i]of Object.entries(t))e.set(n,i);return t}};Object.defineProperty(at,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function qd(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function Vd(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function Bd(r){return Array.isArray(r)&&r.some(e=>Vd(e))}function vb(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function xb(r){return r!==void 0&&typeof r.callbacks=="object"&&(Bd(r.callbacks?.handlers)||Bd(r.callbacks))}function Eb(r){return r.split(".").map(t=>{let n=t.slice(0,-36),i=t.slice(-36),s=parseInt(n.slice(0,4)),a=parseInt(n.slice(4,6))-1,o=parseInt(n.slice(6,8)),u=parseInt(n.slice(9,11)),c=parseInt(n.slice(11,13)),d=parseInt(n.slice(13,15)),f=parseInt(n.slice(15,21));return[new Date(s,a,o,u,c,d,f/1e3),i]})}function Sb(){let r=Re("LANGSMITH_RUNS_ENDPOINTS");if(!r)return[];try{let e=JSON.parse(r);return Ob(e),Object.entries(e).map(([t,n])=>({apiUrl:t.replace(/\/$/,""),apiKey:n}))}catch(e){if(Ld(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON mapping of url->apiKey"),[]}}function Tb(r){return r?r.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):Sb()}function Ob(r){if(Object.keys(r).length>0&&ge("ENDPOINT"))throw new ki}var Pb={};ve(Pb,{BaseCallbackHandler:()=>Mt,callbackHandlerPrefersStreaming:()=>Ab,isBaseCallbackHandler:()=>to});var Ib={};ve(Ib,{getEnv:()=>Yd,getEnvironmentVariable:()=>ot,getRuntimeEnvironment:()=>$b,getRuntimeEnvironmentSync:()=>zi,isBrowser:()=>Hd,isDeno:()=>Li,isJsDom:()=>Wd,isNode:()=>Kd,isWebWorker:()=>Jd});var Hd=()=>typeof window<"u"&&typeof window.document<"u",Jd=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Wd=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Li=()=>typeof Deno<"u",Kd=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Li(),Yd=()=>{let r;return Hd()?r="browser":Kd()?r="node":Jd()?r="webworker":Wd()?r="jsdom":Li()?r="deno":r="other",r},Qa;function $b(){return p(this,null,function*(){return zi()})}function zi(){return Qa===void 0&&(Qa={library:"langchain-js",runtime:Yd()}),Qa}function ot(r){try{return typeof process<"u"?process.env?.[r]:Li()?Deno?.env.get(r):void 0}catch{return}}var eo=class{};function Ab(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}var Mt=class r extends eo{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,An(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:ot("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return We.prototype.toJSON.call(this)}toJSONNotImplemented(){return We.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends r{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ce()}),Object.assign(this,e)}}return new t}},to=r=>{let e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};var kb=r=>{if(r)return r.events=r.events??[],r.child_runs=r.child_runs??[],r};function no(r,e){if(r)return new at(g(l({},r),{start_time:r._serialized_start_time??r.start_time,parent_run:no(e),child_runs:r.child_runs.map(t=>no(t)).filter(t=>t!==void 0),extra:g(l({},r.extra),{runtime:zi()}),tracingEnabled:!1}))}function ro(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function tr(r){return typeof r._addRunToRunMap=="function"}var Ve=class extends Mt{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?kb(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:n}=Xa(new Date(e.start_time).getTime(),e.id,e.execution_order),i=l({},e),s=this.getRunById(i.parent_run_id);if(i.parent_run_id!==void 0?s&&(this._addChildRun(s,i),s.child_execution_order=Math.max(s.child_execution_order,i.child_execution_order),i.trace_id=s.trace_id,s.dotted_order!==void 0&&(i.dotted_order=[s.dotted_order,t].join("."),i._serialized_start_time=n)):(i.trace_id=i.id,i.dotted_order=t,i._serialized_start_time=n),this.usesRunTreeMap){let a=no(i,s);a!==void 0&&this.runTreeMap.set(i.id,a)}else this.runMap.set(i.id,i);return i}_endTrace(e){return p(this,null,function*(){let t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):yield this.persistRun(e),yield this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)})}_getExecutionOrder(e){let t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,i,s,a,o,u){let c=this._getExecutionOrder(i),d=Date.now(),f=o?g(l({},s),{metadata:o}):s,m={id:n,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:f??{},tags:a||[]};return this._addRunToRunMap(m)}handleLLMStart(e,t,n,i,s,a,o,u){return p(this,null,function*(){let c=this.getRunById(n)??this._createRunForLLMStart(e,t,n,i,s,a,o,u);return yield this.onRunCreate?.(c),yield this.onLLMStart?.(c),c})}_createRunForChatModelStart(e,t,n,i,s,a,o,u){let c=this._getExecutionOrder(i),d=Date.now(),f=o?g(l({},s),{metadata:o}):s,m={id:n,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:f??{},tags:a||[]};return this._addRunToRunMap(m)}handleChatModelStart(e,t,n,i,s,a,o,u){return p(this,null,function*(){let c=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,i,s,a,o,u);return yield this.onRunCreate?.(c),yield this.onLLMStart?.(c),c})}handleLLMEnd(e,t,n,i,s){return p(this,null,function*(){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra=l(l({},a.extra),s),yield this.onLLMEnd?.(a),yield this._endTrace(a),a})}handleLLMError(e,t,n,i,s){return p(this,null,function*(){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra=l(l({},a.extra),s),yield this.onLLMError?.(a),yield this._endTrace(a),a})}_createRunForChainStart(e,t,n,i,s,a,o,u){let c=this._getExecutionOrder(i),d=Date.now(),f={id:n,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(f)}handleChainStart(e,t,n,i,s,a,o,u){return p(this,null,function*(){let c=this.getRunById(n)??this._createRunForChainStart(e,t,n,i,s,a,o,u);return yield this.onRunCreate?.(c),yield this.onChainStart?.(c),c})}handleChainEnd(e,t,n,i,s){return p(this,null,function*(){let a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=ro(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),s?.inputs!==void 0&&(a.inputs=ro(s.inputs,"input")),yield this.onChainEnd?.(a),yield this._endTrace(a),a})}handleChainError(e,t,n,i,s){return p(this,null,function*(){let a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),s?.inputs!==void 0&&(a.inputs=ro(s.inputs,"input")),yield this.onChainError?.(a),yield this._endTrace(a),a})}_createRunForToolStart(e,t,n,i,s,a,o){let u=this._getExecutionOrder(i),c=Date.now(),d={id:n,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(d)}handleToolStart(e,t,n,i,s,a,o){return p(this,null,function*(){let u=this.getRunById(n)??this._createRunForToolStart(e,t,n,i,s,a,o);return yield this.onRunCreate?.(u),yield this.onToolStart?.(u),u})}handleToolEnd(e,t){return p(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),yield this.onToolEnd?.(n),yield this._endTrace(n),n})}handleToolError(e,t){return p(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),yield this.onToolError?.(n),yield this._endTrace(n),n})}handleAgentAction(e,t){return p(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="chain")return;let i=n;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentAction?.(n)})}handleAgentEnd(e,t){return p(this,null,function*(){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentEnd?.(n))})}_createRunForRetrieverStart(e,t,n,i,s,a,o){let u=this._getExecutionOrder(i),c=Date.now(),d={id:n,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(d)}handleRetrieverStart(e,t,n,i,s,a,o){return p(this,null,function*(){let u=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,i,s,a,o);return yield this.onRunCreate?.(u),yield this.onRetrieverStart?.(u),u})}handleRetrieverEnd(e,t){return p(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),yield this.onRetrieverEnd?.(n),yield this._endTrace(n),n})}handleRetrieverError(e,t){return p(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),yield this.onRetrieverError?.(n),yield this._endTrace(n),n})}handleText(e,t){return p(this,null,function*(){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),yield this.onText?.(n))})}handleLLMNewToken(e,t,n,i,s,a){return p(this,null,function*(){let o=this.getRunById(n);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),yield this.onLLMNewToken?.(o,e,{chunk:a?.chunk}),o})}};var Vb={};ve(Vb,{AsyncGeneratorWithSetup:()=>wt,IterableReadableStream:()=>Oe,atee:()=>Hi,concat:()=>ut,pipeGeneratorWithSetup:()=>co});var Gb={};ve(Gb,{BaseCallbackManager:()=>Ui,BaseRunManager:()=>ir,CallbackManager:()=>rt,CallbackManagerForChainRun:()=>Fi,CallbackManagerForLLMRun:()=>un,CallbackManagerForRetrieverRun:()=>Zi,CallbackManagerForToolRun:()=>Gi,TraceGroup:()=>Bi,ensureHandler:()=>Tr,parseCallbackConfigArg:()=>Ub,traceAsGroup:()=>Fb});var Cb={};ve(Cb,{ConsoleCallbackHandler:()=>Sr});var io=pt(tf(),1);function Le(r,e){return`${r.open}${e}${r.close}`}function tt(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function rf(r){return typeof r=="string"?r.trim():r==null?r:tt(r,r.toString())}function Dt(r){if(!r.end_time)return"";let e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:Be}=io.default,Sr=class extends Ve{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],n=e;for(;n.parent_run_id;){let i=this.runMap.get(n.parent_run_id);if(i)t.push(i),n=i;else break}return t}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((i,s,a)=>{let o=`${i.execution_order}:${i.run_type}:${i.name}`;return s===a.length-1?Le(io.default.bold,o):o}).join(" > ");return Le(Be.grey,n)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.green,"[chain/start]")} [${t}] Entering Chain run with input: ${tt(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.cyan,"[chain/end]")} [${t}] [${Dt(e)}] Exiting Chain run with output: ${tt(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.red,"[chain/error]")} [${t}] [${Dt(e)}] Chain run errored with error: ${tt(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${Le(Be.green,"[llm/start]")} [${t}] Entering LLM run with input: ${tt(n,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.cyan,"[llm/end]")} [${t}] [${Dt(e)}] Exiting LLM run with output: ${tt(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.red,"[llm/error]")} [${t}] [${Dt(e)}] LLM run errored with error: ${tt(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.green,"[tool/start]")} [${t}] Entering Tool run with input: "${rf(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.cyan,"[tool/end]")} [${t}] [${Dt(e)}] Exiting Tool run with output: "${rf(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.red,"[tool/error]")} [${t}] [${Dt(e)}] Tool run errored with error: ${tt(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${tt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.cyan,"[retriever/end]")} [${t}] [${Dt(e)}] Exiting Retriever run with output: ${tt(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Be.red,"[retriever/error]")} [${t}] [${Dt(e)}] Retriever run errored with error: ${tt(e.error,"[error]")}`)}onAgentAction(e){let t=e,n=this.getBreadcrumbs(e);console.log(`${Le(Be.blue,"[agent/action]")} [${n}] Agent selected action: ${tt(t.actions[t.actions.length-1],"[action]")}`)}};var jb={};ve(jb,{LangChainTracer:()=>Ut});var so,Mi=()=>{if(so===void 0){let r=ot("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};so=new Qt(r)}return so};var Ut=class r extends Ve{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});let{exampleId:t,projectName:n,client:i,replicas:s}=e;this.projectName=n??Yr(),this.replicas=s,this.exampleId=t,this.client=i??Mi();let a=r.getTraceableRunTree();a&&this.updateFromRunTree(a)}persistRun(e){return p(this,null,function*(){})}onRunCreate(e){return p(this,null,function*(){yield this.getRunTreeWithTracingConfig(e.id)?.postRun()})}onRunUpdate(e){return p(this,null,function*(){yield this.getRunTreeWithTracingConfig(e.id)?.patchRun()})}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let t=e,n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();let i=[t];for(;i.length>0;){let s=i.shift();!s||n.has(s.id)||(n.add(s.id),this.runTreeMap.set(s.id,s),s.child_runs&&i.push(...s.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new at(g(l({},t),{client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0}))}static getTraceableRunTree(){try{return Ju(!0)}catch{return}}};var Mb={};ve(Mb,{awaitAllCallbacks:()=>af,consumeCallback:()=>de});var Di=pt(_i(),1);var nf=Symbol.for("ls:tracing_async_local_storage"),rr=Symbol.for("lc:context_variables"),sf=r=>{globalThis[nf]=r},Zt=()=>globalThis[nf];var nr;function Lb(){let r="default"in Di.default?Di.default.default:Di.default;return new r({autoStart:!0,concurrency:1})}function zb(){return typeof nr>"u"&&(nr=Lb()),nr}function de(r,e){return p(this,null,function*(){if(e===!0){let t=Zt();t!==void 0?yield t.run(void 0,()=>p(null,null,function*(){return r()})):yield r()}else nr=zb(),nr.add(()=>p(null,null,function*(){let t=Zt();t!==void 0?yield t.run(void 0,()=>p(null,null,function*(){return r()})):yield r()}))})}function af(){return p(this,null,function*(){let r=Mi();yield Promise.allSettled([typeof nr<"u"?nr.onIdle():Promise.resolve(),r.awaitPendingTraceBatches()])})}var of=r=>r!==void 0?r:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>ot(t)==="true");function ao(r){let e=Zt();return e===void 0?void 0:e.getStore()?.[rr]?.[r]}var Db=Symbol("lc:configure_hooks"),uf=()=>ao(Db)||[];function Ub(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}var Ui=class{setHandler(e){return this.setHandlers([e])}},ir=class{constructor(e,t,n,i,s,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}handleText(e){return p(this,null,function*(){yield Promise.all(this.handlers.map(t=>de(()=>p(this,null,function*(){try{yield t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}handleCustomEvent(e,t,n,i,s){return p(this,null,function*(){yield Promise.all(this.handlers.map(a=>de(()=>p(this,null,function*(){try{yield a.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}},Zi=class extends ir{getChild(e){let t=new rt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleRetrieverEnd(e){return p(this,null,function*(){yield Promise.all(this.handlers.map(t=>de(()=>p(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw n}}),t.awaitHandlers)))})}handleRetrieverError(e){return p(this,null,function*(){yield Promise.all(this.handlers.map(t=>de(()=>p(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${n}`),t.raiseError)throw e}}),t.awaitHandlers)))})}},un=class extends ir{handleLLMNewToken(e,t,n,i,s,a){return p(this,null,function*(){yield Promise.all(this.handlers.map(o=>de(()=>p(this,null,function*(){if(!o.ignoreLLM)try{yield o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}}),o.awaitHandlers)))})}handleLLMError(e,t,n,i,s){return p(this,null,function*(){yield Promise.all(this.handlers.map(a=>de(()=>p(this,null,function*(){if(!a.ignoreLLM)try{yield a.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}handleLLMEnd(e,t,n,i,s){return p(this,null,function*(){yield Promise.all(this.handlers.map(a=>de(()=>p(this,null,function*(){if(!a.ignoreLLM)try{yield a.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}},Fi=class extends ir{getChild(e){let t=new rt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleChainError(e,t,n,i,s){return p(this,null,function*(){yield Promise.all(this.handlers.map(a=>de(()=>p(this,null,function*(){if(!a.ignoreChain)try{yield a.handleChainError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}handleChainEnd(e,t,n,i,s){return p(this,null,function*(){yield Promise.all(this.handlers.map(a=>de(()=>p(this,null,function*(){if(!a.ignoreChain)try{yield a.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}handleAgentAction(e){return p(this,null,function*(){yield Promise.all(this.handlers.map(t=>de(()=>p(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}handleAgentEnd(e){return p(this,null,function*(){yield Promise.all(this.handlers.map(t=>de(()=>p(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}},Gi=class extends ir{getChild(e){let t=new rt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleToolError(e){return p(this,null,function*(){yield Promise.all(this.handlers.map(t=>de(()=>p(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}handleToolEnd(e){return p(this,null,function*(){yield Promise.all(this.handlers.map(t=>de(()=>p(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}},rt=class r extends Ui{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}handleLLMStart(e,t,n=void 0,i=void 0,s=void 0,a=void 0,o=void 0,u=void 0){return p(this,null,function*(){return Promise.all(t.map((c,d)=>p(this,null,function*(){let f=d===0&&n?n:ce();return yield Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return tr(m)&&m._createRunForLLMStart(e,[c],f,this._parentRunId,s,this.tags,this.metadata,u),de(()=>p(this,null,function*(){try{yield m.handleLLMStart?.(e,[c],f,this._parentRunId,s,this.tags,this.metadata,u)}catch(h){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${h}`),m.raiseError)throw h}}),m.awaitHandlers)})),new un(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChatModelStart(e,t,n=void 0,i=void 0,s=void 0,a=void 0,o=void 0,u=void 0){return p(this,null,function*(){return Promise.all(t.map((c,d)=>p(this,null,function*(){let f=d===0&&n?n:ce();return yield Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return tr(m)&&m._createRunForChatModelStart(e,[c],f,this._parentRunId,s,this.tags,this.metadata,u),de(()=>p(this,null,function*(){try{if(m.handleChatModelStart)yield m.handleChatModelStart?.(e,[c],f,this._parentRunId,s,this.tags,this.metadata,u);else if(m.handleLLMStart){let h=Mn(c);yield m.handleLLMStart?.(e,[h],f,this._parentRunId,s,this.tags,this.metadata,u)}}catch(h){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${h}`),m.raiseError)throw h}}),m.awaitHandlers)})),new un(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChainStart(u,c){return p(this,arguments,function*(e,t,n=ce(),i=void 0,s=void 0,a=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>{if(!d.ignoreChain)return tr(d)&&d._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,i,o),de(()=>p(this,null,function*(){try{yield d.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,i,o)}catch(f){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleChainStart: ${f}`),d.raiseError)throw f}}),d.awaitHandlers)})),new Fi(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleToolStart(u,c){return p(this,arguments,function*(e,t,n=ce(),i=void 0,s=void 0,a=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>{if(!d.ignoreAgent)return tr(d)&&d._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),de(()=>p(this,null,function*(){try{yield d.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(f){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleToolStart: ${f}`),d.raiseError)throw f}}),d.awaitHandlers)})),new Gi(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleRetrieverStart(u,c){return p(this,arguments,function*(e,t,n=ce(),i=void 0,s=void 0,a=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>{if(!d.ignoreRetriever)return tr(d)&&d._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),de(()=>p(this,null,function*(){try{yield d.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(f){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleRetrieverStart: ${f}`),d.raiseError)throw f}}),d.awaitHandlers)})),new Zi(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleCustomEvent(e,t,n,i,s){return p(this,null,function*(){yield Promise.all(this.handlers.map(a=>de(()=>p(this,null,function*(){if(!a.ignoreCustomEvent)try{yield a.handleCustomEvent?.(e,t,n,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata=l(l({},this.metadata),e),t&&(this.inheritableMetadata=l(l({},this.inheritableMetadata),e))}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let n=new r(this._parentRunId);for(let i of this.handlers){let s=this.inheritableHandlers.includes(i);n.addHandler(i,s)}for(let i of this.tags){let s=this.inheritableTags.includes(i);n.addTags([i],s)}for(let i of Object.keys(this.metadata)){let s=Object.keys(this.inheritableMetadata).includes(i);n.addMetadata({[i]:this.metadata[i]},s)}for(let i of e)n.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===i.name)||n.addHandler(i,t);return n}static fromHandlers(e){class t extends Mt{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ce()}),Object.assign(this,e)}}let n=new this;return n.addHandler(new t),n}static configure(e,t,n,i,s,a,o){return this._configureSync(e,t,n,i,s,a,o)}static _configureSync(e,t,n,i,s,a,o){let u;(e||t)&&(Array.isArray(e)||!e?(u=new r,u.setHandlers(e?.map(Tr)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(Tr):t?.handlers,!1));let c=ot("LANGCHAIN_VERBOSE")==="true"||o?.verbose,d=Ut.getTraceableRunTree()?.tracingEnabled||of(),f=d||(ot("LANGCHAIN_TRACING")??!1);if(c||f){if(u||(u=new r),c&&!u.handlers.some(m=>m.name===Sr.prototype.name)){let m=new Sr;u.addHandler(m,!0)}if(f&&!u.handlers.some(m=>m.name==="langchain_tracer")&&d){let m=new Ut;u.addHandler(m,!0),u._parentRunId=Ut.getTraceableRunTree()?.id??u._parentRunId}}for(let{contextVar:m,inheritable:h=!0,handlerClass:_,envVar:b}of uf()){let y=b&&ot(b)==="true"&&_,v,w=m!==void 0?ao(m):void 0;w&&to(w)?v=w:y&&(v=new _({})),v!==void 0&&(u||(u=new r),u.handlers.some(T=>T.name===v.name)||u.addHandler(v,h))}return(n||i)&&u&&(u.addTags(n??[]),u.addTags(i??[],!1)),(s||a)&&u&&(u.addMetadata(s??{}),u.addMetadata(a??{},!1)),u}};function Tr(r){return"name"in r?r:Mt.fromMethods(r)}var Bi=class{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getTraceGroupCallbackManager(e,t,n){return p(this,null,function*(){let i=new Ut(n),a=yield(yield rt.configure([i]))?.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},t??{});if(!a)throw new Error("Failed to create run group callback manager.");return a})}start(e){return p(this,null,function*(){return this.runManager||(this.runManager=yield this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()})}error(e){return p(this,null,function*(){this.runManager&&(yield this.runManager.handleChainError(e),this.runManager=void 0)})}end(e){return p(this,null,function*(){this.runManager&&(yield this.runManager.handleChainEnd(e??{}),this.runManager=void 0)})}};function Zb(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function Fb(r,e,...t){return p(this,null,function*(){let n=new Bi(r.name,r),i=yield n.start(l({},t));try{let s=yield e(i,...t);return yield n.end(Zb(s,"output")),s}catch(s){throw yield n.error(s),s}})}var qi=class{getStore(){}run(e,t){return t()}enterWith(e){}},Bb=new qi,cf=Symbol.for("lc:child_config"),oo=class{getInstance(){return Zt()??Bb}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[cf]}runWithConfig(e,t,n){let i=rt._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),s=this.getInstance(),a=s.getStore(),o=i?.getParentRunId(),u=i?.handlers?.find(d=>d?.name==="langchain_tracer"),c;return u&&o?c=u.getRunTreeWithTracingConfig(o):n||(c=new at({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra=g(l({},c.extra),{[cf]:e})),a!==void 0&&a[rr]!==void 0&&(c===void 0&&(c={}),c[rr]=a[rr]),s.run(c,t)}initializeGlobalInstance(e){Zt()===void 0&&sf(e)}},He=new oo;var Vi=25;function nt(r){return p(this,null,function*(){return rt._configureSync(r?.callbacks,void 0,r?.tags,void 0,r?.metadata)})}function uo(...r){let e={};for(let t of r.filter(n=>!!n))for(let n of Object.keys(t))if(n==="metadata")e[n]=l(l({},e[n]),t[n]);else if(n==="tags"){let i=e[n]??[];e[n]=[...new Set(i.concat(t[n]??[]))]}else if(n==="configurable")e[n]=l(l({},e[n]),t[n]);else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){let i=e.callbacks,s=t.callbacks;if(Array.isArray(s))if(!i)e.callbacks=s;else if(Array.isArray(i))e.callbacks=i.concat(s);else{let a=i.copy();for(let o of s)a.addHandler(Tr(o),!0);e.callbacks=a}else if(s)if(!i)e.callbacks=s;else if(Array.isArray(i)){let a=s.copy();for(let o of i)a.addHandler(Tr(o),!0);e.callbacks=a}else e.callbacks=new rt(s._parentRunId,{handlers:i.handlers.concat(s.handlers),inheritableHandlers:i.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(s.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(s.inheritableTags))),metadata:l(l({},i.metadata),s.metadata)})}else{let i=n;e[i]=t[i]??e[i]}return e}var qb=new Set(["string","number","boolean"]);function ie(r){let e=He.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let n=e,{runId:i,runName:s}=n,a=ae(n,["runId","runName"]);t=Object.entries(a).reduce((o,[u,c])=>(c!==void 0&&(o[u]=c),o),t)}if(r&&(t=Object.entries(r).reduce((i,[s,a])=>(a!==void 0&&(i[s]=a),i),t)),t?.configurable)for(let i of Object.keys(t.configurable))qb.has(typeof t.configurable[i])&&!t.metadata?.[i]&&(t.metadata||(t.metadata={}),t.metadata[i]=t.configurable[i]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let i=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,i])):t.signal=i,delete t.timeout}return t}function Te(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:i,configurable:s,runId:a}={}){let o=ie(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),i!==void 0&&(o.runName=i),s!==void 0&&(o.configurable=l(l({},o.configurable),s)),a!==void 0&&delete o.runId,o}function Pt(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}function bt(r,e){return p(this,null,function*(){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!e?.aborted)throw n}),new Promise((n,i)=>{t=()=>{i(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&i(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))})}var Oe=class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}next(){return p(this,null,function*(){this.ensureReader();try{let e=yield this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}})}return(){return p(this,null,function*(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),yield e}return{done:!0,value:void 0}})}throw(e){return p(this,null,function*(){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),yield t}throw e})}[Symbol.asyncIterator](){return this}[Symbol.asyncDispose](){return p(this,null,function*(){yield this.return()})}static fromReadableStream(e){let t=e.getReader();return new r({start(n){return i();function i(){return t.read().then(({done:s,value:a})=>{if(s){n.close();return}return n.enqueue(a),i()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({pull(n){return p(this,null,function*(){let{value:i,done:s}=yield e.next();s&&n.close(),n.enqueue(i)})},cancel(n){return p(this,null,function*(){yield e.return(n)})}})}};function Hi(r,e=2){let t=Array.from({length:e},()=>[]);return t.map(function(i){return V(this,null,function*(){for(;;)if(i.length===0){let s=yield new x(r.next());for(let a of t)a.push(s)}else{if(i[0].done)return;yield i.shift().value}})})}function ut(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){let t=l({},r);for(let[n,i]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=ut(t[n],i):t[n]=i;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var wt=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,n)=>{He.runWithConfig(Pt(e.config),()=>p(this,null,function*(){this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,n):this.firstResult.then(i=>t(void 0),n)}),!0)})}next(...e){return p(this,null,function*(){return this.signal?.throwIfAborted(),this.firstResultUsed?He.runWithConfig(Pt(this.config),this.signal?()=>p(this,null,function*(){return bt(this.generator.next(...e),this.signal)}):()=>p(this,null,function*(){return this.generator.next(...e)}),!0):(this.firstResultUsed=!0,this.firstResult)})}return(e){return p(this,null,function*(){return this.generator.return(e)})}throw(e){return p(this,null,function*(){return this.generator.throw(e)})}[Symbol.asyncIterator](){return this}[Symbol.asyncDispose](){return p(this,null,function*(){yield this.return()})}};function co(r,e,t,n,...i){return p(this,null,function*(){let s=new wt({generator:e,startSetup:t,signal:n}),a=yield s.setup;return{output:r(s,a,...i),setup:a}})}var it=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),n=Xt({},t);return new Or({ops:t,state:n[n.length-1].newDocument})}},Or=class r extends it{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),n=Xt(this.state,e.ops);return new r({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){let t=Xt({},e.ops);return new r({ops:e.ops,state:t[t.length-1].newDocument})}},lo=r=>r.name==="log_stream_tracer";function lf(r,e){return p(this,null,function*(){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input})}function df(r,e){return p(this,null,function*(){let{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t})}function Hb(r){return r!==void 0&&r.message!==void 0}var $r=class extends Ve{constructor(e){super(l({_awaitHandler:!0},e)),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Oe.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(e){return p(this,null,function*(){})}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(i=>!this.excludeTags?.includes(i))),n}tapOutputIterable(e,t){return V(this,null,function*(){try{for(var n=X(t),i,s,a;i=!(s=yield new x(n.next())).done;i=!1){let o=s.value;if(e!==this.rootId){let u=this.keyMapByRunId[e];u&&(yield new x(this.writer.write(new it({ops:[{op:"add",path:`/logs/${u}/streamed_output/-`,value:o}]}))))}yield o}}catch{a=[s]}finally{try{i&&(s=n.return)&&(yield new x(s.call(n)))}finally{if(a)throw a[0]}}})}onRunCreate(e){return p(this,null,function*(){if(this.rootId===void 0&&(this.rootId=e.id,yield this.writer.write(new it({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=yield lf(e,this._schemaFormat)),yield this.writer.write(new it({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))})}onRunUpdate(e){return p(this,null,function*(){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:yield lf(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:yield df(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let i=new it({ops:n});yield this.writer.write(i)}finally{if(e.id===this.rootId){let t=new it({ops:[{op:"replace",path:"/final_output",value:yield df(e,this._schemaFormat)}]});yield this.writer.write(t),this.autoClose&&(yield this.writer.close())}}})}onLLMNewToken(e,t,n){return p(this,null,function*(){let i=this.keyMapByRunId[e.id];if(i===void 0)return;let s=e.inputs.messages!==void 0,a;s?Hb(n?.chunk)?a=n?.chunk:a=new Nt({id:`run-${e.id}`,content:t}):a=t;let o=new it({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:a}]});yield this.writer.write(o)})}};var Kb={};ve(Kb,{ChatGenerationChunk:()=>fo,GenerationChunk:()=>sr,RUN_KEY:()=>Wb});var Wb="__run",sr=class r{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new r({text:this.text+e.text,generationInfo:l(l({},this.generationInfo),e.generationInfo)})}},fo=class r extends sr{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new r({text:this.text+e.text,generationInfo:l(l({},this.generationInfo),e.generationInfo),message:this.message.concat(e.message)})}};function Ji({name:r,serialized:e}){return r!==void 0?r:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var ff=r=>r.name==="event_stream_tracer",Wi=class extends Ve{constructor(e){super(l({_awaitHandler:!0},e)),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Oe.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(e){return p(this,null,function*(){})}_includeRun(e){let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(i=>!this.excludeTags?.includes(i))),n}tapOutputIterable(e,t){return V(this,null,function*(){let n=yield new x(t.next());if(n.done)return;let i=this.runInfoMap.get(e);if(i===void 0){yield n.value;return}function s(b,y){return b==="llm"&&typeof y=="string"?new sr({text:y}):y}let a=this.tappedPromises.get(e);if(a===void 0){let b;a=new Promise(y=>{b=y}),this.tappedPromises.set(e,a);try{let y={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};yield new x(this.send(g(l({},y),{data:{chunk:s(i.runType,n.value)}}),i)),yield n.value;try{for(var o=X(t),u,c,d;u=!(c=yield new x(o.next())).done;u=!1){let v=c.value;i.runType!=="tool"&&i.runType!=="retriever"&&(yield new x(this.send(g(l({},y),{data:{chunk:s(i.runType,v)}}),i))),yield v}}catch{d=[c]}finally{try{u&&(c=o.return)&&(yield new x(c.call(o)))}finally{if(d)throw d[0]}}}finally{b()}}else{yield n.value;try{for(var f=X(t),m,h,_;m=!(h=yield new x(f.next())).done;m=!1){let b=h.value;yield b}}catch{_=[h]}finally{try{m&&(h=f.return)&&(yield new x(h.call(f)))}finally{if(_)throw _[0]}}}})}send(e,t){return p(this,null,function*(){this._includeRun(t)&&(yield this.writer.write(e))})}sendEndEvent(e,t){return p(this,null,function*(){let n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):yield this.send(e,t)})}onLLMStart(e){return p(this,null,function*(){let t=Ji(e),n=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,i);let s=`on_${n}_start`;yield this.send({event:s,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)})}onLLMNewToken(e,t,n){return p(this,null,function*(){let i=this.runInfoMap.get(e.id),s,a;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(i.runType==="chat_model")a="on_chat_model_stream",n?.chunk===void 0?s=new Nt({content:t,id:`run-${e.id}`}):s=n.chunk.message;else if(i.runType==="llm")a="on_llm_stream",n?.chunk===void 0?s=new sr({text:t}):s=n.chunk;else throw new Error(`Unexpected run type ${i.runType}`);yield this.send({event:a,data:{chunk:s},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}})}onLLMEnd(e){return p(this,null,function*(){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let i=e.outputs?.generations,s;if(t.runType==="chat_model"){for(let a of i??[]){if(s!==void 0)break;s=a[0]?.message}n="on_chat_model_end"}else if(t.runType==="llm")s={generations:i?.map(a=>a.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);yield this.sendEndEvent({event:n,data:{output:s,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}onChainStart(e){return p(this,null,function*(){let t=Ji(e),n=e.run_type??"chain",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},i.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,i.inputs=e.inputs.input):(s.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),yield this.send({event:`on_${n}_start`,data:s,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)})}onChainEnd(e){return p(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let n=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},a={output:e.outputs?.output??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(a.input=i.input,t.inputs=i.input),yield this.sendEndEvent({event:n,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)})}onToolStart(e){return p(this,null,function*(){let t=Ji(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),yield this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)})}onToolEnd(e){return p(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let n=e.outputs?.output===void 0?e.outputs:e.outputs.output;yield this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}onRetrieverStart(e){return p(this,null,function*(){let t=Ji(e),i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),yield this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)})}onRetrieverEnd(e){return p(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);yield this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}handleCustomEvent(e,t,n){return p(this,null,function*(){let i=this.runInfoMap.get(n);if(i===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);yield this.send({event:"on_custom_event",run_id:n,name:e,tags:i.tags,metadata:i.metadata,data:t},i)})}finish(){return p(this,null,function*(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})})}};var Qb={};ve(Qb,{AsyncCaller:()=>cn});var pf=pt(Kn(),1),Ki=pt(_i(),1),Yb=[400,401,402,403,404,405,406,407,409],Xb=r=>{if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||r?.code==="ECONNABORTED")throw r;let e=r?.response?.status??r?.status;if(e&&Yb.includes(+e))throw r;if(r?.error?.code==="insufficient_quota"){let t=new Error(r?.message);throw t.name="InsufficientQuotaError",t}},cn=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Xb;let t="default"in Ki.default?Ki.default.default:Ki.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,pf.default)(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((i,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var ln=class extends Ve{constructor({config:e,onStart:t,onEnd:n,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=i}persistRun(e){return Promise.resolve()}onRunCreate(e){return p(this,null,function*(){this.rootId||(this.rootId=e.id,this.argOnStart&&(yield this.argOnStart(e,this.config)))})}onRunUpdate(e){return p(this,null,function*(){e.id===this.rootId&&(e.error?this.argOnError&&(yield this.argOnError(e,this.config)):this.argOnEnd&&(yield this.argOnEnd(e,this.config)))})}};function dn(r){return r?r.lc_runnable:!1}var Yi=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,i=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||i.some(s=>this.includeTags?.includes(s))),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&i.every(s=>!this.excludeTags?.includes(s))),n}};function po(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}var ew=["*","_","`"];function tw(r){let e="";for(let[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function hf(r,e,t){let{firstNode:n,lastNode:i,nodeColors:s,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{},c=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){let h="default",_={[h]:"{0}({1})"};n!==void 0&&(_[n]="{0}([{1}]):::first"),i!==void 0&&(_[i]="{0}([{1}]):::last");for(let[b,y]of Object.entries(r)){let v=y.name.split(":").pop()??"",T=ew.some(L=>v.startsWith(L)&&v.endsWith(L))?`<p>${v}</p>`:v;Object.keys(y.metadata??{}).length&&(T+=`<hr/><small><em>${Object.entries(y.metadata??{}).map(([L,Z])=>`${L} = ${Z}`).join(`
`)}</em></small>`);let N=(_[b]??_[h]).replace("{0}",po(b)).replace("{1}",T);c+=`	${N}
`}}let d={};for(let h of e){let _=h.source.split(":"),b=h.target.split(":"),y=_.filter((v,w)=>v===b[w]).join(":");d[y]||(d[y]=[]),d[y].push(h)}let f=new Set;function m(h,_){let b=h.length===1&&h[0].source===h[0].target;if(_&&!b){let y=_.split(":").pop();if(f.has(y))throw new Error(`Found duplicate subgraph '${y}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);f.add(y),c+=`	subgraph ${y}
`}for(let y of h){let{source:v,target:w,data:T,conditional:N}=y,L="";if(T!==void 0){let Z=T,Q=Z.split(" ");Q.length>u&&(Z=Array.from({length:Math.ceil(Q.length/u)},(ee,ne)=>Q.slice(ne*u,(ne+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),L=N?` -. &nbsp;${Z}&nbsp; .-> `:` -- &nbsp;${Z}&nbsp; --> `}else L=N?" -.-> ":" --> ";c+=`	${po(v)}${L}${po(w)};
`}for(let y in d)y.startsWith(`${_}:`)&&y!==_&&m(d[y],y);_&&!b&&(c+=`	end
`)}m(d[""]??[],"");for(let h in d)!h.includes(":")&&h!==""&&m(d[h],h);return a&&(c+=tw(s??{})),c}function mf(r,e){return p(this,null,function*(){let{backgroundColor:t="white"}=e??{},n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let i=`https://mermaid.ink/img/${n}?bgColor=${t}`,s=yield fetch(i);if(!s.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${s.status}`,`Status text: ${s.statusText}`].join(`
`));return yield s.blob()})}var _v={};ve(_v,{Validator:()=>os,deepCompareStrict:()=>Bt,toJsonSchema:()=>ko,validatesOnlyStrings:()=>cs});var p$=Object.freeze({status:"aborted"});function Gt(r,e,t){function n(o,u){var c;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(c=o._zod).traits??(c.traits=new Set),o._zod.traits.add(r),e(o,u);for(let d in a.prototype)d in o||Object.defineProperty(o,d,{value:a.prototype[d].bind(o)});o._zod.constr=a,o._zod.def=u}let i=t?.Parent??Object;class s extends i{}Object.defineProperty(s,"name",{value:r});function a(o){var u;let c=t?.Parent?new s:this;n(c,o),(u=c._zod).deferred??(u.deferred=[]);for(let d of c._zod.deferred)d();return c}return Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:o=>t?.Parent&&o instanceof t.Parent?!0:o?._zod?.traits?.has(r)}),Object.defineProperty(a,"name",{value:r}),a}var h$=Symbol("zod_brand"),Ft=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},ho={};function Ir(r){return r&&Object.assign(ho,r),ho}var kt={};ve(kt,{BIGINT_FORMAT_RANGES:()=>_w,Class:()=>mo,NUMBER_FORMAT_RANGES:()=>gw,aborted:()=>pn,allowsEval:()=>yf,assert:()=>aw,assertEqual:()=>rw,assertIs:()=>iw,assertNever:()=>sw,assertNotEqual:()=>nw,assignProp:()=>bo,cached:()=>_o,captureStackTrace:()=>ts,cleanEnum:()=>Ow,cleanRegex:()=>yo,clone:()=>ze,createTransparentProxy:()=>mw,defineLazy:()=>es,esc:()=>_f,escapeRegex:()=>vf,extend:()=>ww,finalizeIssue:()=>ar,floatSafeRemainder:()=>cw,getElementAtPath:()=>lw,getEnumValues:()=>Qi,getLengthableOrigin:()=>Tw,getParsedType:()=>hw,getSizableOrigin:()=>Sw,isObject:()=>Xi,isPlainObject:()=>wo,issue:()=>Tf,joinValues:()=>ow,jsonStringifyReplacer:()=>go,merge:()=>vw,normalizeParams:()=>vo,nullish:()=>uw,numKeys:()=>pw,omit:()=>bw,optionalKeys:()=>Ef,partial:()=>xw,pick:()=>yw,prefixIssues:()=>Sf,primitiveTypes:()=>wf,promiseAllObject:()=>dw,propertyKeyTypes:()=>bf,randomString:()=>fw,required:()=>Ew,stringifyPrimitive:()=>xf,unwrapMessage:()=>fn});function rw(r){return r}function nw(r){return r}function iw(r){}function sw(r){throw new Error}function aw(r){}function Qi(r){let e=Object.values(r).filter(n=>typeof n=="number");return Object.entries(r).filter(([n,i])=>e.indexOf(+n)===-1).map(([n,i])=>i)}function ow(r,e="|"){return r.map(t=>xf(t)).join(e)}function go(r,e){return typeof e=="bigint"?e.toString():e}function _o(r){return{get value(){{let t=r();return Object.defineProperty(this,"value",{value:t}),t}throw new Error("cached value already set")}}}function uw(r){return r==null}function yo(r){let e=r.startsWith("^")?1:0,t=r.endsWith("$")?r.length-1:r.length;return r.slice(e,t)}function cw(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=t>n?t:n,s=Number.parseInt(r.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}function es(r,e,t){Object.defineProperty(r,e,{get(){{let i=t();return r[e]=i,i}throw new Error("cached value already set")},set(i){Object.defineProperty(r,e,{value:i})},configurable:!0})}function bo(r,e,t){Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0})}function lw(r,e){return e?e.reduce((t,n)=>t?.[n],r):r}function dw(r){let e=Object.keys(r),t=e.map(n=>r[n]);return Promise.all(t).then(n=>{let i={};for(let s=0;s<e.length;s++)i[e[s]]=n[s];return i})}function fw(r=10){let e="abcdefghijklmnopqrstuvwxyz",t="";for(let n=0;n<r;n++)t+=e[Math.floor(Math.random()*e.length)];return t}function _f(r){return JSON.stringify(r)}var ts=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};function Xi(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}var yf=_o(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let r=Function;return new r(""),!0}catch{return!1}});function wo(r){if(Xi(r)===!1)return!1;let e=r.constructor;if(e===void 0)return!0;let t=e.prototype;return!(Xi(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}function pw(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}var hw=r=>{let e=typeof r;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(r)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(r)?"array":r===null?"null":r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?"promise":typeof Map<"u"&&r instanceof Map?"map":typeof Set<"u"&&r instanceof Set?"set":typeof Date<"u"&&r instanceof Date?"date":typeof File<"u"&&r instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},bf=new Set(["string","number","symbol"]),wf=new Set(["string","number","bigint","boolean","symbol","undefined"]);function vf(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ze(r,e,t){let n=new r._zod.constr(e??r._zod.def);return(!e||t?.parent)&&(n._zod.parent=r),n}function vo(r){let e=r;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?g(l({},e),{error:()=>e.error}):e}function mw(r){let e;return new Proxy({},{get(t,n,i){return e??(e=r()),Reflect.get(e,n,i)},set(t,n,i,s){return e??(e=r()),Reflect.set(e,n,i,s)},has(t,n){return e??(e=r()),Reflect.has(e,n)},deleteProperty(t,n){return e??(e=r()),Reflect.deleteProperty(e,n)},ownKeys(t){return e??(e=r()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(t,n){return e??(e=r()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(t,n,i){return e??(e=r()),Reflect.defineProperty(e,n,i)}})}function xf(r){return typeof r=="bigint"?r.toString()+"n":typeof r=="string"?`"${r}"`:`${r}`}function Ef(r){return Object.keys(r).filter(e=>r[e]._zod.optin==="optional"&&r[e]._zod.optout==="optional")}var gw={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},_w={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function yw(r,e){let t={},n=r._zod.def;for(let i in e){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&(t[i]=n.shape[i])}return ze(r,g(l({},r._zod.def),{shape:t,checks:[]}))}function bw(r,e){let t=l({},r._zod.def.shape),n=r._zod.def;for(let i in e){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&delete t[i]}return ze(r,g(l({},r._zod.def),{shape:t,checks:[]}))}function ww(r,e){if(!wo(e))throw new Error("Invalid input to extend: expected a plain object");let t=g(l({},r._zod.def),{get shape(){let n=l(l({},r._zod.def.shape),e);return bo(this,"shape",n),n},checks:[]});return ze(r,t)}function vw(r,e){return ze(r,g(l({},r._zod.def),{get shape(){let t=l(l({},r._zod.def.shape),e._zod.def.shape);return bo(this,"shape",t),t},catchall:e._zod.def.catchall,checks:[]}))}function xw(r,e,t){let n=e._zod.def.shape,i=l({},n);if(t)for(let s in t){if(!(s in n))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(i[s]=r?new r({type:"optional",innerType:n[s]}):n[s])}else for(let s in n)i[s]=r?new r({type:"optional",innerType:n[s]}):n[s];return ze(e,g(l({},e._zod.def),{shape:i,checks:[]}))}function Ew(r,e,t){let n=e._zod.def.shape,i=l({},n);if(t)for(let s in t){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(i[s]=new r({type:"nonoptional",innerType:n[s]}))}else for(let s in n)i[s]=new r({type:"nonoptional",innerType:n[s]});return ze(e,g(l({},e._zod.def),{shape:i,checks:[]}))}function pn(r,e=0){for(let t=e;t<r.issues.length;t++)if(r.issues[t]?.continue!==!0)return!0;return!1}function Sf(r,e){return e.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(r),t})}function fn(r){return typeof r=="string"?r:r?.message}function ar(r,e,t){let n=g(l({},r),{path:r.path??[]});if(!r.message){let i=fn(r.inst?._zod.def?.error?.(r))??fn(e?.error?.(r))??fn(t.customError?.(r))??fn(t.localeError?.(r))??"Invalid input";n.message=i}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Sw(r){return r instanceof Set?"set":r instanceof Map?"map":r instanceof File?"file":"unknown"}function Tw(r){return Array.isArray(r)?"array":typeof r=="string"?"string":"unknown"}function Tf(...r){let[e,t,n]=r;return typeof e=="string"?{message:e,code:"custom",input:t,inst:n}:l({},e)}function Ow(r){return Object.entries(r).filter(([e,t])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var mo=class{constructor(...e){}};var Of=(r,e)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:e,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(e,go,2)},enumerable:!0}),Object.defineProperty(r,"toString",{value:()=>r.message,enumerable:!1})},$f=Gt("$ZodError",Of),hn=Gt("$ZodError",Of,{Parent:Error});var Iw=r=>(e,t,n,i)=>{let s=n?Object.assign(n,{async:!1}):{async:!1},a=e._zod.run({value:t,issues:[]},s);if(a instanceof Promise)throw new Ft;if(a.issues.length){let o=new(i?.Err??r)(a.issues.map(u=>ar(u,s,Ir())));throw ts(o,i?.callee),o}return a.value},mn=Iw(hn),Aw=r=>(e,t,n,i)=>p(null,null,function*(){let s=n?Object.assign(n,{async:!0}):{async:!0},a=e._zod.run({value:t,issues:[]},s);if(a instanceof Promise&&(a=yield a),a.issues.length){let o=new(i?.Err??r)(a.issues.map(u=>ar(u,s,Ir())));throw ts(o,i?.callee),o}return a.value}),If=Aw(hn),Pw=r=>(e,t,n)=>{let i=n?g(l({},n),{async:!1}):{async:!1},s=e._zod.run({value:t,issues:[]},i);if(s instanceof Promise)throw new Ft;return s.issues.length?{success:!1,error:new(r??$f)(s.issues.map(a=>ar(a,i,Ir())))}:{success:!0,data:s.value}},Af=Pw(hn),kw=r=>(e,t,n)=>p(null,null,function*(){let i=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:t,issues:[]},i);return s instanceof Promise&&(s=yield s),s.issues.length?{success:!1,error:new r(s.issues.map(a=>ar(a,i,Ir())))}:{success:!0,data:s.value}}),Pf=kw(hn);var kf={major:4,minor:0,patch:0};var xo=Gt("$ZodType",(r,e)=>{var t;r??(r={}),r._zod.def=e,r._zod.bag=r._zod.bag||{},r._zod.version=kf;let n=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&n.unshift(r);for(let i of n)for(let s of i._zod.onattach)s(r);if(n.length===0)(t=r._zod).deferred??(t.deferred=[]),r._zod.deferred?.push(()=>{r._zod.run=r._zod.parse});else{let i=(s,a,o)=>{let u=pn(s),c;for(let d of a){if(d._zod.def.when){if(!d._zod.def.when(s))continue}else if(u)continue;let f=s.issues.length,m=d._zod.check(s);if(m instanceof Promise&&o?.async===!1)throw new Ft;if(c||m instanceof Promise)c=(c??Promise.resolve()).then(()=>p(null,null,function*(){yield m,s.issues.length!==f&&(u||(u=pn(s,f)))}));else{if(s.issues.length===f)continue;u||(u=pn(s,f))}}return c?c.then(()=>s):s};r._zod.run=(s,a)=>{let o=r._zod.parse(s,a);if(o instanceof Promise){if(a.async===!1)throw new Ft;return o.then(u=>i(u,n,a))}return i(o,n,a)}}r["~standard"]={validate:i=>{try{let s=Af(r,i);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return Pf(r,i).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}});var Rf=Gt("$ZodUnknown",(r,e)=>{xo.init(r,e),r._zod.parse=t=>t}),Nf=Gt("$ZodNever",(r,e)=>{xo.init(r,e),r._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:r}),t)});var Cf=Gt("$ZodOptional",(r,e)=>{xo.init(r,e),r._zod.optin="optional",r._zod.optout="optional",es(r._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),es(r._zod,"pattern",()=>{let t=e.innerType._zod.pattern;return t?new RegExp(`^(${yo(t.source)})?$`):void 0}),r._zod.parse=(t,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(t,n):t.value===void 0?t:e.innerType._zod.run(t,n)});var T$=Symbol("ZodOutput"),O$=Symbol("ZodInput"),gn=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){let n=t[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let n=l({},this.get(t)??{});return delete n.id,l(l({},n),this._map.get(e))}return this._map.get(e)}has(e){return this._map.has(e)}};function Rw(){return new gn}var qe=Rw();function jf(r){return new r({type:"unknown"})}function Lf(r,e){return new r(l({type:"never"},vo(e)))}var rs=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??qe,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var n;let i=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},a=this.seen.get(e);if(a)return a.count++,t.schemaPath.includes(e)&&(a.cycle=t.path),a.schema;let o={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,o);let u=e._zod.toJSONSchema?.();if(u)o.schema=u;else{let f=g(l({},t),{schemaPath:[...t.schemaPath,e],path:t.path}),m=e._zod.parent;if(m)o.ref=m,this.process(m,f),this.seen.get(m).isParent=!0;else{let h=o.schema;switch(i.type){case"string":{let _=h;_.type="string";let{minimum:b,maximum:y,format:v,patterns:w,contentEncoding:T}=e._zod.bag;if(typeof b=="number"&&(_.minLength=b),typeof y=="number"&&(_.maxLength=y),v&&(_.format=s[v]??v,_.format===""&&delete _.format),T&&(_.contentEncoding=T),w&&w.size>0){let N=[...w];N.length===1?_.pattern=N[0].source:N.length>1&&(o.schema.allOf=[...N.map(L=>g(l({},this.target==="draft-7"?{type:"string"}:{}),{pattern:L.source}))])}break}case"number":{let _=h,{minimum:b,maximum:y,format:v,multipleOf:w,exclusiveMaximum:T,exclusiveMinimum:N}=e._zod.bag;typeof v=="string"&&v.includes("int")?_.type="integer":_.type="number",typeof N=="number"&&(_.exclusiveMinimum=N),typeof b=="number"&&(_.minimum=b,typeof N=="number"&&(N>=b?delete _.minimum:delete _.exclusiveMinimum)),typeof T=="number"&&(_.exclusiveMaximum=T),typeof y=="number"&&(_.maximum=y,typeof T=="number"&&(T<=y?delete _.maximum:delete _.exclusiveMaximum)),typeof w=="number"&&(_.multipleOf=w);break}case"boolean":{let _=h;_.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{h.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{h.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let _=h,{minimum:b,maximum:y}=e._zod.bag;typeof b=="number"&&(_.minItems=b),typeof y=="number"&&(_.maxItems=y),_.type="array",_.items=this.process(i.element,g(l({},f),{path:[...f.path,"items"]}));break}case"object":{let _=h;_.type="object",_.properties={};let b=i.shape;for(let w in b)_.properties[w]=this.process(b[w],g(l({},f),{path:[...f.path,"properties",w]}));let y=new Set(Object.keys(b)),v=new Set([...y].filter(w=>{let T=i.shape[w]._zod;return this.io==="input"?T.optin===void 0:T.optout===void 0}));v.size>0&&(_.required=Array.from(v)),i.catchall?._zod.def.type==="never"?_.additionalProperties=!1:i.catchall?i.catchall&&(_.additionalProperties=this.process(i.catchall,g(l({},f),{path:[...f.path,"additionalProperties"]}))):this.io==="output"&&(_.additionalProperties=!1);break}case"union":{let _=h;_.anyOf=i.options.map((b,y)=>this.process(b,g(l({},f),{path:[...f.path,"anyOf",y]})));break}case"intersection":{let _=h,b=this.process(i.left,g(l({},f),{path:[...f.path,"allOf",0]})),y=this.process(i.right,g(l({},f),{path:[...f.path,"allOf",1]})),v=T=>"allOf"in T&&Object.keys(T).length===1,w=[...v(b)?b.allOf:[b],...v(y)?y.allOf:[y]];_.allOf=w;break}case"tuple":{let _=h;_.type="array";let b=i.items.map((w,T)=>this.process(w,g(l({},f),{path:[...f.path,"prefixItems",T]})));if(this.target==="draft-2020-12"?_.prefixItems=b:_.items=b,i.rest){let w=this.process(i.rest,g(l({},f),{path:[...f.path,"items"]}));this.target==="draft-2020-12"?_.items=w:_.additionalItems=w}i.rest&&(_.items=this.process(i.rest,g(l({},f),{path:[...f.path,"items"]})));let{minimum:y,maximum:v}=e._zod.bag;typeof y=="number"&&(_.minItems=y),typeof v=="number"&&(_.maxItems=v);break}case"record":{let _=h;_.type="object",_.propertyNames=this.process(i.keyType,g(l({},f),{path:[...f.path,"propertyNames"]})),_.additionalProperties=this.process(i.valueType,g(l({},f),{path:[...f.path,"additionalProperties"]}));break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let _=h,b=Qi(i.entries);b.every(y=>typeof y=="number")&&(_.type="number"),b.every(y=>typeof y=="string")&&(_.type="string"),_.enum=b;break}case"literal":{let _=h,b=[];for(let y of i.values)if(y===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof y=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");b.push(Number(y))}else b.push(y);if(b.length!==0)if(b.length===1){let y=b[0];_.type=y===null?"null":typeof y,_.const=y}else b.every(y=>typeof y=="number")&&(_.type="number"),b.every(y=>typeof y=="string")&&(_.type="string"),b.every(y=>typeof y=="boolean")&&(_.type="string"),b.every(y=>y===null)&&(_.type="null"),_.enum=b;break}case"file":{let _=h,b={type:"string",format:"binary",contentEncoding:"binary"},{minimum:y,maximum:v,mime:w}=e._zod.bag;y!==void 0&&(b.minLength=y),v!==void 0&&(b.maxLength=v),w?w.length===1?(b.contentMediaType=w[0],Object.assign(_,b)):_.anyOf=w.map(T=>g(l({},b),{contentMediaType:T})):Object.assign(_,b);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let _=this.process(i.innerType,f);h.anyOf=[_,{type:"null"}];break}case"nonoptional":{this.process(i.innerType,f),o.ref=i.innerType;break}case"success":{let _=h;_.type="boolean";break}case"default":{this.process(i.innerType,f),o.ref=i.innerType,h.default=JSON.parse(JSON.stringify(i.defaultValue));break}case"prefault":{this.process(i.innerType,f),o.ref=i.innerType,this.io==="input"&&(h._prefault=JSON.parse(JSON.stringify(i.defaultValue)));break}case"catch":{this.process(i.innerType,f),o.ref=i.innerType;let _;try{_=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}h.default=_;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let _=h,b=e._zod.pattern;if(!b)throw new Error("Pattern not found in template literal");_.type="string",_.pattern=b.source;break}case"pipe":{let _=this.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;this.process(_,f),o.ref=_;break}case"readonly":{this.process(i.innerType,f),o.ref=i.innerType,h.readOnly=!0;break}case"promise":{this.process(i.innerType,f),o.ref=i.innerType;break}case"optional":{this.process(i.innerType,f),o.ref=i.innerType;break}case"lazy":{let _=e._zod.innerType;this.process(_,f),o.ref=_;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let c=this.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),this.io==="input"&&pe(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((n=o.schema).default??(n.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){let n={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},i=this.seen.get(e);if(!i)throw new Error("Unprocessed schema. This is a bug in Zod.");let s=d=>{let f=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let b=n.external.registry.get(d[0])?.id,y=n.external.uri??(w=>w);if(b)return{ref:y(b)};let v=d[1].defId??d[1].schema.id??`schema${this.counter++}`;return d[1].defId=v,{defId:v,ref:`${y("__shared")}#/${f}/${v}`}}if(d[1]===i)return{ref:"#"};let h=`#/${f}/`,_=d[1].schema.id??`__schema${this.counter++}`;return{defId:_,ref:h+_}},a=d=>{if(d[1].schema.$ref)return;let f=d[1],{ref:m,defId:h}=s(d);f.def=l({},f.schema),h&&(f.defId=h);let _=f.schema;for(let b in _)delete _[b];_.$ref=m};if(n.cycles==="throw")for(let d of this.seen.entries()){let f=d[1];if(f.cycle)throw new Error(`Cycle detected: #/${f.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let d of this.seen.entries()){let f=d[1];if(e===d[0]){a(d);continue}if(n.external){let h=n.external.registry.get(d[0])?.id;if(e!==d[0]&&h){a(d);continue}}if(this.metadataRegistry.get(d[0])?.id){a(d);continue}if(f.cycle){a(d);continue}if(f.count>1&&n.reused==="ref"){a(d);continue}}let o=(d,f)=>{let m=this.seen.get(d),h=m.def??m.schema,_=l({},h);if(m.ref===null)return;let b=m.ref;if(m.ref=null,b){o(b,f);let y=this.seen.get(b).schema;y.$ref&&f.target==="draft-7"?(h.allOf=h.allOf??[],h.allOf.push(y)):(Object.assign(h,y),Object.assign(h,_))}m.isParent||this.override({zodSchema:d,jsonSchema:h,path:m.path??[]})};for(let d of[...this.seen.entries()].reverse())o(d[0],{target:this.target});let u={};if(this.target==="draft-2020-12"?u.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?u.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let d=n.external.registry.get(e)?.id;if(!d)throw new Error("Schema is missing an `id` property");u.$id=n.external.uri(d)}Object.assign(u,i.def);let c=n.external?.defs??{};for(let d of this.seen.entries()){let f=d[1];f.def&&f.defId&&(c[f.defId]=f.def)}n.external||Object.keys(c).length>0&&(this.target==="draft-2020-12"?u.$defs=c:u.definitions=c);try{return JSON.parse(JSON.stringify(u))}catch{throw new Error("Error converting schema to JSON.")}}};function Eo(r,e){if(r instanceof gn){let n=new rs(e),i={};for(let o of r._idmap.entries()){let[u,c]=o;n.process(c)}let s={},a={registry:r,uri:e?.uri,defs:i};for(let o of r._idmap.entries()){let[u,c]=o;s[u]=n.emit(c,g(l({},e),{external:a}))}if(Object.keys(i).length>0){let o=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[o]:i}}return{schemas:s}}let t=new rs(e);return t.process(r),t.emit(r,e)}function pe(r,e){let t=e??{seen:new Set};if(t.seen.has(r))return!1;t.seen.add(r);let i=r._zod.def;switch(i.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return pe(i.element,t);case"object":{for(let s in i.shape)if(pe(i.shape[s],t))return!0;return!1}case"union":{for(let s of i.options)if(pe(s,t))return!0;return!1}case"intersection":return pe(i.left,t)||pe(i.right,t);case"tuple":{for(let s of i.items)if(pe(s,t))return!0;return!!(i.rest&&pe(i.rest,t))}case"record":return pe(i.keyType,t)||pe(i.valueType,t);case"map":return pe(i.keyType,t)||pe(i.valueType,t);case"set":return pe(i.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return pe(i.innerType,t);case"lazy":return pe(i.getter(),t);case"default":return pe(i.innerType,t);case"prefault":return pe(i.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return pe(i.in,t)||pe(i.out,t);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${i.type}`)}var Mf=Symbol("Let zodToJsonSchema decide on which parser to use");var zf={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Df=r=>typeof r=="string"?g(l({},zf),{name:r}):l(l({},zf),r);var Uf=r=>{let e=Df(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return g(l({},e),{flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))})};function So(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage=g(l({},r.errorMessage),{[e]:t}))}function re(r,e,t,n,i){r[e]=t,So(r,e,n,i)}var ns=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")};function oe(r){if(r.target!=="openAi")return{};let e=[...r.basePath,r.definitionPath,r.openAiAnyTypeName];return r.flags.hasReferencedOpenAiAnyType=!0,{$ref:r.$refStrategy==="relative"?ns(e,r.currentPath):e.join("/")}}function Zf(r,e){let t={type:"array"};return r.type?._def&&r.type?._def?.typeName!==S.ZodAny&&(t.items=U(r.type._def,g(l({},e),{currentPath:[...e.currentPath,"items"]}))),r.minLength&&re(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&re(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(re(t,"minItems",r.exactLength.value,r.exactLength.message,e),re(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function Ff(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?re(t,"minimum",n.value,n.message,e):re(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),re(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?re(t,"maximum",n.value,n.message,e):re(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),re(t,"maximum",n.value,n.message,e));break;case"multipleOf":re(t,"multipleOf",n.value,n.message,e);break}return t}function Gf(){return{type:"boolean"}}function is(r,e){return U(r.type._def,e)}var Bf=(r,e)=>U(r.innerType._def,e);function To(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((i,s)=>To(r,e,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Nw(r,e)}}var Nw=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":re(t,"minimum",n.value,n.message,e);break;case"max":re(t,"maximum",n.value,n.message,e);break}return t};function qf(r,e){return g(l({},U(r.innerType._def,e)),{default:r.defaultValue()})}function Vf(r,e){return e.effectStrategy==="input"?U(r.schema._def,e):oe(e)}function Hf(r){return{type:"string",enum:Array.from(r.values)}}var Cw=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function Jf(r,e){let t=[U(r.left._def,g(l({},e),{currentPath:[...e.currentPath,"allOf","0"]})),U(r.right._def,g(l({},e),{currentPath:[...e.currentPath,"allOf","1"]}))].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,i=[];return t.forEach(s=>{if(Cw(s))i.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let o=s;if("additionalProperties"in s&&s.additionalProperties===!1){let a=s,{additionalProperties:u}=a;o=ae(a,["additionalProperties"])}else n=void 0;i.push(o)}}),i.length?l({allOf:i},n):void 0}function Wf(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var Oo,ct={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Oo===void 0&&(Oo=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Oo),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function ss(r,e){let t={type:"string"};if(r.checks)for(let n of r.checks)switch(n.kind){case"min":re(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":re(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":lt(t,"email",n.message,e);break;case"format:idn-email":lt(t,"idn-email",n.message,e);break;case"pattern:zod":Me(t,ct.email,n.message,e);break}break;case"url":lt(t,"uri",n.message,e);break;case"uuid":lt(t,"uuid",n.message,e);break;case"regex":Me(t,n.regex,n.message,e);break;case"cuid":Me(t,ct.cuid,n.message,e);break;case"cuid2":Me(t,ct.cuid2,n.message,e);break;case"startsWith":Me(t,RegExp(`^${$o(n.value,e)}`),n.message,e);break;case"endsWith":Me(t,RegExp(`${$o(n.value,e)}$`),n.message,e);break;case"datetime":lt(t,"date-time",n.message,e);break;case"date":lt(t,"date",n.message,e);break;case"time":lt(t,"time",n.message,e);break;case"duration":lt(t,"duration",n.message,e);break;case"length":re(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),re(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{Me(t,RegExp($o(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&lt(t,"ipv4",n.message,e),n.version!=="v4"&&lt(t,"ipv6",n.message,e);break}case"base64url":Me(t,ct.base64url,n.message,e);break;case"jwt":Me(t,ct.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Me(t,ct.ipv4Cidr,n.message,e),n.version!=="v4"&&Me(t,ct.ipv6Cidr,n.message,e);break}case"emoji":Me(t,ct.emoji(),n.message,e);break;case"ulid":{Me(t,ct.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{lt(t,"binary",n.message,e);break}case"contentEncoding:base64":{re(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Me(t,ct.base64,n.message,e);break}}break}case"nanoid":Me(t,ct.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function $o(r,e){return e.patternStrategy==="escape"?Lw(r):r}var jw=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Lw(r){let e="";for(let t=0;t<r.length;t++)jw.has(r[t])||(e+="\\"),e+=r[t];return e}function lt(r,e,t,n){r.format||r.anyOf?.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push(l({format:r.format},r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}})),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push(l({format:e},t&&n.errorMessages&&{errorMessage:{format:t}}))):re(r,"format",e,t,n)}function Me(r,e,t,n){r.pattern||r.allOf?.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push(l({pattern:r.pattern},r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}})),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push(l({pattern:Kf(e,n)},t&&n.errorMessages&&{errorMessage:{pattern:t}}))):re(r,"pattern",Kf(e,n),t,n)}function Kf(r,e){if(!e.applyRegexFlags||!r.flags)return r.source;let t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source,i="",s=!1,a=!1,o=!1;for(let u=0;u<n.length;u++){if(s){i+=n[u],s=!1;continue}if(t.i){if(a){if(n[u].match(/[a-z]/)){o?(i+=n[u],i+=`${n[u-2]}-${n[u]}`.toUpperCase(),o=!1):n[u+1]==="-"&&n[u+2]?.match(/[a-z]/)?(i+=n[u],o=!0):i+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){i+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(t.m){if(n[u]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){i+=`($|(?=[\r
]))`;continue}}if(t.s&&n[u]==="."){i+=a?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}i+=n[u],n[u]==="\\"?s=!0:a&&n[u]==="]"?a=!1:!a&&n[u]==="["&&(a=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return i}function as(r,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&r.keyType?._def.typeName===S.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((s,a)=>g(l({},s),{[a]:U(r.valueType._def,g(l({},e),{currentPath:[...e.currentPath,"properties",a]}))??oe(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:U(r.valueType._def,g(l({},e),{currentPath:[...e.currentPath,"additionalProperties"]}))??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===S.ZodString&&r.keyType._def.checks?.length){let n=ss(r.keyType._def,e),{type:s}=n,a=ae(n,["type"]);return g(l({},t),{propertyNames:a})}else{if(r.keyType?._def.typeName===S.ZodEnum)return g(l({},t),{propertyNames:{enum:r.keyType._def.values}});if(r.keyType?._def.typeName===S.ZodBranded&&r.keyType._def.type._def.typeName===S.ZodString&&r.keyType._def.type._def.checks?.length){let i=is(r.keyType._def,e),{type:s}=i,a=ae(i,["type"]);return g(l({},t),{propertyNames:a})}}return t}function Yf(r,e){if(e.mapStrategy==="record")return as(r,e);let t=U(r.keyType._def,g(l({},e),{currentPath:[...e.currentPath,"items","items","0"]}))||oe(e),n=U(r.valueType._def,g(l({},e),{currentPath:[...e.currentPath,"items","items","1"]}))||oe(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function Xf(r){let e=r.values,n=Object.keys(r.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),i=Array.from(new Set(n.map(s=>typeof s)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:n}}function Qf(r){return r.target==="openAi"?void 0:{not:oe(g(l({},r),{currentPath:[...r.currentPath,"not"]}))}}function ep(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var _n={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function rp(r,e){if(e.target==="openApi3")return tp(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in _n&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((i,s)=>{let a=_n[s._def.typeName];return a&&!i.includes(a)?[...i,a]:i},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((i,s)=>{let a=typeof s._def.value;switch(a){case"string":case"number":case"boolean":return[...i,a];case"bigint":return[...i,"integer"];case"object":if(s._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(n.length===t.length){let i=n.filter((s,a,o)=>o.indexOf(s)===a);return{type:i.length>1?i:i[0],enum:t.reduce((s,a)=>s.includes(a._def.value)?s:[...s,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,i)=>[...n,...i._def.values.filter(s=>!n.includes(s))],[])};return tp(r,e)}var tp=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,i)=>U(n._def,g(l({},e),{currentPath:[...e.currentPath,"anyOf",`${i}`]}))).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function np(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:_n[r.innerType._def.typeName],nullable:!0}:{type:[_n[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=U(r.innerType._def,g(l({},e),{currentPath:[...e.currentPath]}));return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&g(l({},n),{nullable:!0})}let t=U(r.innerType._def,g(l({},e),{currentPath:[...e.currentPath,"anyOf","0"]}));return t&&{anyOf:[t,{type:"null"}]}}function ip(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",So(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?re(t,"minimum",n.value,n.message,e):re(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),re(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?re(t,"maximum",n.value,n.message,e):re(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),re(t,"maximum",n.value,n.message,e));break;case"multipleOf":re(t,"multipleOf",n.value,n.message,e);break}return t}function sp(r,e){let t=e.target==="openAi",n={type:"object",properties:{}},i=[],s=r.shape();for(let o in s){let u=s[o];if(u===void 0||u._def===void 0)continue;let c=Mw(u);c&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=!1);let d=U(u._def,g(l({},e),{currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]}));d!==void 0&&(n.properties[o]=d,c||i.push(o))}i.length&&(n.required=i);let a=zw(r,e);return a!==void 0&&(n.additionalProperties=a),n}function zw(r,e){if(r.catchall._def.typeName!=="ZodNever")return U(r.catchall._def,g(l({},e),{currentPath:[...e.currentPath,"additionalProperties"]}));switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Mw(r){try{return r.isOptional()}catch{return!0}}var ap=(r,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return U(r.innerType._def,e);let t=U(r.innerType._def,g(l({},e),{currentPath:[...e.currentPath,"anyOf","1"]}));return t?{anyOf:[{not:oe(e)},t]}:oe(e)};var op=(r,e)=>{if(e.pipeStrategy==="input")return U(r.in._def,e);if(e.pipeStrategy==="output")return U(r.out._def,e);let t=U(r.in._def,g(l({},e),{currentPath:[...e.currentPath,"allOf","0"]})),n=U(r.out._def,g(l({},e),{currentPath:[...e.currentPath,"allOf",t?"1":"0"]}));return{allOf:[t,n].filter(i=>i!==void 0)}};function up(r,e){return U(r.type._def,e)}function cp(r,e){let n={type:"array",uniqueItems:!0,items:U(r.valueType._def,g(l({},e),{currentPath:[...e.currentPath,"items"]}))};return r.minSize&&re(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&re(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function lp(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>U(t._def,g(l({},e),{currentPath:[...e.currentPath,"items",`${n}`]}))).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:U(r.rest._def,g(l({},e),{currentPath:[...e.currentPath,"additionalItems"]}))}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>U(t._def,g(l({},e),{currentPath:[...e.currentPath,"items",`${n}`]}))).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function dp(r){return{not:oe(r)}}function fp(r){return oe(r)}var pp=(r,e)=>U(r.innerType._def,e);var hp=(r,e,t)=>{switch(e){case S.ZodString:return ss(r,t);case S.ZodNumber:return ip(r,t);case S.ZodObject:return sp(r,t);case S.ZodBigInt:return Ff(r,t);case S.ZodBoolean:return Gf();case S.ZodDate:return To(r,t);case S.ZodUndefined:return dp(t);case S.ZodNull:return ep(t);case S.ZodArray:return Zf(r,t);case S.ZodUnion:case S.ZodDiscriminatedUnion:return rp(r,t);case S.ZodIntersection:return Jf(r,t);case S.ZodTuple:return lp(r,t);case S.ZodRecord:return as(r,t);case S.ZodLiteral:return Wf(r,t);case S.ZodEnum:return Hf(r);case S.ZodNativeEnum:return Xf(r);case S.ZodNullable:return np(r,t);case S.ZodOptional:return ap(r,t);case S.ZodMap:return Yf(r,t);case S.ZodSet:return cp(r,t);case S.ZodLazy:return()=>r.getter()._def;case S.ZodPromise:return up(r,t);case S.ZodNaN:case S.ZodNever:return Qf(t);case S.ZodEffects:return Vf(r,t);case S.ZodAny:return oe(t);case S.ZodUnknown:return fp(t);case S.ZodDefault:return qf(r,t);case S.ZodBranded:return is(r,t);case S.ZodReadonly:return pp(r,t);case S.ZodCatch:return Bf(r,t);case S.ZodPipeline:return op(r,t);case S.ZodFunction:case S.ZodVoid:case S.ZodSymbol:return;default:return(n=>{})(e)}};function U(r,e,t=!1){let n=e.seen.get(r);if(e.override){let o=e.override?.(r,e,n,t);if(o!==Mf)return o}if(n&&!t){let o=Dw(n,e);if(o!==void 0)return o}let i={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,i);let s=hp(r,r.typeName,e),a=typeof s=="function"?U(s(),e):s;if(a&&Uw(r,e,a),e.postProcess){let o=e.postProcess(a,r,e);return i.jsonSchema=a,o}return i.jsonSchema=a,a}var Dw=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:ns(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),oe(e)):e.$refStrategy==="seen"?oe(e):void 0}},Uw=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var Io=(r,e)=>{let t=Uf(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,d])=>g(l({},u),{[c]:U(d._def,g(l({},t),{currentPath:[...t.basePath,t.definitionPath,c]}),!0)??oe(t)}),{}):void 0,i=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=U(r._def,i===void 0?t:g(l({},t),{currentPath:[...t.basePath,t.definitionPath,i]}),!1)??oe(t),a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a),t.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[t.openAiAnyTypeName]||(n[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let o=i===void 0?n?g(l({},s),{[t.definitionPath]:n}):s:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,i].join("/"),[t.definitionPath]:g(l({},n),{[i]:s})};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function Bt(r,e){let t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;let n=r.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(!Bt(r[i],e[i]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;let n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(let a of n)if(!Bt(r[a],e[a]))return!1;return!0}return r===e}function Je(r){return encodeURI(Zw(r))}function Zw(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}var Fw={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},Gw={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},Bw={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},qw=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function dt(r,e=Object.create(null),t=qw,n=""){if(r&&typeof r=="object"&&!Array.isArray(r)){let s=r.$id||r.id;if(s){let a=new URL(s,t.href);a.hash.length>1?e[a.href]=r:(a.hash="",n===""?t=a:dt(r,e,t))}}else if(r!==!0&&r!==!1)return e;let i=t.href+(n?"#"+n:"");if(e[i]!==void 0)throw new Error(`Duplicate schema URI "${i}".`);if(e[i]=r,r===!0||r===!1)return e;if(r.__absolute_uri__===void 0&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:i}),r.$ref&&r.__absolute_ref__===void 0){let s=new URL(r.$ref,t.href);s.hash=s.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:s.href})}if(r.$recursiveRef&&r.__absolute_recursive_ref__===void 0){let s=new URL(r.$recursiveRef,t.href);s.hash=s.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:s.href})}if(r.$anchor){let s=new URL("#"+r.$anchor,t.href);e[s.href]=r}for(let s in r){if(Bw[s])continue;let a=`${n}/${Je(s)}`,o=r[s];if(Array.isArray(o)){if(Fw[s]){let u=o.length;for(let c=0;c<u;c++)dt(o[c],e,t,`${a}/${c}`)}}else if(Gw[s])for(let u in o)dt(o[u],e,t,`${a}/${Je(u)}`);else dt(o,e,t,a)}return e}var Vw=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Hw=[0,31,28,31,30,31,30,31,31,30,31,30,31],Jw=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,Ww=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Kw=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,Yw=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Xw=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,Qw=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,ev=/^(?:\/(?:[^~/]|~0|~1)*)*$/,tv=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,rv=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,nv=r=>{if(r[0]==='"')return!1;let[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(i=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(i))},iv=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,sv=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,av=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function vt(r){return r.test.bind(r)}var Ao={date:mp,time:gp.bind(void 0,!1),"date-time":cv,duration:av,uri:fv,"uri-reference":vt(Kw),"uri-template":vt(Yw),url:vt(Xw),email:nv,hostname:vt(Ww),ipv4:vt(iv),ipv6:vt(sv),regex:hv,uuid:vt(Qw),"json-pointer":vt(ev),"json-pointer-uri-fragment":vt(tv),"relative-json-pointer":vt(rv)};function ov(r){return r%4===0&&(r%100!==0||r%400===0)}function mp(r){let e=r.match(Vw);if(!e)return!1;let t=+e[1],n=+e[2],i=+e[3];return n>=1&&n<=12&&i>=1&&i<=(n==2&&ov(t)?29:Hw[n])}function gp(r,e){let t=e.match(Jw);if(!t)return!1;let n=+t[1],i=+t[2],s=+t[3],a=!!t[5];return(n<=23&&i<=59&&s<=59||n==23&&i==59&&s==60)&&(!r||a)}var uv=/t|\s/i;function cv(r){let e=r.split(uv);return e.length==2&&mp(e[0])&&gp(!0,e[1])}var lv=/\/|:/,dv=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function fv(r){return lv.test(r)&&dv.test(r)}var pv=/[^\\]\\Z/;function hv(r){if(pv.test(r))return!1;try{return new RegExp(r,"u"),!0}catch{return!1}}function _p(r){let e=0,t=r.length,n=0,i;for(;n<t;)e++,i=r.charCodeAt(n++),i>=55296&&i<=56319&&n<t&&(i=r.charCodeAt(n),(i&64512)==56320&&n++);return e}function ue(r,e,t="2019-09",n=dt(e),i=!0,s=null,a="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};let c=typeof r,d;switch(c){case"boolean":case"number":case"string":d=c;break;case"object":r===null?d="null":Array.isArray(r)?d="array":d="object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}let{$ref:f,$recursiveRef:m,$recursiveAnchor:h,type:_,const:b,enum:y,required:v,not:w,anyOf:T,allOf:N,oneOf:L,if:Z,then:Q,else:ee,format:ne,properties:me,patternProperties:ft,additionalProperties:we,unevaluatedProperties:Et,minProperties:Cr,maxProperties:jr,propertyNames:Go,dependentRequired:bs,dependentSchemas:ws,dependencies:vs,prefixItems:xs,items:Lr,additionalItems:Bo,unevaluatedItems:qo,contains:Vo,minContains:St,maxContains:vn,minItems:Es,maxItems:Ss,uniqueItems:Lp,minimum:qt,maximum:Vt,exclusiveMinimum:zr,exclusiveMaximum:Mr,multipleOf:xn,minLength:En,maxLength:Sn,pattern:Ho,__absolute_ref__:Tn,__absolute_recursive_ref__:zp}=e,k=[];if(h===!0&&s===null&&(s=e),m==="#"){let F=s===null?n[zp]:s,M=`${o}/$recursiveRef`,q=ue(r,s===null?e:s,t,n,i,F,a,M,u);q.valid||k.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:M,error:"A subschema had errors."},...q.errors)}if(f!==void 0){let M=n[Tn||f];if(M===void 0){let $=`Unresolved $ref "${f}".`;throw Tn&&Tn!==f&&($+=`  Absolute URI "${Tn}".`),$+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error($)}let q=`${o}/$ref`,R=ue(r,M,t,n,i,s,a,q,u);if(R.valid||k.push({instanceLocation:a,keyword:"$ref",keywordLocation:q,error:"A subschema had errors."},...R.errors),t==="4"||t==="7")return{valid:k.length===0,errors:k}}if(Array.isArray(_)){let F=_.length,M=!1;for(let q=0;q<F;q++)if(d===_[q]||_[q]==="integer"&&d==="number"&&r%1===0&&r===r){M=!0;break}M||k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${_.join('", "')}".`})}else _==="integer"?(d!=="number"||r%1||r!==r)&&k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${_}".`}):_!==void 0&&d!==_&&k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${_}".`});if(b!==void 0&&(d==="object"||d==="array"?Bt(r,b)||k.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(b)}.`}):r!==b&&k.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(b)}.`})),y!==void 0&&(d==="object"||d==="array"?y.some(F=>Bt(r,F))||k.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(y)}.`}):y.some(F=>r===F)||k.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(y)}.`})),w!==void 0){let F=`${o}/not`;ue(r,w,t,n,i,s,a,F).valid&&k.push({instanceLocation:a,keyword:"not",keywordLocation:F,error:'Instance matched "not" schema.'})}let On=[];if(T!==void 0){let F=`${o}/anyOf`,M=k.length,q=!1;for(let R=0;R<T.length;R++){let $=T[R],B=Object.create(u),G=ue(r,$,t,n,i,h===!0?s:null,a,`${F}/${R}`,B);k.push(...G.errors),q=q||G.valid,G.valid&&On.push(B)}q?k.length=M:k.splice(M,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:F,error:"Instance does not match any subschemas."})}if(N!==void 0){let F=`${o}/allOf`,M=k.length,q=!0;for(let R=0;R<N.length;R++){let $=N[R],B=Object.create(u),G=ue(r,$,t,n,i,h===!0?s:null,a,`${F}/${R}`,B);k.push(...G.errors),q=q&&G.valid,G.valid&&On.push(B)}q?k.length=M:k.splice(M,0,{instanceLocation:a,keyword:"allOf",keywordLocation:F,error:"Instance does not match every subschema."})}if(L!==void 0){let F=`${o}/oneOf`,M=k.length,q=L.filter((R,$)=>{let B=Object.create(u),G=ue(r,R,t,n,i,h===!0?s:null,a,`${F}/${$}`,B);return k.push(...G.errors),G.valid&&On.push(B),G.valid}).length;q===1?k.length=M:k.splice(M,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:F,error:`Instance does not match exactly one subschema (${q} matches).`})}if((d==="object"||d==="array")&&Object.assign(u,...On),Z!==void 0){let F=`${o}/if`;if(ue(r,Z,t,n,i,s,a,F,u).valid){if(Q!==void 0){let q=ue(r,Q,t,n,i,s,a,`${o}/then`,u);q.valid||k.push({instanceLocation:a,keyword:"if",keywordLocation:F,error:'Instance does not match "then" schema.'},...q.errors)}}else if(ee!==void 0){let q=ue(r,ee,t,n,i,s,a,`${o}/else`,u);q.valid||k.push({instanceLocation:a,keyword:"if",keywordLocation:F,error:'Instance does not match "else" schema.'},...q.errors)}}if(d==="object"){if(v!==void 0)for(let R of v)R in r||k.push({instanceLocation:a,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${R}".`});let F=Object.keys(r);if(Cr!==void 0&&F.length<Cr&&k.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${Cr} properties.`}),jr!==void 0&&F.length>jr&&k.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${jr} properties.`}),Go!==void 0){let R=`${o}/propertyNames`;for(let $ in r){let B=`${a}/${Je($)}`,G=ue($,Go,t,n,i,s,B,R);G.valid||k.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:R,error:`Property name "${$}" does not match schema.`},...G.errors)}}if(bs!==void 0){let R=`${o}/dependantRequired`;for(let $ in bs)if($ in r){let B=bs[$];for(let G of B)G in r||k.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:R,error:`Instance has "${$}" but does not have "${G}".`})}}if(ws!==void 0)for(let R in ws){let $=`${o}/dependentSchemas`;if(R in r){let B=ue(r,ws[R],t,n,i,s,a,`${$}/${Je(R)}`,u);B.valid||k.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:$,error:`Instance has "${R}" but does not match dependant schema.`},...B.errors)}}if(vs!==void 0){let R=`${o}/dependencies`;for(let $ in vs)if($ in r){let B=vs[$];if(Array.isArray(B))for(let G of B)G in r||k.push({instanceLocation:a,keyword:"dependencies",keywordLocation:R,error:`Instance has "${$}" but does not have "${G}".`});else{let G=ue(r,B,t,n,i,s,a,`${R}/${Je($)}`);G.valid||k.push({instanceLocation:a,keyword:"dependencies",keywordLocation:R,error:`Instance has "${$}" but does not match dependant schema.`},...G.errors)}}}let M=Object.create(null),q=!1;if(me!==void 0){let R=`${o}/properties`;for(let $ in me){if(!($ in r))continue;let B=`${a}/${Je($)}`,G=ue(r[$],me[$],t,n,i,s,B,`${R}/${Je($)}`);if(G.valid)u[$]=M[$]=!0;else if(q=i,k.push({instanceLocation:a,keyword:"properties",keywordLocation:R,error:`Property "${$}" does not match schema.`},...G.errors),q)break}}if(!q&&ft!==void 0){let R=`${o}/patternProperties`;for(let $ in ft){let B=new RegExp($,"u"),G=ft[$];for(let Ue in r){if(!B.test(Ue))continue;let Jo=`${a}/${Je(Ue)}`,Wo=ue(r[Ue],G,t,n,i,s,Jo,`${R}/${Je($)}`);Wo.valid?u[Ue]=M[Ue]=!0:(q=i,k.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:R,error:`Property "${Ue}" matches pattern "${$}" but does not match associated schema.`},...Wo.errors))}}}if(!q&&we!==void 0){let R=`${o}/additionalProperties`;for(let $ in r){if(M[$])continue;let B=`${a}/${Je($)}`,G=ue(r[$],we,t,n,i,s,B,R);G.valid?u[$]=!0:(q=i,k.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:R,error:`Property "${$}" does not match additional properties schema.`},...G.errors))}}else if(!q&&Et!==void 0){let R=`${o}/unevaluatedProperties`;for(let $ in r)if(!u[$]){let B=`${a}/${Je($)}`,G=ue(r[$],Et,t,n,i,s,B,R);G.valid?u[$]=!0:k.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:R,error:`Property "${$}" does not match unevaluated properties schema.`},...G.errors)}}}else if(d==="array"){Ss!==void 0&&r.length>Ss&&k.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${r.length} > ${Ss}).`}),Es!==void 0&&r.length<Es&&k.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${r.length} < ${Es}).`});let F=r.length,M=0,q=!1;if(xs!==void 0){let R=`${o}/prefixItems`,$=Math.min(xs.length,F);for(;M<$;M++){let B=ue(r[M],xs[M],t,n,i,s,`${a}/${M}`,`${R}/${M}`);if(u[M]=!0,!B.valid&&(q=i,k.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:R,error:"Items did not match schema."},...B.errors),q))break}}if(Lr!==void 0){let R=`${o}/items`;if(Array.isArray(Lr)){let $=Math.min(Lr.length,F);for(;M<$;M++){let B=ue(r[M],Lr[M],t,n,i,s,`${a}/${M}`,`${R}/${M}`);if(u[M]=!0,!B.valid&&(q=i,k.push({instanceLocation:a,keyword:"items",keywordLocation:R,error:"Items did not match schema."},...B.errors),q))break}}else for(;M<F;M++){let $=ue(r[M],Lr,t,n,i,s,`${a}/${M}`,R);if(u[M]=!0,!$.valid&&(q=i,k.push({instanceLocation:a,keyword:"items",keywordLocation:R,error:"Items did not match schema."},...$.errors),q))break}if(!q&&Bo!==void 0){let $=`${o}/additionalItems`;for(;M<F;M++){let B=ue(r[M],Bo,t,n,i,s,`${a}/${M}`,$);u[M]=!0,B.valid||(q=i,k.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:$,error:"Items did not match additional items schema."},...B.errors))}}}if(Vo!==void 0)if(F===0&&St===void 0)k.push({instanceLocation:a,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(St!==void 0&&F<St)k.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${F}) than minContains (${St}).`});else{let R=`${o}/contains`,$=k.length,B=0;for(let G=0;G<F;G++){let Ue=ue(r[G],Vo,t,n,i,s,`${a}/${G}`,R);Ue.valid?(u[G]=!0,B++):k.push(...Ue.errors)}B>=(St||0)&&(k.length=$),St===void 0&&vn===void 0&&B===0?k.splice($,0,{instanceLocation:a,keyword:"contains",keywordLocation:R,error:"Array does not contain item matching schema."}):St!==void 0&&B<St?k.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${St} items matching schema. Only ${B} items were found.`}):vn!==void 0&&B>vn&&k.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${vn} items matching schema. ${B} items were found.`})}if(!q&&qo!==void 0){let R=`${o}/unevaluatedItems`;for(M;M<F;M++){if(u[M])continue;let $=ue(r[M],qo,t,n,i,s,`${a}/${M}`,R);u[M]=!0,$.valid||k.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:R,error:"Items did not match unevaluated items schema."},...$.errors)}}if(Lp)for(let R=0;R<F;R++){let $=r[R],B=typeof $=="object"&&$!==null;for(let G=0;G<F;G++){if(R===G)continue;let Ue=r[G];($===Ue||B&&(typeof Ue=="object"&&Ue!==null)&&Bt($,Ue))&&(k.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${R} and ${G}.`}),R=Number.MAX_SAFE_INTEGER,G=Number.MAX_SAFE_INTEGER)}}}else if(d==="number"){if(t==="4"?(qt!==void 0&&(zr===!0&&r<=qt||r<qt)&&k.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${zr?"or equal to ":""} ${qt}.`}),Vt!==void 0&&(Mr===!0&&r>=Vt||r>Vt)&&k.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${Mr?"or equal to ":""} ${Vt}.`})):(qt!==void 0&&r<qt&&k.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${qt}.`}),Vt!==void 0&&r>Vt&&k.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${Vt}.`}),zr!==void 0&&r<=zr&&k.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${r} is less than ${zr}.`}),Mr!==void 0&&r>=Mr&&k.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${r} is greater than or equal to ${Mr}.`})),xn!==void 0){let F=r%xn;Math.abs(0-F)>=11920929e-14&&Math.abs(xn-F)>=11920929e-14&&k.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${r} is not a multiple of ${xn}.`})}}else if(d==="string"){let F=En===void 0&&Sn===void 0?0:_p(r);En!==void 0&&F<En&&k.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${F} < ${En}).`}),Sn!==void 0&&F>Sn&&k.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${F} > ${Sn}).`}),Ho!==void 0&&!new RegExp(Ho,"u").test(r)&&k.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),ne!==void 0&&Ao[ne]&&!Ao[ne](r)&&k.push({instanceLocation:a,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${ne}".`})}return{valid:k.length===0,errors:k}}var os=class{schema;draft;shortCircuit;lookup;constructor(e,t="2019-09",n=!0){this.schema=e,this.draft=t,this.shortCircuit=n,this.lookup=dt(e)}validate(e){return ue(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e=g(l({},e),{$id:t})),dt(e,this.lookup)}};function he(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_zod"in e))return!1;let t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function _e(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_def"in e)||"_zod"in e)return!1;let t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function Ck(r){return he(r)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),_e(r)}function bp(r){return!r||typeof r!="object"||Array.isArray(r)?!1:!!(he(r)||_e(r))}function jk(r,e){return p(this,null,function*(){if(he(r))try{return{success:!0,data:yield If(r,e)}}catch(t){return{success:!1,error:t}}if(_e(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")})}function wp(r,e){return p(this,null,function*(){if(he(r))return mn(r,e);if(_e(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")})}function Lk(r,e){if(he(r))try{return{success:!0,data:mn(r,e)}}catch(t){return{success:!1,error:t}}if(_e(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function zk(r,e){if(he(r))return mn(r,e);if(_e(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function vp(r){if(he(r))return qe.get(r)?.description;if(_e(r)||"description"in r&&typeof r.description=="string")return r.description}function Mk(r){if(!bp(r))return!1;if(_e(r)){let e=r._def;if(e.typeName==="ZodObject"){let t=r;return!t.shape||Object.keys(t.shape).length===0}if(e.typeName==="ZodRecord")return!0}if(he(r)){let e=r._zod.def;if(e.type==="object"){let t=r;return!t.shape||Object.keys(t.shape).length===0}if(e.type==="record")return!0}return typeof r=="object"&&r!==null&&!("shape"in r)}function xp(r){return bp(r)?_e(r)?r._def.typeName==="ZodString":he(r)?r._zod.def.type==="string":!1:!1}function Ep(r){return typeof r=="object"&&r!==null&&"_def"in r&&typeof r._def=="object"&&r._def!==null&&"typeName"in r._def&&r._def.typeName==="ZodObject"}function xt(r){return he(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="object":!1}function Po(r){return he(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="array":!1}function Dk(r){return!!(Ep(r)||xt(r))}function Uk(r){if(_e(r))return r.shape;if(he(r))return r._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Zk(r,e){if(_e(r))return r.extend(e);if(he(r))return kt.extend(r,e);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Fk(r){if(_e(r))return r.partial();if(he(r))return kt.partial(Cf,r,void 0);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function us(r,e=!1){if(_e(r))return r.strict();if(xt(r)){let t=r._zod.def.shape;if(e)for(let[s,a]of Object.entries(r._zod.def.shape)){if(xt(a)){let u=us(a,e);t[s]=u}else if(Po(a)){let u=a._zod.def.element;xt(u)&&(u=us(u,e)),t[s]=ze(a,g(l({},a._zod.def),{element:u}))}else t[s]=a;let o=qe.get(a);o&&qe.add(t[s],o)}let n=ze(r,g(l({},r._zod.def),{shape:t,catchall:Lf(Nf)})),i=qe.get(r);return i&&qe.add(n,i),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function yp(r,e=!1){if(Ep(r))return r.passthrough();if(xt(r)){let t=r._zod.def.shape;if(e)for(let[s,a]of Object.entries(r._zod.def.shape)){if(xt(a)){let u=yp(a,e);t[s]=u}else if(Po(a)){let u=a._zod.def.element;xt(u)&&(u=yp(u,e)),t[s]=ze(a,g(l({},a._zod.def),{element:u}))}else t[s]=a;let o=qe.get(a);o&&qe.add(t[s],o)}let n=ze(r,g(l({},r._zod.def),{shape:t,catchall:jf(Rf)})),i=qe.get(r);return i&&qe.add(n,i),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Gk(r){if(_e(r))try{let e=r.parse(void 0);return()=>e}catch{return}if(he(r))try{let e=mn(r,void 0);return()=>e}catch{return}}function mv(r){return _e(r)&&"typeName"in r._def&&r._def.typeName==="ZodEffects"}function gv(r){return he(r)&&r._zod.def.type==="pipe"}function Ar(r,e=!1){if(_e(r))return mv(r)?Ar(r._def.schema,e):r;if(he(r)){let t=r;if(gv(r)&&(t=Ar(r._zod.def.in,e)),e){if(xt(t)){let i=t._zod.def.shape;for(let[s,a]of Object.entries(t._zod.def.shape))i[s]=Ar(a,e);t=ze(t,g(l({},t._zod.def),{shape:i}))}else if(Po(t)){let i=Ar(t._zod.def.element,e);t=ze(t,g(l({},t._zod.def),{element:i}))}}let n=qe.get(r);return n&&qe.add(t,n),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function ko(r){if(he(r)){let e=Ar(r,!0);if(xt(e)){let t=us(e,!0);return Eo(t)}else return Eo(r)}return _e(r)?Io(r):r}function cs(r){if(!r||typeof r!="object"||Object.keys(r).length===0||Array.isArray(r))return!1;if("type"in r)return typeof r.type=="string"?r.type==="string":Array.isArray(r.type)?r.type.every(e=>e==="string"):!1;if("enum"in r)return Array.isArray(r.enum)&&r.enum.length>0&&r.enum.every(e=>typeof e=="string");if("const"in r)return typeof r.const=="string";if("allOf"in r&&Array.isArray(r.allOf))return r.allOf.some(e=>cs(e));if("anyOf"in r&&Array.isArray(r.anyOf)||"oneOf"in r&&Array.isArray(r.oneOf)){let e="anyOf"in r?r.anyOf:r.oneOf;return e.length>0&&e.every(t=>cs(t))}if("not"in r)return!1;if("$ref"in r&&typeof r.$ref=="string"){let e=r.$ref,t=dt(r);return t[e]?cs(t[e]):!1}return!1}function yv(r,e){if(r!==void 0&&!zt(r))return r;if(dn(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function bv(r){return dn(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:g(l({},ko(r.data.schema)),{title:r.data.name})}}var yn=class r{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=zt(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>l({id:e[t.id]},bv(t))),edges:this.edges.map(t=>{let n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let i=t??ce(),s={id:i,data:e,name:yv(t,e),metadata:n};return this.nodes[i]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,i){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let s={source:e.id,target:t.id,data:n,conditional:i};return this.edges.push(s),s}firstNode(){return Sp(this)}lastNode(){return Tp(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(c=>c.id).every(zt)&&(n="");let s=c=>n?`${n}:${c}`:c;Object.entries(e.nodes).forEach(([c,d])=>{this.nodes[s(c)]=g(l({},d),{id:s(c)})});let a=e.edges.map(c=>g(l({},c),{source:s(c.source),target:s(c.target)}));this.edges=[...this.edges,...a];let o=e.firstNode(),u=e.lastNode();return[o?{id:s(o.id),data:o.data}:void 0,u?{id:s(u.id),data:u.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&Sp(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&Tp(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(i=>[i.id,i.name])),t=new Map;Object.values(e).forEach(i=>{t.set(i,(t.get(i)||0)+1)});let n=i=>{let s=e[i];return zt(i)&&t.get(s)===1?s:i};return new r({nodes:Object.fromEntries(Object.entries(this.nodes).map(([i,s])=>[n(i),g(l({},s),{id:n(i)})])),edges:this.edges.map(i=>g(l({},i),{source:n(i.source),target:n(i.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:n,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:s}=e??{},a=this.reid(),o=a.firstNode(),u=a.lastNode();return hf(a.nodes,a.edges,{firstNode:o?.id,lastNode:u?.id,withStyles:t,curveStyle:n,nodeColors:i,wrapLabelNWords:s})}drawMermaidPng(e){return p(this,null,function*(){let t=this.drawMermaid(e);return mf(t,{backgroundColor:e?.backgroundColor})})}};function Sp(r,e=[]){let t=new Set(r.edges.filter(i=>!e.includes(i.source)).map(i=>i.target)),n=[];for(let i of Object.values(r.nodes))!e.includes(i.id)&&!t.has(i.id)&&n.push(i);return n.length===1?n[0]:void 0}function Tp(r,e=[]){let t=new Set(r.edges.filter(i=>!e.includes(i.target)).map(i=>i.source)),n=[];for(let i of Object.values(r.nodes))!e.includes(i.id)&&!t.has(i.id)&&n.push(i);return n.length===1?n[0]:void 0}function Op(r){let e=new TextEncoder,t=new ReadableStream({start(i){return p(this,null,function*(){try{for(var s=X(r),a,o,u;a=!(o=yield s.next()).done;a=!1){let c=o.value;i.enqueue(e.encode(`event: data
data: ${JSON.stringify(c)}

`))}}catch{u=[o]}finally{try{a&&(o=s.return)&&(yield o.call(s))}finally{if(u)throw u[0]}}i.enqueue(e.encode(`event: end

`)),i.close()})}});return Oe.fromReadableStream(t)}function Ro(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}var $p=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function ls(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*No(r,e){for(;;){let{value:t,done:n}=He.runWithConfig(Pt(r),e.next.bind(e),!0);if(n)break;yield t}}function ds(r,e){return V(this,null,function*(){let t=e[Symbol.asyncIterator]();for(;;){let{value:n,done:i}=yield new x(He.runWithConfig(Pt(r),t.next.bind(e),!0));if(i)break;yield n}})}function ye(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var be=class extends We{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new ur({bound:this,kwargs:e,config:{}})}map(){return new jo({bound:this})}withRetry(e){return new fs(l({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt},e))}withConfig(e){return new ur({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new zo({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(ie);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let n=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:t},(i,s)=>ie(s===0?e:n))}return Array.from({length:t},()=>ie(e))}batch(e,t,n){return p(this,null,function*(){let i=this._getOptionsList(t??{},e.length),s=i[0]?.maxConcurrency??n?.maxConcurrency,a=new cn({maxConcurrency:s,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>a.call(()=>p(this,null,function*(){try{return yield this.invoke(u,i[c])}catch(d){if(n?.returnExceptions)return d;throw d}})));return Promise.all(o)})}_streamIterator(e,t){return V(this,null,function*(){yield this.invoke(e,t)})}stream(e,t){return p(this,null,function*(){let n=ie(t),i=new wt({generator:this._streamIterator(e,n),config:n});return yield i.setup,Oe.fromAsyncGenerator(i)})}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=ie(e):t=ie({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let n=l({},e);return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}_callWithConfig(e,t,n){return p(this,null,function*(){let i=ie(n),a=yield(yield nt(i))?.handleChainStart(this.toJSON(),ye(t,"input"),i.runId,i?.runType,void 0,void 0,i?.runName??this.getName());delete i.runId;let o;try{let u=e.call(this,t,i,a);o=yield bt(u,n?.signal)}catch(u){throw yield a?.handleChainError(u),u}return yield a?.handleChainEnd(ye(o,"output")),o})}_batchWithConfig(e,t,n,i){return p(this,null,function*(){let s=this._getOptionsList(n??{},t.length),a=yield Promise.all(s.map(nt)),o=yield Promise.all(a.map((c,d)=>p(this,null,function*(){let f=yield c?.handleChainStart(this.toJSON(),ye(t[d],"input"),s[d].runId,s[d].runType,void 0,void 0,s[d].runName??this.getName());return delete s[d].runId,f}))),u;try{let c=e.call(this,t,s,o,i);u=yield bt(c,s?.[0]?.signal)}catch(c){throw yield Promise.all(o.map(d=>d?.handleChainError(c))),c}return yield Promise.all(o.map(c=>c?.handleChainEnd(ye(u,"output")))),u})}_transformStreamWithConfig(e,t,n){return V(this,null,function*(){let i,s=!0,a,o=!0,u=ie(n),c=yield new x(nt(u));function d(){return V(this,null,function*(){try{for(var y=X(e),v,w,T;v=!(w=yield new x(y.next())).done;v=!1){let N=w.value;if(s)if(i===void 0)i=N;else try{i=ut(i,N)}catch{i=void 0,s=!1}yield N}}catch{T=[w]}finally{try{v&&(w=y.return)&&(yield new x(w.call(y)))}finally{if(T)throw T[0]}}})}let f;try{let y=yield new x(co(t.bind(this),d(),()=>p(this,null,function*(){return c?.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName())}),n?.signal,u));delete u.runId,f=y.setup;let v=f?.handlers.find(ff),w=y.output;v!==void 0&&f!==void 0&&(w=v.tapOutputIterable(f.runId,w));let T=f?.handlers.find(lo);T!==void 0&&f!==void 0&&(w=T.tapOutputIterable(f.runId,w));try{for(var m=X(w),h,_,b;h=!(_=yield new x(m.next())).done;h=!1){let N=_.value;if(yield N,o)if(a===void 0)a=N;else try{a=ut(a,N)}catch{a=void 0,o=!1}}}catch{b=[_]}finally{try{h&&(_=m.return)&&(yield new x(_.call(m)))}finally{if(b)throw b[0]}}}catch(y){throw yield new x(f?.handleChainError(y,void 0,void 0,void 0,{inputs:ye(i,"input")})),y}yield new x(f?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:ye(i,"input")}))})}getGraph(e){let t=new yn,n=t.addNode({name:`${this.getName()}Input`,schema:Lt.any()}),i=t.addNode(this),s=t.addNode({name:`${this.getName()}Output`,schema:Lt.any()});return t.addEdge(n,i),t.addEdge(i,s),t}pipe(e){return new ps({first:this,last:or(e)})}pick(e){return this.pipe(new Do(e))}assign(e){return this.pipe(new Mo(new Pr({steps:e})))}transform(e,t){return V(this,null,function*(){let n;try{for(var i=X(e),s,a,o;s=!(a=yield new x(i.next())).done;s=!1){let u=a.value;n===void 0?n=u:n=ut(n,u)}}catch{o=[a]}finally{try{s&&(a=i.return)&&(yield new x(a.call(i)))}finally{if(o)throw o[0]}}yield*xe(this._streamIterator(n,ie(t)))})}streamLog(e,t,n){return V(this,null,function*(){let i=new $r(g(l({},n),{autoClose:!1,_schemaFormat:"original"})),s=ie(t);yield*xe(this._streamLog(e,i,s))})}_streamLog(e,t,n){return V(this,null,function*(){let{callbacks:i}=n;if(i===void 0)n.callbacks=[t];else if(Array.isArray(i))n.callbacks=i.concat([t]);else{let m=i.copy();m.addHandler(t,!0),n.callbacks=m}let s=this.stream(e,n);function a(){return p(this,null,function*(){try{let y=yield s;try{for(var m=X(y),h,_,b;h=!(_=yield m.next()).done;h=!1){let v=_.value;let w=new it({ops:[{op:"add",path:"/streamed_output/-",value:v}]});yield t.writer.write(w)}}catch{b=[_]}finally{try{h&&(_=m.return)&&(yield _.call(m))}finally{if(b)throw b[0]}}}finally{yield t.writer.close()}})}let o=a();try{try{for(var u=X(t),c,d,f;c=!(d=yield new x(u.next())).done;c=!1){let m=d.value;yield m}}catch{f=[d]}finally{try{c&&(d=u.return)&&(yield new x(d.call(u)))}finally{if(f)throw f[0]}}}finally{yield new x(o)}})}streamEvents(e,t,n){let i;if(t.version==="v1")i=this._streamEventsV1(e,t,n);else if(t.version==="v2")i=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?Op(i):Oe.fromAsyncGenerator(i)}_streamEventsV2(e,t,n){return V(this,null,function*(){let i=new Wi(g(l({},n),{autoClose:!1})),s=ie(t),a=s.runId??ce();s.runId=a;let o=s.callbacks;if(o===void 0)s.callbacks=[i];else if(Array.isArray(o))s.callbacks=o.concat(i);else{let w=o.copy();w.addHandler(i,!0),s.callbacks=w}let u=new AbortController,c=this;function d(){return p(this,null,function*(){let w,T=null;try{t?.signal?"any"in AbortSignal?w=AbortSignal.any([u.signal,t.signal]):(w=t.signal,T=()=>{u.abort()},t.signal.addEventListener("abort",T,{once:!0})):w=u.signal;let ee=yield c.stream(e,g(l({},s),{signal:w})),ne=i.tapOutputIterable(a,ee);try{for(var N=X(ne),L,Z,Q;L=!(Z=yield N.next()).done;L=!1){let me=Z.value;if(u.signal.aborted)break}}catch{Q=[Z]}finally{try{L&&(Z=N.return)&&(yield Z.call(N))}finally{if(Q)throw Q[0]}}}finally{yield i.finish(),w&&T&&w.removeEventListener("abort",T)}})}let f=d(),m=!1,h;try{try{for(var _=X(i),b,y,v;b=!(y=yield new x(_.next())).done;b=!1){let w=y.value;if(!m){w.data.input=e,m=!0,h=w.run_id,yield w;continue}w.run_id===h&&w.event.endsWith("_end")&&w.data?.input&&delete w.data.input,yield w}}catch{v=[y]}finally{try{b&&(y=_.return)&&(yield new x(y.call(_)))}finally{if(v)throw v[0]}}}finally{u.abort(),yield new x(f)}})}_streamEventsV1(e,t,n){return V(this,null,function*(){let i,s=!1,a=ie(t),o=a.tags??[],u=a.metadata??{},c=a.runName??this.getName(),d=new $r(g(l({},n),{autoClose:!1,_schemaFormat:"streaming_events"})),f=new Yi(l({},n)),m=this._streamLog(e,d,a);try{for(var _=X(m),b,y,v;b=!(y=yield new x(_.next())).done;b=!1){let w=y.value;if(i?i=i.concat(w):i=Or.fromRunLogPatch(w),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;let Z=l({},i.state),Q={run_id:Z.id,event:`on_${Z.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};f.includeEvent(Q,Z.type)&&(yield Q)}let T=w.ops.filter(Z=>Z.path.startsWith("/logs/")).map(Z=>Z.path.split("/")[2]),N=[...new Set(T)];for(let Z of N){let Q,ee={},ne=i.state.logs[Z];if(ne.end_time===void 0?ne.streamed_output.length>0?Q="stream":Q="start":Q="end",Q==="start")ne.inputs!==void 0&&(ee.input=ne.inputs);else if(Q==="end")ne.inputs!==void 0&&(ee.input=ne.inputs),ee.output=ne.final_output;else if(Q==="stream"){let me=ne.streamed_output.length;if(me!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${me} instead. Encountered in: "${ne.name}"`);ee={chunk:ne.streamed_output[0]},ne.streamed_output=[]}yield{event:`on_${ne.type}_${Q}`,name:ne.name,run_id:ne.id,tags:ne.tags,metadata:ne.metadata,data:ee}}let{state:L}=i;if(L.streamed_output.length>0){let Z=L.streamed_output.length;if(Z!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${Z} instead. Encountered in: "${L.name}"`);let Q={chunk:L.streamed_output[0]};L.streamed_output=[];let ee={event:`on_${L.type}_stream`,run_id:L.id,tags:o,metadata:u,name:c,data:Q};f.includeEvent(ee,L.type)&&(yield ee)}}}catch{v=[y]}finally{try{b&&(y=_.return)&&(yield new x(y.call(_)))}finally{if(v)throw v[0]}}let h=i?.state;if(h!==void 0){let w={event:`on_${h.type}_end`,name:c,run_id:h.id,tags:o,metadata:u,data:{output:h.final_output}};f.includeEvent(w,h.type)&&(yield w)}})}static isRunnable(e){return dn(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new ur({bound:this,config:{},configFactories:[i=>({callbacks:[new ln({config:i,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return vv(this,e)}},ur=class r extends be{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}_mergeConfig(...e){return p(this,null,function*(){let t=uo(this.config,...e);return uo(t,...this.configFactories?yield Promise.all(this.configFactories.map(n=>p(this,null,function*(){return yield n(t)}))):[])})}bind(e){return new this.constructor({bound:this.bound,kwargs:l(l({},this.kwargs),e),config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:l(l({},this.config),e)})}withRetry(e){return new fs(l({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt},e))}invoke(e,t){return p(this,null,function*(){return this.bound.invoke(e,yield this._mergeConfig(ie(t),this.kwargs))})}batch(e,t,n){return p(this,null,function*(){let i=Array.isArray(t)?yield Promise.all(t.map(s=>p(this,null,function*(){return this._mergeConfig(ie(s),this.kwargs)}))):yield this._mergeConfig(ie(t),this.kwargs);return this.bound.batch(e,i,n)})}_streamIterator(e,t){return V(this,null,function*(){yield*xe(this.bound._streamIterator(e,yield new x(this._mergeConfig(ie(t),this.kwargs))))})}stream(e,t){return p(this,null,function*(){return this.bound.stream(e,yield this._mergeConfig(ie(t),this.kwargs))})}transform(e,t){return V(this,null,function*(){yield*xe(this.bound.transform(e,yield new x(this._mergeConfig(ie(t),this.kwargs))))})}streamEvents(e,t,n){let i=this,s=function(){return V(this,null,function*(){yield*xe(i.bound.streamEvents(e,g(l({},yield new x(i._mergeConfig(ie(t),i.kwargs))),{version:t.version}),n))})};return Oe.fromAsyncGenerator(s())}static isRunnableBinding(e){return e.bound&&be.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new ln({config:i,onStart:e,onEnd:t,onError:n})]})]})}},jo=class r extends be{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new r({bound:this.bound.bind(e)})}invoke(e,t){return p(this,null,function*(){return this._callWithConfig(this._invoke.bind(this),e,t)})}_invoke(e,t,n){return p(this,null,function*(){return this.bound.batch(e,Te(t,{callbacks:n?.getChild()}))})}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}},fs=class r extends ur{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){let i=e>1?`retry:attempt:${e}`:void 0;return Te(t,{callbacks:n?.getChild(i)})}_invoke(e,t,n){return p(this,null,function*(){return(0,Co.default)(i=>Os(r.prototype,this,"invoke").call(this,e,this._patchConfigForRetry(i,t,n)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})})}invoke(e,t){return p(this,null,function*(){return this._callWithConfig(this._invoke.bind(this),e,t)})}_batch(e,t,n,i){return p(this,null,function*(){let s={};try{yield(0,Co.default)(a=>p(this,null,function*(){let o=e.map((m,h)=>h).filter(m=>s[m.toString()]===void 0||s[m.toString()]instanceof Error),u=o.map(m=>e[m]),c=o.map(m=>this._patchConfigForRetry(a,t?.[m],n?.[m])),d=yield Os(r.prototype,this,"batch").call(this,u,c,g(l({},i),{returnExceptions:!0})),f;for(let m=0;m<d.length;m+=1){let h=d[m],_=o[m];h instanceof Error&&f===void 0&&(f=h,f.input=u[m]),s[_.toString()]=h}if(f)throw f;return d}),{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if(i?.returnExceptions!==!0)throw a}return Object.keys(s).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>s[parseInt(a,10)])})}batch(e,t,n){return p(this,null,function*(){return this._batchWithConfig(this._batch.bind(this),e,t,n)})}},ps=class r extends be{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}invoke(e,t){return p(this,null,function*(){let n=ie(t),s=yield(yield nt(n))?.handleChainStart(this.toJSON(),ye(e,"input"),n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let a=e,o;try{let u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1){let f=u[c].invoke(a,Te(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));a=yield bt(f,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");o=yield this.last.invoke(a,Te(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw yield s?.handleChainError(u),u}return yield s?.handleChainEnd(ye(o,"output")),o})}batch(e,t,n){return p(this,null,function*(){let i=this._getOptionsList(t??{},e.length),s=yield Promise.all(i.map(nt)),a=yield Promise.all(s.map((u,c)=>p(this,null,function*(){let d=yield u?.handleChainStart(this.toJSON(),ye(e[c],"input"),i[c].runId,void 0,void 0,void 0,i[c].runName);return delete i[c].runId,d}))),o=e;try{for(let u=0;u<this.steps.length;u+=1){let d=this.steps[u].batch(o,a.map((f,m)=>{let h=f?.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return Te(i[m],{callbacks:h})}),n);o=yield bt(d,i[0]?.signal)}}catch(u){throw yield Promise.all(a.map(c=>c?.handleChainError(u))),u}return yield Promise.all(a.map(u=>u?.handleChainEnd(ye(o,"output")))),o})}_streamIterator(e,t){return V(this,null,function*(){let n=yield new x(nt(t)),f=t??{},{runId:i}=f,s=ae(f,["runId"]),a=yield new x(n?.handleChainStart(this.toJSON(),ye(e,"input"),i,void 0,void 0,void 0,s?.runName)),o=[this.first,...this.middle,this.last],u=!0,c;function d(){return V(this,null,function*(){yield e})}try{let y=o[0].transform(d(),Te(s,{callbacks:a?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let v=1;v<o.length;v+=1){let w=o[v];y=yield new x(w.transform(y,Te(s,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${v+1}`)})))}try{for(var m=X(y),h,_,b;h=!(_=yield new x(m.next())).done;h=!1){let v=_.value;if(t?.signal?.throwIfAborted(),yield v,u)if(c===void 0)c=v;else try{c=ut(c,v)}catch{c=void 0,u=!1}}}catch{b=[_]}finally{try{h&&(_=m.return)&&(yield new x(_.call(m)))}finally{if(b)throw b[0]}}}catch(y){throw yield new x(a?.handleChainError(y)),y}yield new x(a?.handleChainEnd(ye(c,"output")))})}getGraph(e){let t=new yn,n=null;return this.steps.forEach((i,s)=>{let a=i.getGraph(e);s!==0&&a.trimFirstNode(),s!==this.steps.length-1&&a.trimLastNode(),t.extend(a);let o=a.firstNode();if(!o)throw new Error(`Runnable ${i} has no first node`);n&&t.addEdge(n,o),n=a.lastNode()}),t}pipe(e){return r.isRunnableSequence(e)?new r({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new r({first:this.first,middle:[...this.middle,this.last],last:or(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&be.isRunnable(e)}static from([e,...t],n){let i={};return typeof n=="string"?i.name=n:n!==void 0&&(i=n),new r(g(l({},i),{first:or(e),middle:t.slice(0,-1).map(or),last:or(t[t.length-1])}))}},Pr=class r extends be{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,n]of Object.entries(e.steps))this.steps[t]=or(n)}static from(e){return new r({steps:e})}invoke(e,t){return p(this,null,function*(){let n=ie(t),s=yield(yield nt(n))?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let a={};try{let o=Object.entries(this.steps).map(d=>p(this,[d],function*([u,c]){a[u]=yield c.invoke(e,Te(n,{callbacks:s?.getChild(`map:key:${u}`)}))}));yield bt(Promise.all(o),t?.signal)}catch(o){throw yield s?.handleChainError(o),o}return yield s?.handleChainEnd(a),a})}_transform(e,t,n){return V(this,null,function*(){let i=l({},this.steps),s=Hi(e,Object.keys(i).length),a=new Map(Object.entries(i).map(([o,u],c)=>{let d=u.transform(s[c],Te(n,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,d.next().then(f=>({key:o,gen:d,result:f}))]}));for(;a.size;){let o=Promise.race(a.values()),{key:u,result:c,gen:d}=yield new x(bt(o,n?.signal));a.delete(u),c.done||(yield{[u]:c.value},a.set(u,d.next().then(f=>({key:u,gen:d,result:f}))))}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return p(this,null,function*(){function n(){return V(this,null,function*(){yield e})}let i=ie(t),s=new wt({generator:this.transform(n(),i),config:i});return yield s.setup,Oe.fromAsyncGenerator(s)})}},Lo=class r extends be{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!ri(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}invoke(e,t){return p(this,null,function*(){let[n]=this._getOptionsList(t??{},1),i=yield nt(n),s=this.func(Te(n,{callbacks:i}),e);return bt(s,n?.signal)})}_streamIterator(e,t){return V(this,null,function*(){let[n]=this._getOptionsList(t??{},1),i=yield new x(this.invoke(e,t));if(ls(i)){try{for(var s=X(i),a,o,u;a=!(o=yield new x(s.next())).done;a=!1){let c=o.value;n?.signal?.throwIfAborted(),yield c}}catch{u=[o]}finally{try{a&&(o=s.return)&&(yield new x(o.call(s)))}finally{if(u)throw u[0]}}return}if($p(i)){for(;;){n?.signal?.throwIfAborted();let c=i.next();if(c.done)break;yield c.value}return}yield i})}static from(e){return new r({func:e})}};function wv(r){if(ri(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var hs=class r extends be{static lc_name(){return"RunnableLambda"}constructor(e){if(ri(e.func))return Lo.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),wv(e.func),this.func=e.func}static from(e){return new r({func:e})}_invoke(e,t,n){return p(this,null,function*(){return new Promise((i,s)=>{let a=Te(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??Vi)-1});He.runWithConfig(Pt(a),()=>p(this,null,function*(){try{let f=yield this.func(e,l({},a));if(f&&be.isRunnable(f)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");f=yield f.invoke(e,g(l({},a),{recursionLimit:(a.recursionLimit??Vi)-1}))}else if(ls(f)){let m;try{for(var o=X(ds(a,f)),u,c,d;u=!(c=yield o.next()).done;u=!1){let h=c.value;if(t?.signal?.throwIfAborted(),m===void 0)m=h;else try{m=ut(m,h)}catch{m=h}}}catch{d=[c]}finally{try{u&&(c=o.return)&&(yield c.call(o))}finally{if(d)throw d[0]}}f=m}else if(Ro(f)){let m;for(let h of No(a,f))if(t?.signal?.throwIfAborted(),m===void 0)m=h;else try{m=ut(m,h)}catch{m=h}f=m}i(f)}catch(f){s(f)}}))})})}invoke(e,t){return p(this,null,function*(){return this._callWithConfig(this._invoke.bind(this),e,t)})}_transform(e,t,n){return V(this,null,function*(){let i;try{for(var o=X(e),u,c,d;u=!(c=yield new x(o.next())).done;u=!1){let T=c.value;if(i===void 0)i=T;else try{i=ut(i,T)}catch{i=T}}}catch{d=[c]}finally{try{u&&(c=o.return)&&(yield new x(c.call(o)))}finally{if(d)throw d[0]}}let s=Te(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??Vi)-1}),a=yield new x(new Promise((T,N)=>{He.runWithConfig(Pt(s),()=>p(this,null,function*(){try{let L=yield this.func(i,g(l({},s),{config:s}));T(L)}catch(L){N(L)}}))}));if(a&&be.isRunnable(a)){if(n?.recursionLimit===0)throw new Error("Recursion limit reached.");let T=yield new x(a.stream(i,s));try{for(var f=X(T),m,h,_;m=!(h=yield new x(f.next())).done;m=!1){let N=h.value;yield N}}catch{_=[h]}finally{try{m&&(h=f.return)&&(yield new x(h.call(f)))}finally{if(_)throw _[0]}}}else if(ls(a))try{for(var b=X(ds(s,a)),y,v,w;y=!(v=yield new x(b.next())).done;y=!1){let T=v.value;n?.signal?.throwIfAborted(),yield T}}catch{w=[v]}finally{try{y&&(v=b.return)&&(yield new x(v.call(b)))}finally{if(w)throw w[0]}}else if(Ro(a))for(let T of No(s,a))n?.signal?.throwIfAborted(),yield T;else yield a})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return p(this,null,function*(){function n(){return V(this,null,function*(){yield e})}let i=ie(t),s=new wt({generator:this.transform(n(),i),config:i});return yield s.setup,Oe.fromAsyncGenerator(s)})}},Ip=class extends Pr{},zo=class extends be{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}invoke(e,t){return p(this,null,function*(){let n=ie(t),i=yield nt(n),d=n,{runId:s}=d,a=ae(d,["runId"]),o=yield i?.handleChainStart(this.toJSON(),ye(e,"input"),s,void 0,void 0,void 0,a?.runName),u=Te(a,{callbacks:o?.getChild()});return yield He.runWithConfig(u,()=>p(this,null,function*(){let f;for(let m of this.runnables()){n?.signal?.throwIfAborted();try{let h=yield m.invoke(e,u);return yield o?.handleChainEnd(ye(h,"output")),h}catch(h){f===void 0&&(f=h)}}throw f===void 0?new Error("No error stored at end of fallback."):(yield o?.handleChainError(f),f)}))})}_streamIterator(e,t){return V(this,null,function*(){let n=ie(t),i=yield new x(nt(n)),f=n,{runId:s}=f,a=ae(f,["runId"]),o=yield new x(i?.handleChainStart(this.toJSON(),ye(e,"input"),s,void 0,void 0,void 0,a?.runName)),u,c;for(let y of this.runnables()){n?.signal?.throwIfAborted();let v=Te(a,{callbacks:o?.getChild()});try{let w=yield new x(y.stream(e,v));c=ds(v,w);break}catch(w){u===void 0&&(u=w)}}if(c===void 0){let y=u??new Error("No error stored at end of fallback.");throw yield new x(o?.handleChainError(y)),y}let d;try{try{for(var m=X(c),h,_,b;h=!(_=yield new x(m.next())).done;h=!1){let y=_.value;yield y;try{d=d===void 0?d:ut(d,y)}catch{d=void 0}}}catch{b=[_]}finally{try{h&&(_=m.return)&&(yield new x(_.call(m)))}finally{if(b)throw b[0]}}}catch(y){throw yield new x(o?.handleChainError(y)),y}yield new x(o?.handleChainEnd(ye(d,"output")))})}batch(e,t,n){return p(this,null,function*(){if(n?.returnExceptions)throw new Error("Not implemented.");let i=this._getOptionsList(t??{},e.length),s=yield Promise.all(i.map(u=>nt(u))),a=yield Promise.all(s.map((u,c)=>p(this,null,function*(){let d=yield u?.handleChainStart(this.toJSON(),ye(e[c],"input"),i[c].runId,void 0,void 0,void 0,i[c].runName);return delete i[c].runId,d}))),o;for(let u of this.runnables()){i[0].signal?.throwIfAborted();try{let c=yield u.batch(e,a.map((d,f)=>Te(i[f],{callbacks:d?.getChild()})),n);return yield Promise.all(a.map((d,f)=>d?.handleChainEnd(ye(c[f],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(yield Promise.all(a.map(u=>u?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")})}};function or(r){if(typeof r=="function")return new hs({func:r});if(be.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){let e={};for(let[t,n]of Object.entries(r))e[t]=or(n);return new Pr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var Mo=class extends be{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Pr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}invoke(e,t){return p(this,null,function*(){let n=yield this.mapper.invoke(e,t);return l(l({},e),n)})}_transform(e,t,n){return V(this,null,function*(){let i=this.mapper.getStepsKeys(),[s,a]=Hi(e),o=this.mapper.transform(a,Te(n,{callbacks:t?.getChild()})),u=o.next();try{for(var c=X(s),d,f,m;d=!(f=yield new x(c.next())).done;d=!1){let v=f.value;if(typeof v!="object"||Array.isArray(v))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof v}`);let w=Object.fromEntries(Object.entries(v).filter(([T])=>!i.includes(T)));Object.keys(w).length>0&&(yield w)}}catch{m=[f]}finally{try{d&&(f=c.return)&&(yield new x(f.call(c)))}finally{if(m)throw m[0]}}yield(yield new x(u)).value;try{for(var h=X(o),_,b,y;_=!(b=yield new x(h.next())).done;_=!1){let v=b.value;yield v}}catch{y=[b]}finally{try{_&&(b=h.return)&&(yield new x(b.call(h)))}finally{if(y)throw y[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return p(this,null,function*(){function n(){return V(this,null,function*(){yield e})}let i=ie(t),s=new wt({generator:this.transform(n(),i),config:i});return yield s.setup,Oe.fromAsyncGenerator(s)})}},Do=class extends be{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}_pick(e){return p(this,null,function*(){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}})}invoke(e,t){return p(this,null,function*(){return this._callWithConfig(this._pick.bind(this),e,t)})}_transform(e){return V(this,null,function*(){try{for(var t=X(e),n,i,s;n=!(i=yield new x(t.next())).done;n=!1){let a=i.value;let o=yield new x(this._pick(a));o!==void 0&&(yield o)}}catch{s=[i]}finally{try{n&&(i=t.return)&&(yield new x(i.call(t)))}finally{if(s)throw s[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return p(this,null,function*(){function n(){return V(this,null,function*(){yield e})}let i=ie(t),s=new wt({generator:this.transform(n(),i),config:i});return yield s.setup,Oe.fromAsyncGenerator(s)})}},ms=class extends ur{constructor(e){let t=ps.from([hs.from(n=>p(this,null,function*(){let i;if(Nn(n))try{i=yield wp(this.schema,n.args)}catch{throw new Rn("Received tool input did not match expected schema",JSON.stringify(n.args))}else i=n;return i})).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function vv(r,e){let t=e.name??r.getName(),n=e.description??vp(e.schema);return xp(e.schema)?new ms({name:t,description:n,schema:Lt.object({input:Lt.string()}).transform(i=>i.input),bound:r}):new ms({name:t,description:n,schema:e.schema,bound:r})}var gs=class extends be{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}mergePartialAndUserVariables(e){return p(this,null,function*(){let t=this.partialVariables??{},n={};for(let[s,a]of Object.entries(t))typeof a=="string"?n[s]=a:n[s]=yield a();return l(l({},n),e)})}invoke(e,t){return p(this,null,function*(){let n=l(l({},this.metadata),t?.metadata),i=[...this.tags??[],...t?.tags??[]];return this._callWithConfig(s=>this.formatPromptValue(s),e,g(l({},t),{tags:i,metadata:n,runType:"prompt"}))})}serialize(){throw new Error("Use .toJSON() instead")}static deserialize(e){return p(this,null,function*(){switch(e._type){case"prompt":{let{PromptTemplate:t}=yield import("./chunk-NVMXW3V4.js");return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=yield import("./chunk-NVMXW3V4.js");return t.deserialize(g(l({},e),{_type:"prompt"}))}case"few_shot":{let{FewShotPromptTemplate:t}=yield import("./chunk-WPWF56UE.js");return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}})}};var _s=class extends gs{formatPromptValue(e){return p(this,null,function*(){let t=yield this.format(e);return new Fr(t)})}};var xv=Object.prototype.toString,Rr=Array.isArray||function(e){return xv.call(e)==="[object Array]"};function Zo(r){return typeof r=="function"}function Ev(r){return Rr(r)?"array":typeof r}function Uo(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Ap(r,e){return r!=null&&typeof r=="object"&&e in r}function Sv(r,e){return r!=null&&typeof r!="object"&&r.hasOwnProperty&&r.hasOwnProperty(e)}var Tv=RegExp.prototype.test;function Ov(r,e){return Tv.call(r,e)}var $v=/\S/;function Iv(r){return!Ov($v,r)}var Av={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Pv(r){return String(r).replace(/[&<>"'`=\/]/g,function(t){return Av[t]})}var kv=/\s*/,Rv=/\s+/,Pp=/\s*=/,Nv=/\s*\}/,Cv=/#|\^|\/|>|\{|&|=|!/;function jv(r,e){if(!r)return[];var t=!1,n=[],i=[],s=[],a=!1,o=!1,u="",c=0;function d(){if(a&&!o)for(;s.length;)delete i[s.pop()];else s=[];a=!1,o=!1}var f,m,h;function _(ee){if(typeof ee=="string"&&(ee=ee.split(Rv,2)),!Rr(ee)||ee.length!==2)throw new Error("Invalid tags: "+ee);f=new RegExp(Uo(ee[0])+"\\s*"),m=new RegExp("\\s*"+Uo(ee[1])),h=new RegExp("\\s*"+Uo("}"+ee[1]))}_(e||st.tags);for(var b=new wn(r),y,v,w,T,N,L;!b.eos();){if(y=b.pos,w=b.scanUntil(f),w)for(var Z=0,Q=w.length;Z<Q;++Z)T=w.charAt(Z),Iv(T)?(s.push(i.length),u+=T):(o=!0,t=!0,u+=" "),i.push(["text",T,y,y+1]),y+=1,T===`
`&&(d(),u="",c=0,t=!1);if(!b.scan(f))break;if(a=!0,v=b.scan(Cv)||"name",b.scan(kv),v==="="?(w=b.scanUntil(Pp),b.scan(Pp),b.scanUntil(m)):v==="{"?(w=b.scanUntil(h),b.scan(Nv),b.scanUntil(m),v="&"):w=b.scanUntil(m),!b.scan(m))throw new Error("Unclosed tag at "+b.pos);if(v==">"?N=[v,w,y,b.pos,u,c,t]:N=[v,w,y,b.pos],c++,i.push(N),v==="#"||v==="^")n.push(N);else if(v==="/"){if(L=n.pop(),!L)throw new Error('Unopened section "'+w+'" at '+y);if(L[1]!==w)throw new Error('Unclosed section "'+L[1]+'" at '+y)}else v==="name"||v==="{"||v==="&"?o=!0:v==="="&&_(w)}if(d(),L=n.pop(),L)throw new Error('Unclosed section "'+L[1]+'" at '+b.pos);return zv(Lv(i))}function Lv(r){for(var e=[],t,n,i=0,s=r.length;i<s;++i)t=r[i],t&&(t[0]==="text"&&n&&n[0]==="text"?(n[1]+=t[1],n[3]=t[3]):(e.push(t),n=t));return e}function zv(r){for(var e=[],t=e,n=[],i,s,a=0,o=r.length;a<o;++a)switch(i=r[a],i[0]){case"#":case"^":t.push(i),n.push(i),t=i[4]=[];break;case"/":s=n.pop(),s[5]=i[2],t=n.length>0?n[n.length-1][4]:e;break;default:t.push(i)}return e}function wn(r){this.string=r,this.tail=r,this.pos=0}wn.prototype.eos=function(){return this.tail===""};wn.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};wn.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=n.length,n};function kr(r,e){this.view=r,this.cache={".":this.view},this.parent=e}kr.prototype.push=function(e){return new kr(e,this)};kr.prototype.lookup=function(e){var t=this.cache,n;if(t.hasOwnProperty(e))n=t[e];else{for(var i=this,s,a,o,u=!1;i;){if(e.indexOf(".")>0)for(s=i.view,a=e.split("."),o=0;s!=null&&o<a.length;)o===a.length-1&&(u=Ap(s,a[o])||Sv(s,a[o])),s=s[a[o++]];else s=i.view[e],u=Ap(i.view,e);if(u){n=s;break}i=i.parent}t[e]=n}return Zo(n)&&(n=n.call(this.view)),n};function De(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}De.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};De.prototype.parse=function(e,t){var n=this.templateCache,i=e+":"+(t||st.tags).join(":"),s=typeof n<"u",a=s?n.get(i):void 0;return a==null&&(a=jv(e,t),s&&n.set(i,a)),a};De.prototype.render=function(e,t,n,i){var s=this.getConfigTags(i),a=this.parse(e,s),o=t instanceof kr?t:new kr(t,void 0);return this.renderTokens(a,o,n,e,i)};De.prototype.renderTokens=function(e,t,n,i,s){for(var a="",o,u,c,d=0,f=e.length;d<f;++d)c=void 0,o=e[d],u=o[0],u==="#"?c=this.renderSection(o,t,n,i,s):u==="^"?c=this.renderInverted(o,t,n,i,s):u===">"?c=this.renderPartial(o,t,n,s):u==="&"?c=this.unescapedValue(o,t):u==="name"?c=this.escapedValue(o,t,s):u==="text"&&(c=this.rawValue(o)),c!==void 0&&(a+=c);return a};De.prototype.renderSection=function(e,t,n,i,s){var a=this,o="",u=t.lookup(e[1]);function c(m){return a.render(m,t,n,s)}if(u){if(Rr(u))for(var d=0,f=u.length;d<f;++d)o+=this.renderTokens(e[4],t.push(u[d]),n,i,s);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),n,i,s);else if(Zo(u)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,i.slice(e[3],e[5]),c),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,n,i,s);return o}};De.prototype.renderInverted=function(e,t,n,i,s){var a=t.lookup(e[1]);if(!a||Rr(a)&&a.length===0)return this.renderTokens(e[4],t,n,i,s)};De.prototype.indentPartial=function(e,t,n){for(var i=t.replace(/[^ \t]/g,""),s=e.split(`
`),a=0;a<s.length;a++)s[a].length&&(a>0||!n)&&(s[a]=i+s[a]);return s.join(`
`)};De.prototype.renderPartial=function(e,t,n,i){if(n){var s=this.getConfigTags(i),a=Zo(n)?n(e[1]):n[e[1]];if(a!=null){var o=e[6],u=e[5],c=e[4],d=a;u==0&&c&&(d=this.indentPartial(a,c,o));var f=this.parse(d,s);return this.renderTokens(f,t,n,d,i)}}};De.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(n!=null)return n};De.prototype.escapedValue=function(e,t,n){var i=this.getConfigEscape(n)||st.escape,s=t.lookup(e[1]);if(s!=null)return typeof s=="number"&&i===st.escape?String(s):i(s)};De.prototype.rawValue=function(e){return e[1]};De.prototype.getConfigTags=function(e){return Rr(e)?e:e&&typeof e=="object"?e.tags:void 0};De.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Rr(e))return e.escape};var st={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(r){bn.templateCache=r},get templateCache(){return bn.templateCache}},bn=new De;st.clearCache=function(){return bn.clearCache()};st.parse=function(e,t){return bn.parse(e,t)};st.render=function(e,t,n,i){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Ev(e)+'" was given as the first argument for mustache#render(template, view, partials)');return bn.render(e,t,n,i)};st.escape=Pv;st.Scanner=wn;st.Context=kr;st.Writer=De;var ys=st;function kp(){ys.escape=r=>r}var Rp=r=>{let e=r.split(""),t=[],n=(s,a)=>{for(let o=a;o<e.length;o+=1)if(s.includes(e[o]))return o;return-1},i=0;for(;i<e.length;)if(e[i]==="{"&&i+1<e.length&&e[i+1]==="{")t.push({type:"literal",text:"{"}),i+=2;else if(e[i]==="}"&&i+1<e.length&&e[i+1]==="}")t.push({type:"literal",text:"}"}),i+=2;else if(e[i]==="{"){let s=n("}",i);if(s<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(i+1,s).join("")}),i=s+1}else{if(e[i]==="}")throw new Error("Single '}' in template.");{let s=n("{}",i),a=(s<0?e.slice(i):e.slice(i,s)).join("");t.push({type:"literal",text:a}),i=s<0?e.length:s}}return t},Mv=r=>r.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),Dv=r=>{kp();let e=ys.parse(r);return Mv(e)},Uv=(r,e)=>Rp(r).reduce((t,n)=>{if(n.type==="variable"){if(n.name in e){let i=typeof e[n.name]=="string"?e[n.name]:JSON.stringify(e[n.name]);return t+i}throw new Error(`(f-string) Missing value for input ${n.name}`)}return t+n.text},""),Zv=(r,e)=>(kp(),ys.render(r,e)),Fo={"f-string":Uv,mustache:Zv},Fv={"f-string":Rp,mustache:Dv},Nr=(r,e,t)=>{try{return Fo[e](r,t)}catch(n){throw kn(n,"INVALID_PROMPT_INPUT")}},Np=(r,e)=>Fv[e](r),Cp=(r,e,t)=>{if(!(e in Fo)){let n=Object.keys(Fo);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${n}`)}try{let n=t.reduce((i,s)=>(i[s]="foo",i),{});Array.isArray(r)?r.forEach(i=>{if(i.type==="text")Nr(i.text,e,n);else if(i.type==="image_url")if(typeof i.image_url=="string")Nr(i.image_url,e,n);else{let s=i.image_url.url;Nr(s,e,n)}else throw new Error(`Invalid message template received. ${JSON.stringify(i,null,2)}`)}):Nr(r,e,n)}catch(n){throw new Error(`Invalid prompt schema: ${n.message}`)}};var jp=class r extends _s{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Cp(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}format(e){return p(this,null,function*(){let t=yield this.mergePartialAndUserVariables(e);return Nr(this.template,this.templateFormat,t)})}static fromExamples(e,t,n,i=`

`,s=""){let a=[s,...e,t].join(i);return new r({inputVariables:n,template:a})}static fromTemplate(e,t){let a=t??{},{templateFormat:n="f-string"}=a,i=ae(a,["templateFormat"]),s=new Set;return Np(e,n).forEach(o=>{o.type==="variable"&&s.add(o.name)}),new r(l({inputVariables:[...s],templateFormat:n,template:e},i))}partial(e){return p(this,null,function*(){let t=this.inputVariables.filter(s=>!(s in e)),n=l(l({},this.partialVariables??{}),e),i=g(l({},this),{inputVariables:t,partialVariables:n});return new r(i)})}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static deserialize(e){return p(this,null,function*(){if(!e.template)throw new Error("Prompt template must have a template");return new r({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})})}};export{l as a,g as b,ae as c,z as d,ve as e,pt as f,Os as g,p as h,x as i,V as j,xe as k,X as l,S as m,Lt as n,bx as o,As as p,Hv as q,du as r,An as s,We as t,Qp as u,Rt as v,Yv as w,Xv as x,Qv as y,ex as z,tx as A,rx as B,nx as C,ix as D,Ke as E,pu as F,ke as G,ux as H,fe as I,Dr as J,hu as K,Ze as L,mu as M,Is as N,cx as O,xx as P,Ur as Q,gu as R,Ex as S,Sx as T,lr as U,Px as V,kx as W,Nt as X,Zr as Y,Cn as Z,jx as _,Lx as $,jn as aa,Ln as ba,Ux as ca,Zx as da,Tt as ea,Pn as fa,px as ga,hx as ha,dr as ia,zn as ja,Bx as ka,qx as la,kn as ma,Nn as na,_x as oa,Rn as pa,rE as qa,Mn as ra,ih as sa,nE as ta,iE as ua,sE as va,zt as wa,ce as xa,ti as ya,Hu as za,Xt as Aa,k0 as Ba,ot as Ca,Ib as Da,Ab as Ea,Mt as Fa,Pb as Ga,Ve as Ha,Rb as Ia,Cb as Ja,Ut as Ka,jb as La,Mb as Ma,Ub as Na,rt as Oa,Gb as Pa,He as Qa,nt as Ra,uo as Sa,ie as Ta,Te as Ua,Pt as Va,Oe as Wa,ut as Xa,Vb as Ya,Jb as Za,Wb as _a,sr as $a,fo as ab,Kb as bb,cn as cb,Qb as db,mn as eb,Eo as fb,Bt as gb,ue as hb,he as ib,_e as jb,Ck as kb,bp as lb,jk as mb,wp as nb,Lk as ob,zk as pb,vp as qb,Mk as rb,xp as sb,Ep as tb,xt as ub,Po as vb,Dk as wb,Uk as xb,Zk as yb,Fk as zb,us as Ab,yp as Bb,Gk as Cb,Ar as Db,ko as Eb,cs as Fb,_v as Gb,yn as Hb,ye as Ib,be as Jb,ur as Kb,jo as Lb,fs as Mb,ps as Nb,Pr as Ob,hs as Pb,Ip as Qb,zo as Rb,or as Sb,Mo as Tb,Do as Ub,ms as Vb,Fr as Wb,ks as Xb,Rs as Yb,sh as Zb,_s as _b,Rp as $b,Dv as ac,Uv as bc,Zv as cc,Fo as dc,Fv as ec,Nr as fc,Np as gc,Cp as hc,jp as ic,gs as jc};
